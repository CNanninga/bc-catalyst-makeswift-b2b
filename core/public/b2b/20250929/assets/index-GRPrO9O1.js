import{j as t,A as Ne,ae as ge,B as f,T as $,ah as ee,G as pt,a1 as se,w as zt,X as Be,Y as Oe,s as Rt,b as Yt,O as De}from"./mui-DjJKBaL-.js";import{r as c}from"./intl-D34a3Rgg.js";import{a as wt,c3 as qe,u as st,j as It,ag as At,bt as Ee,a3 as Fe,be as Gt,ak as A,c4 as Re,a2 as Qt,bg as me,ad as Xt,af as xe,br as Zt,aN as _t,ay as Tt,bF as ie,c5 as Ut,aP as Mt,e as fe,a4 as be,bj as Se,G as ye,o as Qe,ba as Le,bb as Ce,bk as Ve,bl as Ue,bm as Pe,bn as ne,bM as oe,bi as re,p as ae,c6 as ce,aO as Me,C as $e,ao as Wt,c7 as ze,at as Kt,l as _e,bs as $t,am as He,bh as Je,ah as Ge,y as We,I as Ke}from"./react-setup-Ctz-bmMs.js";import"./load-functions-utyuqH_X.js";import{b as Ye,c as Xe,S as gt,u as de,h as le,i as Ze,j as ts,k as es,l as ss,m as is,n as ns,o as os}from"./shoppingList-5c4DgHH6.js";import{b as rs}from"./base-CC7kTJh2.js";import{u as as}from"./useBlockPendingAccountViewPrice-DCd_y0C0.js";import{S as ke,v as cs,a as ds}from"./ShoppingListDetailsContext-dB1dpdt_.js";import{S as ls,Q as ps,C as us}from"./SearchProduct-C8Sz4cJ1.js";import{U as hs,f as Ht,c as gs,i as ms,r as je,E as Ie}from"./muiIcon-BBtg8u0V.js";import{b as qt}from"./b3TriggerCartNumber-Dt8ppjJx.js";import{a as te,c as xs}from"./router-DcuTQ_yx.js";import{S as fs}from"./ShoppingListStatusTag-SPDY5Pv_.js";import{f as bs}from"./lodashEs-CONzB2I0.js";import{b as ve}from"./b2bGetVariantImageByVariantInfo-BskJ2qQo.js";import{u as Ss}from"./useSort-57pG6e8y.js";import{B as ys}from"./B3FilterSearch-BPb2-EyD.js";import"./reactVendor-CkUTLE5B.js";import"./eCache-97HTO8co.js";import"./redux-Bt5-tVzx.js";import"./toolkit-CpEbzTSY.js";import"../index.js";import"./global-D7Yn0gGb.js";import"./dropzone-B1UJxEDf.js";import"./dateFns-DubixNBV.js";import"./form-pKe_k4Gy.js";import"./B3CustomForm-BLuJSiae.js";function Ls(y){const[n]=wt(),{disabled:s=!1,label:i=n?"Qty":"",value:o="",maxQuantity:l=0,minQuantity:b=0,isStock:P="0",stock:O=0,hiddenLabel:J=!n,onChange:p=()=>{},sx:Z={width:n?"110px":"72px","& .MuiFormHelperText-root":{marginLeft:"0",marginRight:"0"}}}=y,[V,z]=c.useState(""),T=c.useCallback(h=>{const a=parseInt("".concat(h),10)||0;let r="";return P==="1"&&O===0?r="Out of stock":P==="1"&&a>O?r="".concat(O," in stock"):b!==0&&a<b?r="Min is ".concat(b):l!==0&&a>l&&(r="Max is ".concat(l)),z(r),r},[P,l,b,O]),w=h=>{p(h,!!V)},G=()=>{const h=parseInt("".concat(o),10)||0;p(h,!T(h))};return c.useEffect(()=>{T(o)},[T,o]),t.jsx(qe,{size:"small",type:"number",variant:"filled",disabled:s,hiddenLabel:J,label:i,value:o,error:!!V,helperText:V,inputProps:{inputMode:"numeric",pattern:"[0-9]*"},onChange:h=>{w(h.target.value)},onBlur:()=>{G()},sx:Z})}function Cs(y){const{state:{id:n}}=c.useContext(ke),s=st(({company:a})=>a.companyInfo.status),{updateList:i,isB2BUser:o,type:l=""}=y,b=It(),[P,O]=c.useState(!1),[J,p]=c.useState(!1),[Z]=as(),V=o?Ye:Xe,z=async a=>{try{if(!Fe("on-add-to-shopping-list",a))throw new Error;const r=a.map(g=>({optionList:Gt(g.newSelectOptionList,g),productId:g.id,quantity:g.quantity,variantId:g.variantId}));await V({shoppingListId:n,items:r}),A.success(b("shoppingList.addToShoppingList.productsAdded"))}catch(r){r.message.length>0&&A.error(r.message)}},T=async a=>{const r=a.map(g=>({optionList:Gt(g.newSelectOptionList||g.optionList,(g==null?void 0:g.products)||g)||[],productId:parseInt(g.productId,10)||0,quantity:g.quantity,variantId:parseInt(g.variantId,10)||0}));await V({shoppingListId:n,items:r}),A.success(b("shoppingList.addToShoppingList.productsAdded"))},w=a=>{const r=[],g=[],k=[];return a.forEach(D=>{const{products:d,qty:ct}=D,{option:R,purchasingDisabled:C,variantSku:L,variantId:q,productId:j,modifiers:U}=d,tt=Re(U);if(C&&l!=="shoppingList"){r.push(L);return}if(tt.filter(N=>!N.isVerified).length>0){k.push(L);return}const W=R.map(N=>({optionId:"attribute[".concat(N.option_id,"]"),optionValue:N.id.toString()}));tt.forEach(N=>{const{type:it}=N;if(it==="date"){const{defaultValue:ot}=N;Object.keys(ot).forEach(E=>{W.push({optionId:"attribute[".concat(N.option_id,"][").concat(E,"]"),optionValue:"".concat(N.defaultValue[E])})})}else W.push({optionId:"attribute[".concat(N.option_id,"]"),optionValue:"".concat(N.defaultValue)})}),g.push({productId:parseInt(j,10)||0,variantId:parseInt(q,10)||0,quantity:Number(ct),optionList:W,products:D.products})}),{notPurchaseSku:r,productItems:g,notAddAble:k}},G=async a=>{p(!0);try{const{validProduct:r}=a,{notPurchaseSku:g,productItems:k,notAddAble:D}=w(r);k.length>0&&(await T(k),i()),D.length>0&&l!=="shoppingList"&&A.error(b("shoppingList.addToShoppingList.skuNotAddable",{notAddAble:D.join(", ")})),g.length>0&&l!=="shoppingList"&&A.error(b("shoppingList.addToShoppingList.skuNotPurchasable",{notPurchaseSku:g.join(", ")})),O(!1)}finally{p(!1)}},h=()=>{Z&&s===0?A.info("Your business account is pending approval. This feature is currently disabled."):O(!0)};return t.jsx(Ne,{sx:{marginBottom:"50px"},children:t.jsx(ge,{children:t.jsxs(f,{children:[t.jsx($,{variant:"h5",children:b("shoppingList.addToShoppingList.addToList")}),t.jsx(ls,{updateList:i,addToList:z,type:"shoppingList"}),t.jsx(ee,{}),t.jsx(ps,{type:"shoppingList",updateList:i,quickAddToList:T}),t.jsx(ee,{}),t.jsx(f,{sx:{margin:"20px 0 0"},children:t.jsxs(At,{variant:"text",onClick:()=>h(),children:[t.jsx(hs,{sx:{marginRight:"8px"}}),b("shoppingList.addToShoppingList.bulkUploadCsv")]})}),t.jsx(Ee,{isOpen:P,setIsOpen:O,handleAddToList:G,isLoading:J,withModifiers:!0})]})})})}const pe=zt("div")(({isHeader:y,isMobile:n})=>({display:"flex",wordBreak:"break-word",padding:"8px 0 0",gap:"8px",flexWrap:n?"wrap":"initial",...y?{borderBottom:"1px solid #D9DCE9",paddingBottom:"8px",alignItems:"center"}:{alignItems:"flex-start"},...n?{borderTop:"1px solid #D9DCE9",padding:"12px 0 12px","&:first-of-type":{marginTop:"12px"}}:{}})),Pt=zt(f)(({width:y,padding:n="0",flexBasis:s,flexDirection:i="row",alignItems:o,textAlignLocation:l})=>({display:"flex",justifyContent:l==="right"?"flex-end":"flex-start",flexDirection:i,flexGrow:y?0:1,flexShrink:y?0:1,alignItems:o||"flex-start",flexBasis:s,width:y,padding:n})),Ft=zt("div")(()=>({fontSize:"0.875rem",lineHeight:"1.5",color:"#263238"})),Ps=zt("img")(()=>({width:"60px",borderRadius:"4px",flexShrink:0})),ks={default:{width:"15%"},delete:{width:"30px"}},js={default:{width:"100%",padding:"0 0 0 76px"},delete:{width:"100%",padding:"0 0 0 76px",display:"flex",flexDirection:"row-reverse"}};function Is(y){const{shoppingListInfo:n,products:s,successProducts:i,allowJuniorPlaceOrder:o,setValidateFailureProducts:l,setValidateSuccessProducts:b,textAlign:P="left",backendValidationEnabled:O}=y,{submitShoppingListPermission:J}=st(Qt),p=It(),[Z,V]=c.useState(!1),[z,T]=c.useState(!1),[w]=wt(),{decimal_places:G=2}=st(me);c.useEffect(()=>{s.length>0?V(!0):V(!1)},[s]);const h=w?js:ks,a=async(C,L,q)=>{const j=[...s];j[C].node.quantity=Number(L),j[C].isValid=q;const U=await ie(j[C].node,Number(L));U&&(j[C].node=U,l(j))},r=()=>{V(!1),l([]),b([])},g=C=>{const L=[...s];L.splice(C,1),l(L)},k=()=>{r(),o&&J&&(n==null?void 0:n.status)===gt.Approved?window.location.href=fe:(A.success(p("shoppingList.reAddToCart.productsAdded"),{action:{label:p("shoppingList.reAddToCart.viewCart"),onClick:()=>{window.b2b.callbacks.dispatchEvent("on-click-cart-button")&&(window.location.href=be)}}}),qt())},D=async()=>{if(!s.every(L=>L.isValid)){A.error(p("shoppingList.reAddToCart.fillCorrectQuantity"));return}try{T(!0);const L=Ut(s),q=await Mt(L);q.errors||k(),q.errors&&A.error(q.message),qt()}finally{T(!1)}},d=async()=>{T(!0);try{const C=Ut(s);(await Mt(C)).errors||k(),qt()}catch(C){C instanceof Error&&A.error(C.message)}finally{T(!1)}},ct=async()=>{O?await d():D()},R=async()=>{const C=s.filter(j=>j.isStock==="0"||j.stock!==0),L=[];C.forEach(j=>{var yt;const U=j,{node:{quantity:tt},minQuantity:_=0,maxQuantity:W=0,isStock:N,stock:it}=j,ot=parseInt("".concat(tt),10)||0;_!==0&&ot<_?U.node.quantity=_:W!==0&&ot>W&&(U.node.quantity=W),N!=="0"&&it&&(tt?Number(tt):0)>it&&(U.node.quantity=it),U.isValid=!0;const E=(yt=j==null?void 0:j.node)!=null&&yt.quantity?Number(j.node.quantity):0;L.push(ie(j.node,E))}),(await Promise.all(L)).forEach((j,U)=>{C[U].node=j}),l(C)};return t.jsx(Xt,{isOpen:Z,handleLeftClick:r,handRightClick:ct,title:p(o?"shoppingList.reAddToCart.proceedToCheckout":"shoppingList.reAddToCart.addToCart"),rightSizeBtn:p(o?"shoppingList.reAddToCart.proceedToCheckout":"shoppingList.reAddToCart.addToCart"),maxWidth:"xl",children:t.jsxs(pt,{children:[t.jsx(f,{sx:{m:"0 0 1rem 0"},children:t.jsx(se,{variant:"filled",severity:"success",children:o?p("shoppingList.reAddToCart.productsCanCheckout",{successProducts:i}):p("shoppingList.reAddToCart.productsAddedToCart",{successProducts:i})})}),t.jsx(f,{sx:{m:"1rem 0"},children:t.jsx(se,{variant:"filled",severity:"error",children:o?p("shoppingList.reAddToCart.productsCantCheckout",{quantity:s.length}):p("shoppingList.reAddToCart.productsNotAddedToCart",{quantity:s.length})})}),t.jsxs(xe,{isSpinning:z,size:16,isFlex:!1,children:[t.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",margin:"0.5rem 0 1rem 0"},children:[t.jsx(f,{sx:{fontSize:"24px"},children:p("shoppingList.reAddToCart.productCount",{quantity:s.length})}),t.jsx(At,{onClick:()=>R(),children:p("shoppingList.reAddToCart.adjustQuantity")})]}),s.length>0?t.jsxs(f,{children:[!w&&t.jsxs(pe,{isHeader:!0,isMobile:w,children:[t.jsx(Pt,{children:t.jsx(Ft,{children:p("shoppingList.reAddToCart.product")})}),t.jsx(Pt,{...h.default,textAlignLocation:P,children:t.jsx(Ft,{children:p("shoppingList.reAddToCart.price")})}),t.jsx(Pt,{sx:{justifyContent:"center"},...h.default,textAlignLocation:P,children:t.jsx(Ft,{children:p("shoppingList.reAddToCart.quantity")})}),t.jsx(Pt,{...h.default,textAlignLocation:P,children:t.jsx(Ft,{children:p("shoppingList.reAddToCart.total")})}),t.jsx(Pt,{...h.delete,children:t.jsx(Ft,{children:" "})})]}),s.map((C,L)=>{const{isStock:q,maxQuantity:j,minQuantity:U,stock:tt}=C,{quantity:_=1,primaryImage:W,productName:N,variantSku:it,optionList:ot,productsSearch:E,basePrice:yt}=C.node,Lt=Number(yt),vt=(Lt*(_?Number(_):0)).toFixed(G),kt={...E,selectOptions:ot},Nt=Zt(kt,{}),rt=JSON.parse(ot),mt=Nt.filter(Q=>Q.valueText);return t.jsxs(pe,{isMobile:w,children:[t.jsxs(Pt,{children:[t.jsx(Ps,{src:W||_t}),t.jsxs(f,{sx:{marginLeft:"16px"},children:[t.jsx($,{variant:"body1",color:"#212121",children:N}),t.jsx($,{variant:"body1",color:"#616161",children:it}),rt.length>0&&mt.length>0&&mt.map(Q=>t.jsx($,{sx:{fontSize:"0.75rem",lineHeight:"1.5",color:"#455A64"},children:"".concat(Q.valueLabel,": ").concat(Q.valueText)},Q.valueLabel))]})]}),t.jsxs(Pt,{...h.default,textAlignLocation:P,children:[w&&t.jsx("span",{children:"Price: "}),Tt(Lt)]}),t.jsx(Pt,{...h.default,textAlignLocation:P,children:t.jsx(Ls,{isStock:q,maxQuantity:j,minQuantity:U,stock:tt,value:_,onChange:(Q,u)=>{a(L,Q,u)}})}),t.jsxs(Pt,{...h.default,textAlignLocation:P,children:[w&&t.jsx("div",{children:"Total: "}),Tt(vt)]}),t.jsx(Pt,{...h.delete,children:t.jsx(Ht,{sx:{cursor:"pointer",color:"rgba(0, 0, 0, 0.54)"},onClick:()=>{g(L)}})})]},it)})]}):null]})]})})}function vs(y){const n=It(),[s]=wt(),{open:i,handleCancelClick:o,handleDeleteProductClick:l}=y;return t.jsx(Xt,{isOpen:i,title:n("shoppingList.deleteItems.subtotal"),leftSizeBtn:n("shoppingList.deleteItems.cancel"),rightSizeBtn:n("shoppingList.deleteItems.delete"),handleLeftClick:o,handRightClick:l,rightStyleBtn:{color:"#D32F2F"},children:t.jsx(f,{sx:{display:"flex",width:s?"100%":"450px",height:"100%"},children:n("shoppingList.deleteItems.confirmDelete")})})}function As(y){const[n]=wt(),s=It(),i=te(),o=Se(),{state:{productQuoteEnabled:l=!1}}=c.useContext(ye),b=st(({b2bFeatures:u})=>u.masqueradeCompany.isAgenting),P=st(({company:u})=>u.companyInfo.id),O=st(({company:u})=>u.customer.customerGroupId),{shoppingListCreateActionsPermission:J,purchasabilityPermission:p,submitShoppingListPermission:Z}=st(Qt),V=c.useRef(null),[z,T]=c.useState(!1),w=Qe.get("cartId"),G=n?{alignItems:"flex-start",flexDirection:"column"}:{alignItems:"center"},{shoppingListInfo:h,allowJuniorPlaceOrder:a,checkedArr:r,selectedSubTotal:g,setLoading:k,setDeleteOpen:D,setValidateFailureProducts:d,setValidateSuccessProducts:ct,isB2BUser:R,customColor:C,isCanEditShoppingList:L,role:q,backendValidationEnabled:j}=y,U=R?J:!0,tt=R?p:!0,_=R?Z:Number(q)===2,W=()=>{r.length===0?A.error(s("shoppingList.footer.selectOneItem")):T(!0)},N=()=>{T(!1)},it=u=>{const M=[],K=[];return r.forEach(dt=>{const{node:v}=dt,F=u.find(Y=>Y.variantSku===v.variantSku)||{};if(F){let Y=!0;F.isStock==="1"&&(v!=null&&v.quantity?Number(v.quantity):0)>F.stock&&(Y=!1),F.minQuantity!==0&&(v!=null&&v.quantity?Number(v.quantity):0)<F.minQuantity&&(Y=!1),F.maxQuantity!==0&&(v!=null&&v.quantity?Number(v.quantity):0)>F.maxQuantity&&(Y=!1),Y?K.push({node:v}):M.push({node:{...v},stock:F.stock,isStock:F.isStock,maxQuantity:F.maxQuantity,minQuantity:F.minQuantity})}}),{validateFailureArr:M,validateSuccessArr:K}},ot=async u=>{if(o["B2B-3318.move_stock_and_backorder_validation_to_backend"]){const M=await cs(u,s);return ne(M),M.length>0}return ne(u),!0},E=()=>{a&&_&&(h==null?void 0:h.status)===gt.Approved?window.location.href=fe:(A.success(s("shoppingList.footer.productsAddedToCart"),{action:{label:s("shoppingList.reAddToCart.viewCart"),onClick:()=>{window.b2b.callbacks.dispatchEvent("on-click-cart-button")&&(window.location.href=be)}}}),qt())},yt=async()=>{try{const u=[];let M="";if(r.forEach(F=>{const{node:Y}=F;Y.productsSearch.availability==="disabled"&&(M+="".concat(Y.variantSku,",")),u.push(Y.variantSku)}),M){A.error(s("shoppingList.footer.unavailableProducts",{skus:M.slice(0,-1)}));return}if(u.length===0){A.error(s(a?"shoppingList.footer.selectItemsToCheckout":"shoppingList.footer.selectItemsToAddToCart"));return}const K=await Me(u),{validateFailureArr:dt,validateSuccessArr:v}=it((K==null?void 0:K.variantSku)||[]);if(v.length!==0){const F=Ut(v),Y=oe(w),xt=await re();let lt=null;a&&xt.length?(await ae(Y),lt=await ce(xt,F)):(lt=await Mt(F),qt()),lt&&lt.errors?A.error(lt.errors[0].message):dt.length===0&&E()}d(dt),ct(v)}finally{k(!1)}},Lt=async()=>{const u=r.map(({node:M})=>({node:M}));try{if(u.map(({node:F})=>F.variantSku).length===0){A.error(s(a?"shoppingList.footer.selectItemsToCheckout":"shoppingList.footer.selectItemsToAddToCart"));return}const K=Ut(u),dt=oe(u),v=await re();a&&v.data.site.cart?(await ae(dt),await ce(v,K)):(await Mt(K),qt()),E()}catch(M){M instanceof Error&&(d(u),A.error(M.message))}finally{k(!1)}ct(u)},vt=async()=>{if(r.length===0){A.error(s("shoppingList.footer.selectOneItem"));return}N(),k(!0),j?await Lt():await yt()},kt=u=>(u==null?void 0:u.length)===0?[]:u.map(({option_id:K,option_value:dt})=>({optionId:K,optionValue:dt})),Nt=async()=>{if(r.length===0){A.error(s("shoppingList.footer.selectOneItem"));return}k(!0),N();try{const u=r.filter(S=>{const{node:{variantSku:m}}=S;return m!==""&&m!==null&&m!==void 0}),M=r.filter(S=>{const{node:{variantSku:m}}=S;return!m});if(M.length>0&&A.error(s("shoppingList.footer.cantAddProductsNoSku")),M.length===r.length)return;const K=[];u.forEach(S=>{const{node:m}=S;K.includes(Number(m.productId))||K.push(Number(m.productId))});const{productsSearch:dt}=await Le({productIds:K,companyId:P,customerGroupId:O}),v=Ce(dt);let F="",Y=!0;const xt=[];u.forEach(S=>{const{node:{basePrice:m,optionList:X,variantSku:at,productId:H,productName:ft,quantity:Et,variantId:Bt,tax:Jt}}=S,Ot=kt(JSON.parse(X)),Dt=v.find(x=>Number(x.id)===Number(H)),Ct=Dt==null?void 0:Dt.variants.find(x=>x.sku===at);Ct||(F=s("shoppingList.footer.notFoundSku",{sku:at}),Y=!1);const e={node:{id:Ve(),variantSku:(Ct==null?void 0:Ct.sku)||at,variantId:Bt,productsSearch:{...Dt,newSelectOptionList:Ot,variantId:Bt},primaryImage:(Ct==null?void 0:Ct.image_url)||_t,productName:ft,quantity:Number(Et)||1,optionList:JSON.stringify(Ot),productId:H,basePrice:m,tax:Jt}};xt.push(e)});const lt=Ue(xt);if(!Y){A.error(F);return}lt?(await Pe(xt,"2"),await ot(xt)&&A.success(s("shoppingList.footer.productsAddedToQuote"),{action:{label:s("shoppingList.footer.viewQuote"),onClick:()=>{i("/quoteDraft")}}})):A.error(s("shoppingList.footer.productsLimit"),{action:{label:s("shoppingList.footer.viewQuote"),onClick:()=>{i("/quoteDraft")}}})}catch(u){rs.error(u)}finally{k(!1)}},rt={adSelectedToCart:{name:s("shoppingList.footer.addToCart"),key:"add-selected-to-cart",handleClick:vt,isDisabled:!1},proceedToCheckout:{name:s("shoppingList.footer.proceedToCheckout"),key:"add-select-to-checkout",handleClick:vt,isDisabled:!1},addSelectedToQuote:{name:s("shoppingList.footer.addToQuote"),key:"add-selected-to-quote",handleClick:Nt,isDisabled:!1}},Q=(h==null?void 0:h.status)===gt.Approved||!R?!tt&&R?l?[rt.addSelectedToQuote]:[]:_?a&&l?[rt.proceedToCheckout,rt.addSelectedToQuote]:a?[rt.proceedToCheckout]:l?[rt.addSelectedToQuote]:[]:l?[rt.adSelectedToCart,rt.addSelectedToQuote]:[rt.adSelectedToCart]:[];return t.jsxs(pt,{sx:{position:"fixed",bottom:n&&b?"52px":0,left:0,backgroundColor:"#fff",width:"100%",padding:n?"0 0 1rem 0":"0 40px 1rem 40px",height:n?"8rem":"auto",marginLeft:0,display:"flex",flexWrap:"nowrap",zIndex:"999"},container:!0,spacing:2,children:[t.jsx(pt,{item:!0,sx:{display:n?"none":"block",width:"290px",paddingLeft:"20px"}}),t.jsx(pt,{item:!0,sx:n?{flexBasis:"100%"}:{flexBasis:"690px",flexGrow:1},children:t.jsxs(f,{sx:{width:"100%",pr:"20px",display:"flex",zIndex:"999",justifyContent:"space-between",...G},children:[t.jsx($,{sx:{color:"#000000",fontSize:"16px",fontWeight:"400"},children:s("shoppingList.footer.selectedProducts",{quantity:r.length})}),t.jsxs(f,{sx:{display:"flex",alignItems:"center",flexWrap:n?"wrap":"nowrap"},children:[t.jsx($,{variant:"h6",sx:{fontSize:"16px",fontWeight:"700",color:"#000000"},children:s("shoppingList.footer.subtotal",{subtotal:Tt(g)})}),t.jsxs(f,{sx:{display:"flex",alignItems:"center",marginTop:n?"0.5rem":0,width:n?"100%":"auto"},children:[!a&&L&&U&&t.jsx(At,{sx:{padding:"5px",border:"1px solid ".concat(C||"#1976d2"),margin:n?"0 1rem 0 0":"0 1rem",minWidth:"auto"},disabled:(h==null?void 0:h.status)===gt.ReadyForApproval,children:t.jsx(Ht,{color:"primary",sx:{color:C},onClick:()=>{D(!0)}})}),Q.length?t.jsxs(f,{sx:{display:"flex",alignItems:"center",marginTop:n?"0.5rem":0,marginLeft:n?0:"20px",width:n?"100%":"auto"},children:[Q.length===1&&Q[0]&&t.jsx(At,{variant:"contained",onClick:Q[0].handleClick,sx:{marginRight:n?"1rem":0,width:n?"100%":"auto"},children:Q[0].name}),Q.length===2&&t.jsxs(t.Fragment,{children:[t.jsx(At,{variant:"contained",onClick:W,ref:V,sx:{marginRight:n?"1rem":0,width:n?"100%":"auto"},endIcon:t.jsx(gs,{}),children:s("shoppingList.footer.addSelectedTo")}),t.jsx(Be,{id:"basic-menu",anchorEl:V.current,open:z,onClose:N,MenuListProps:{"aria-labelledby":"basic-button"},children:Q.length>1&&Q.map(u=>t.jsx(Oe,{onClick:()=>{u.handleClick()},children:u.name},u.key))})]})]}):null]})]})]})}),t.jsx(pt,{item:!0,sx:n?{flexBasis:"100%",display:n?"none":"block"}:{flexBasis:"340px",display:n?"none":"block"}})]})}const Ts=Rt("div")(()=>({display:"flex",alignItems:"center"}));function ws(y){var k;const n=It(),[s]=wt(),{shoppingListInfo:i,customerInfo:o,handleUpdateShoppingList:l,goToShoppingLists:b,isB2BUser:P,setOpenPage:O,openAPPParams:J,customColor:p}=y,{state:{portalStyle:{backgroundColor:Z="#FEF9F5"}}}=c.useContext($e),V=te(),{selectCompanyHierarchyId:z}=st(({company:D})=>D.companyHierarchyInfo),{submitShoppingListPermission:T,approveShoppingListPermission:w}=st(Qt),G=c.useMemo(()=>{if(P){const D=(i==null?void 0:i.companyInfo)||{},{submitShoppingListPermission:d,approveShoppingListPermission:ct}=Wt,R=ze({code:d,userId:Number((o==null?void 0:o.userId)||0),selectId:Number(z)}),C=Kt({code:ct,companyId:Number((D==null?void 0:D.companyId)||0),userId:Number((o==null?void 0:o.userId)||0)});return{submitShoppingListPermission:R,approveShoppingListPermission:C}}return{submitShoppingListPermission:T,approveShoppingListPermission:w}},[o,P,T,w,i==null?void 0:i.companyInfo,z]),h=((k=i==null?void 0:i.products)==null?void 0:k.edges.length)===0,{submitShoppingListPermission:a,approveShoppingListPermission:r}=G,g=D=>s?{}:{xs:D};return t.jsxs(t.Fragment,{children:[t.jsx(f,{sx:{marginBottom:"16px",width:"fit-content"},children:t.jsxs(f,{sx:{color:"#1976d2",cursor:"pointer",display:"flex",alignItems:"center"},onClick:()=>{J.shoppingListBtn!=="add"?b():(V("/"),O({isOpen:!1,openUrl:""}))},children:[t.jsx(ms,{fontSize:"small",sx:{fontSize:"12px",marginRight:"0.5rem",color:p}}),t.jsx(f,{sx:{margin:0,color:p,m:"0"},children:J.shoppingListBtn!=="add"?n("shoppingList.header.backToShoppingLists"):n("shoppingList.header.backToProduct")})]})}),t.jsxs(pt,{container:!0,spacing:2,sx:{display:"flex",justifyContent:"space-between",flexDirection:s?"column":"row",mb:s?"16px":""},children:[t.jsxs(pt,{item:!0,...g(8),sx:{color:_e(Z)},children:[t.jsxs(f,{sx:{display:"flex",alignItems:s?"start":"center",flexDirection:s?"column":"row"},children:[t.jsx($,{variant:"h4",sx:{marginRight:"1rem",wordBreak:"break-all"},children:"".concat((i==null?void 0:i.name)||"")}),P&&(a||r&&(i==null?void 0:i.approvedFlag))&&t.jsx($,{sx:{m:s?"10px 0":"0"},children:i&&t.jsx(fs,{status:i==null?void 0:i.status})})]}),t.jsxs(f,{children:[t.jsx($,{sx:{width:"100%",wordBreak:"break-all"},children:i==null?void 0:i.description}),P&&t.jsxs(Ts,{children:[t.jsx($,{variant:"subtitle2",sx:{marginRight:"0.5rem"},children:n("shoppingList.header.createdBy")}),t.jsx("span",{children:"".concat((o==null?void 0:o.firstName)||""," ").concat((o==null?void 0:o.lastName)||"")})]})]})]}),t.jsxs(pt,{item:!0,sx:{textAlign:s?"none":"end"},...g(4),children:[a&&(i==null?void 0:i.status)===gt.Draft&&t.jsx(At,{variant:"outlined",disabled:h,onClick:()=>{l(gt.ReadyForApproval)},children:n("shoppingList.header.submitForApproval")}),r&&(i==null?void 0:i.status)===gt.ReadyForApproval&&t.jsxs(f,{children:[t.jsx(At,{variant:"outlined",sx:{marginRight:"1rem"},onClick:()=>{l(gt.Rejected)},children:n("shoppingList.header.reject")}),r&&t.jsx(At,{variant:"outlined",onClick:()=>{l(gt.Approved)},children:n("shoppingList.header.approve")})]})]})]})]})}function Ns(y){const n=It(),[s]=wt(),{open:i,notes:o,setNotes:l,handleCancelAddNotesClick:b,handleAddItemNotesClick:P}=y;return t.jsx(Xt,{isOpen:i,title:n("shoppingList.addItemNotes.title"),leftSizeBtn:n("shoppingList.addItemNotes.cancel"),rightSizeBtn:n("shoppingList.addItemNotes.save"),handleLeftClick:b,handRightClick:P,isShowBordered:!1,children:t.jsx(f,{sx:{display:"flex",width:s?"100%":"450px",height:"100%"},children:t.jsx(Yt,{multiline:!0,rows:6,defaultValue:o,onChange:O=>l(O.target.value),variant:"filled",fullWidth:!0,placeholder:n("shoppingList.addItemNotes.placeholder")})})})}const Bs=Rt("img")(()=>({maxWidth:"60px",height:"auto",marginRight:"0.5rem"}));function Os(y){const n=It(),{item:s,onEdit:i,onDelete:o,checkBox:l,handleUpdateProductQty:b,handleUpdateShoppingListItem:P,isReadForApprove:O,len:J,itemIndex:p,setDeleteOpen:Z,setAddNoteOpen:V,setAddNoteItemId:z,setNotes:T,showPrice:w,b2bAndBcShoppingListActionsPermissions:G}=y,{basePrice:h,quantity:a,itemId:r,variantId:g,primaryImage:k,productName:D,variantSku:d,productsSearch:ct,productUrl:R,taxPrice:C=0,productNote:L}=s,q=$t(Number(h),Number(C)),j=q*Number(a),U={...s.productsSearch,selectOptions:s.optionList},tt=Zt(U,{}),_=JSON.parse(s.optionList),W=tt.filter(E=>E.valueText),N=_.length>0&&!O&&G,it=U.variants||[],ot=ve(it,{variantId:g,variantSku:d})||k;return t.jsx(f,{sx:{borderTop:"1px solid #D9DCE9",borderBottom:p===J-1?"1px solid #D9DCE9":""},children:t.jsxs(ge,{sx:{color:"#313440",display:"flex",pl:0},children:[t.jsx(f,{children:l&&l()}),t.jsx(f,{children:t.jsx(Bs,{src:ot||_t,alt:"Product-img",loading:"lazy"})}),t.jsxs(f,{sx:{flex:1},children:[t.jsx($,{variant:"body1",color:"#212121",onClick:()=>{const{location:{origin:E}}=window;window.location.href="".concat(E).concat(R)},sx:{cursor:"pointer"},children:D}),t.jsx($,{variant:"body1",color:"#616161",children:d}),t.jsx(f,{sx:{margin:"0 0 0.5rem 0"},children:_.length>0&&W.length>0&&t.jsx(f,{children:W.map(E=>t.jsx($,{sx:{fontSize:"0.75rem",lineHeight:"1.5",color:"#455A64"},children:"".concat(E.valueLabel,": ").concat(E.valueText)},E.valueLabel))})}),L&&L.trim().length>0&&t.jsx($,{sx:{fontSize:"0.75rem",color:"#ED6C02",marginTop:"0.3rem",marginBottom:"0.3rem"},children:L}),t.jsx($,{sx:{color:"#212121",fontSize:"14px"},children:n("shoppingList.shoppingDetailCard.price",{price:w(Tt(q),s)})}),t.jsx(Yt,{size:"small",type:"number",variant:"filled",label:n("shoppingList.shoppingDetailCard.quantity"),disabled:G?O:!0,inputProps:{inputMode:"numeric",pattern:"[0-9]*"},value:a,sx:{margin:"0.5rem 0",width:"60%",maxWidth:"100px","& label":{zIndex:0,fontSize:"14px"},"& input":{fontSize:"14px"}},onChange:E=>{b(s.id,E.target.value)},onBlur:()=>{P(r)}}),t.jsx($,{sx:{color:"#212121",fontSize:"14px"},children:n("shoppingList.shoppingDetailCard.total",{total:w(Tt(j),s)})}),t.jsxs(f,{sx:{marginTop:"11px",textAlign:"end"},id:"shoppingList-actionList-mobile",children:[G&&t.jsx(je,{sx:{marginRight:"0.5rem",cursor:"pointer",color:"rgba(0, 0, 0, 0.54)"},onClick:()=>{V(!0),z(Number(r)),L&&T(L)}}),N&&t.jsx(Ie,{sx:{marginRight:N?"0.5rem":"",marginLeft:N?"0.3rem":"",cursor:"pointer",color:"rgba(0, 0, 0, 0.54)"},onClick:()=>{i({...ct,selectOptions:_,quantity:a},g,r)}}),G&&!O&&t.jsx(Ht,{sx:{marginLeft:"0.3rem",cursor:"pointer",color:"rgba(0, 0, 0, 0.54)"},onClick:()=>{Z(!0),o(Number(r))}})]})]})]})},s.id)}const Ds=Rt("div")(()=>({backgroundColor:"#FFFFFF",padding:"1rem",borderRadius:"4px",boxShadow:"0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px rgba(0, 0, 0, 0.14), 0px 1px 3px rgba(0, 0, 0, 0.12)","& tbody":{"& tr":{"& td":{verticalAlign:"top"},"& td: first-of-type":{paddingTop:"25px"}},"& tr: hover":{"& #shoppingList-actionList":{opacity:1}}}})),qs=Rt("img")(()=>({maxWidth:"60px",height:"auto",marginRight:"0.5rem"})),Es=Rt(Yt)(()=>({"& input":{paddingTop:"12px",paddingRight:"6px"}})),ue="updatedAt",he={Product:"productName",updatedAt:"updatedAt",Qty:"quantity"};function Fs(y,n){var Ct;const[s]=wt(),i=It(),{shoppingListInfo:o,isRequestLoading:l,setIsRequestLoading:b,shoppingListId:P,getShoppingListDetails:O,setCheckedArr:J,isReadForApprove:p,setDeleteItemId:Z,setDeleteOpen:V,isJuniorApprove:z,isB2BUser:T,allowJuniorPlaceOrder:w,productQuoteEnabled:G,isCanEditShoppingList:h,role:a}=y,r=st(({global:e})=>e.showInclusiveTaxPrice),{shoppingListCreateActionsPermission:g,submitShoppingListPermission:k}=st(Qt),D=T?g&&h:!0,d=T?D:!0,ct=T?k:Number(a)===2,R=c.useRef(null),[C,L]=c.useState(!1),[q,j]=c.useState(null),[U,tt]=c.useState(null),[_,W]=c.useState({orderBy:"-".concat(he[ue])}),[N,it]=c.useState(!0),[ot,E]=c.useState([]),[yt,Lt]=c.useState(0),[vt,kt]=c.useState(!1),[Nt,rt]=c.useState(""),[mt,Q]=c.useState(""),[u,M]=c.useState(!1),[K,dt]=c.useState(!1),[v,F,Y]=Ss(he,ue,_,W),xt=(e,x)=>{var et,Vt,jt;if(Number(x)<0)return;const B=ot.find(ht=>{const{node:St}=ht;return St.id===e}),I=((et=B==null?void 0:B.node)==null?void 0:et.quantity)||"";it(Number(I)===Number(x));const ut=((Vt=R.current)==null?void 0:Vt.getList())||[],nt=ut==null?void 0:ut.map(ht=>{const{node:St}=ht;return(St==null?void 0:St.id)===e&&(St.quantity="".concat(Number(x)),St.disableCurrentCheckbox=Number(x)===0),ht}),bt=nt.filter(ht=>Number(ht.node.quantity)===0);M(bt.length===nt.length),(jt=R.current)==null||jt.setList([...nt])},lt=e=>{var x;(x=R.current)==null||x.refresh(e)};c.useImperativeHandle(n,()=>({initSearch:lt,getList:()=>{var e;return(e=R.current)==null?void 0:e.getList()},setList:()=>{var e;return(e=R.current)==null?void 0:e.setList()},getSelectedValue:()=>{var e;return(e=R.current)==null?void 0:e.getSelectedValue()}}));const S=async e=>{W({..._,search:e})},m=()=>{tt(""),L(!1)},X=(e,x,B)=>{tt(B),j(e),L(!0)},at=async e=>{b(!0);const x=T?de:le;try{const B=Gt(e[0].newSelectOptionList,e[0]),I={itemId:U,shoppingListId:P,itemData:{variantId:e[0].variantId,quantity:e[0].quantity,optionList:B||[]}};await x(I),L(!1),tt(""),A.success(i("shoppingList.table.productUpdated")),lt({keepCheckedItems:!0})}finally{b(!1)}},H=async e=>{var jt;const B=(((jt=R.current)==null?void 0:jt.getList())||[]).find(ht=>{const{node:St}=ht;return St.itemId===e});let I;B&&(I=B.node);const nt=JSON.parse((I==null?void 0:I.optionList)||"[]").map(ht=>({optionId:ht.option_id,optionValue:ht.option_value})),bt={variantId:I==null?void 0:I.variantId,quantity:I!=null&&I.quantity?Number(I.quantity):0,optionList:nt||[],productNote:mt};await(T?de:le)({itemId:e,shoppingListId:P,itemData:bt})},ft=async e=>{if(!N){b(!0);try{await H(e),A.success(i("shoppingList.table.quantityUpdated")),it(!0),lt({keepCheckedItems:!0})}finally{b(!1)}}},Et=e=>{var x;if(e.length>0){const B=((x=R.current)==null?void 0:x.getList())||[],I=[];e.forEach(ut=>{const nt=B.find(bt=>{const{node:et}=bt;return et.id===ut});nt&&I.push(nt)}),J([...I])}else J([])},Bt=()=>{kt(!1),rt(""),Q("")},Jt=async()=>{b(!0);try{Bt(),await H(Nt),A.success(i("shoppingList.table.productNotesUpdated")),lt({keepCheckedItems:!0})}finally{b(!1)}};c.useEffect(()=>{if(o){const{products:{edges:e},grandTotal:x,totalTax:B}=o,I=r?Number(x):Number(x)-Number(B)||0,ut=e.some(nt=>{var bt,et;return(bt=nt==null?void 0:nt.node)!=null&&bt.productsSearch&&((et=nt.node.productsSearch)==null?void 0:et.isPriceHidden)||!1});dt(ut),E(bs(e)),Lt(I)}},[o,r]),c.useEffect(()=>{if(o){const{products:{edges:e}}=o,x=e.filter(B=>B.node.quantity===0);M(x.length===e.length)}},[o]);const Ot=(e,x)=>{const{productsSearch:{isPriceHidden:B}}=x;return B?"":Je({price:e,productInfo:x,showText:B?"":e,forcedSkip:!0})},Dt=[{key:"Product",title:i("shoppingList.table.product"),render:e=>{const x={...e.productsSearch,selectOptions:e.optionList},B=Zt(x,{}),I=JSON.parse(e.optionList),ut=B.filter(et=>et.valueText),nt=x.variants||[],bt=ve(nt,{variantId:e.variantId,variantSku:e.variantSku})||e.primaryImage;return t.jsxs(f,{sx:{display:"flex",alignItems:"flex-start"},children:[t.jsx(qs,{src:bt||_t,alt:"Product-img",loading:"lazy"}),t.jsxs(f,{children:[t.jsx($,{variant:"body1",color:"#212121",onClick:()=>{const{location:{origin:et}}=window;window.location.href="".concat(et).concat(e.productUrl)},sx:{cursor:"pointer"},children:e.productName}),t.jsx($,{variant:"body1",color:"#616161",children:e.variantSku}),I.length>0&&ut.length>0&&t.jsx(f,{children:ut.map(et=>t.jsx($,{sx:{fontSize:"0.75rem",lineHeight:"1.5",color:"#455A64"},children:"".concat(et.valueLabel,": ").concat(et.valueText)},et.valueLabel))}),(e==null?void 0:e.productNote)&&(e==null?void 0:e.productNote.trim().length)>0&&t.jsx($,{sx:{fontSize:"0.75rem",color:"#ED6C02",marginTop:"0.3rem"},children:e.productNote})]})]})},width:"45%",isSortable:!0},{key:"Price",title:i("shoppingList.table.price"),render:e=>{const{basePrice:x,taxPrice:B=0}=e,I=$t(Number(x),Number(B));return t.jsx($,{sx:{padding:"12px 0"},children:Ot(Tt(I),e)})},width:"15%",style:{textAlign:"right"}},{key:"Qty",title:i("shoppingList.table.quantity"),render:e=>t.jsx(Es,{size:"small",type:"number",variant:"filled",sx:{width:"72px"},disabled:d?p||z:!0,value:e.quantity,inputProps:{inputMode:"numeric",pattern:"[0-9]*"},onChange:x=>{xt(e.id,x.target.value)},onBlur:()=>{ft(e.itemId)}}),width:"15%",style:{textAlign:"right"},isSortable:!0},{key:"Total",title:i("shoppingList.table.total"),render:e=>{const{basePrice:x,quantity:B,itemId:I,productsSearch:{options:ut},taxPrice:nt=0}=e,et=$t(Number(x),Number(nt))*Number(B),jt=(ut||JSON.parse(e.optionList)).length>0&&!p&&!z&&d;return t.jsxs(f,{children:[t.jsx($,{sx:{padding:"12px 0"},children:Ot(Tt(et),e)}),t.jsx(f,{sx:{marginTop:"1rem",opacity:0,textAlign:s?"end":"start",display:"flex",justifyContent:"flex-end"},id:"shoppingList-actionList",children:D&&t.jsxs(t.Fragment,{children:[t.jsx(pt,{item:!0,sx:{marginRight:"0.5rem",minWidth:"32px"},children:t.jsx(je,{sx:{cursor:"pointer",color:"rgba(0, 0, 0, 0.54)"},onClick:()=>{kt(!0),rt(Number(I)),e.productNote&&Q(e.productNote)}})}),t.jsx(pt,{item:!0,sx:{marginRight:jt?"0.5rem":"",marginLeft:jt?"0.3rem":""},children:jt&&t.jsx(Ie,{sx:{cursor:"pointer",color:"rgba(0, 0, 0, 0.54)"},onClick:()=>{const{productsSearch:ht,variantId:St,itemId:Ae,optionList:Te,quantity:we}=e;X({...ht,selectOptions:Te,quantity:we},St,Ae)}})}),t.jsx(pt,{item:!0,sx:{marginLeft:"0.3rem"},children:d&&!p&&!z&&t.jsx(Ht,{sx:{cursor:"pointer",color:"rgba(0, 0, 0, 0.54)"},onClick:()=>{V(!0),Z(Number(I))}})})]})})]})},width:"15%",style:{textAlign:"right"}}];return t.jsxs(Ds,{children:[t.jsxs(f,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",margin:"0 0 1rem 0"},children:[t.jsx($,{sx:{fontSize:"24px"},children:i("shoppingList.table.totalProductCount",{quantity:((Ct=o==null?void 0:o.products)==null?void 0:Ct.totalCount)||0})}),t.jsx($,{sx:{fontSize:"24px"},children:K?"":Tt(yt||0)})]}),t.jsx(f,{sx:{marginBottom:"5px"},children:t.jsx(ys,{searchBGColor:"rgba(0, 0, 0, 0.06)",handleChange:e=>{S(e)}})}),t.jsx(He,{ref:R,columnItems:Dt,rowsPerPageOptions:[10,20,50],getRequestList:O,searchParams:_,isCustomRender:!1,showCheckbox:!0,showSelectAllCheckbox:!0,applyAllDisableCheckbox:!1,disableCheckbox:u||(ct?!(w||G):(p||z)&&d),hover:!0,labelRowsPerPage:i("shoppingList.table.itemsPerPage"),showBorder:!1,requestLoading:b,getSelectCheckbox:Et,itemIsMobileSpacing:0,noDataText:i("shoppingList.table.noProductsFound"),sortDirection:F,orderBy:Y,sortByFn:v,pageType:"shoppingListDetailsTable",renderItem:(e,x,B)=>{var I;return t.jsx(Os,{len:((I=o==null?void 0:o.products)==null?void 0:I.edges.length)||0,item:e,itemIndex:x,showPrice:Ot,onEdit:X,onDelete:Z,checkBox:B,setDeleteOpen:V,setAddNoteOpen:kt,setAddNoteItemId:rt,setNotes:Q,handleUpdateProductQty:xt,handleUpdateShoppingListItem:ft,isReadForApprove:p||z,b2bAndBcShoppingListActionsPermissions:d})}}),t.jsx(us,{isOpen:C,isLoading:l,setIsLoading:b,product:q,type:"shoppingList",onCancel:m,onConfirm:at,isEdit:!0}),t.jsx(Ns,{open:vt,notes:mt,setNotes:Q,handleCancelAddNotesClick:Bt,handleAddItemNotesClick:Jt})]})}const Rs=c.forwardRef(Fs),Qs=y=>{if(y.length>0){let n=0;return y.forEach(s=>{const{node:{quantity:i,basePrice:o,taxPrice:l}}=s,b=$t(Number(o),Number(l));n+=b*Number(i)}),1e3*n/1e3}return 0};function Vs(){const{id:y=""}=xs(),{state:{openAPPParams:n,productQuoteEnabled:s=!1}}=c.useContext(ye),i=st(We),{currency_code:o}=st(me),l=st(({company:a})=>a.customer.role),b=st(({company:a})=>a.companyInfo.id),P=st(({company:a})=>a.customer.customerGroupId),O=st(({b2bFeatures:a})=>a.masqueradeCompany.isAgenting),p=De().palette.primary.main,{shoppingListCreateActionsPermission:Z,purchasabilityPermission:V,submitShoppingListPermission:z}=st(Qt);return{id:y,openAPPParams:n,productQuoteEnabled:s,isB2BUser:i,role:l,isAgenting:O,primaryColor:p,shoppingListCreateActionsPermission:Z,submitShoppingListPermission:z,isCanAddToCart:i?V:!0,getProducts:async a=>{const r={productIds:a,currencyCode:o,companyId:b,customerGroupId:P},{productsSearch:g}=await Le(r);return Ce(g)},getShoppingList:a=>{const r={...a,id:y};return i?ns(r):os(r)},deleteShoppingListItem:a=>{const r={itemId:a,shoppingListId:y};return i?ss(r):is(r)}}}function Us({setOpenPage:y}){const{id:n,openAPPParams:s,productQuoteEnabled:i,isB2BUser:o,role:l,isAgenting:b,primaryColor:P,shoppingListCreateActionsPermission:O,submitShoppingListPermission:J,isCanAddToCart:p,getProducts:Z,getShoppingList:V,deleteShoppingListItem:z}=Vs(),T=te(),[w]=wt(),{dispatch:G}=c.useContext(ke),h=It(),a=c.useRef(null),g=Se()["B2B-3318.move_stock_and_backorder_validation_to_backend"],[k,D]=c.useState([]),[d,ct]=c.useState(null),[R,C]=c.useState(null),[L,q]=c.useState(!1),[j,U]=c.useState(!1),[tt,_]=c.useState(""),[W,N]=c.useState([]),[it,ot]=c.useState([]),[E,yt]=c.useState(!1),[Lt,vt]=c.useState(!0),kt=o?O&&Lt:!0,Nt=c.useMemo(()=>{if(o&&d){const{companyInfo:S,customerInfo:m}=d,{submitShoppingListPermission:X}=Wt;return Kt({code:X,companyId:Number((S==null?void 0:S.companyId)||0),userId:Number((m==null?void 0:m.userId)||0)})}return J},[J,o,d]),rt=o?Nt:l===Ge.JUNIOR_BUYER,mt=(d==null?void 0:d.status)===gt.Approved&&rt,Q=(d==null?void 0:d.status)===gt.ReadyForApproval||(d==null?void 0:d.status)===gt.Rejected||(d==null?void 0:d.status)===gt.Deleted,u=()=>{T("/shoppingLists")};c.useEffect(()=>{G({type:"init",payload:{id:parseInt(n,10)||0}})},[n]);const M=async S=>{if(S.length>0)try{const m=[];S.forEach(at=>{const{node:H}=at;m.includes(H.productId)||m.push(H.productId)});const X=await Z(m);return S.forEach(at=>{const{node:H}=at,ft=X.find(Et=>{const{id:Bt}=Et;return H.productId===Bt});H.productsSearch=ft||{},H.productName=(ft==null?void 0:ft.name)||H.productName,H.productUrl=(ft==null?void 0:ft.productUrl)||H.productUrl,H.disableCurrentCheckbox=!1,H.quantity===0&&(H.disableCurrentCheckbox=!0)}),S}catch(m){A.error(m)}return[]},K=async S=>{const m=await V(S);q(!0);const{products:{edges:X,totalCount:at}}=m,H=await M(X);return await Pe(H,"2"),o&&C(m.customerInfo),ct(m),q(!1),H?{edges:H,totalCount:at}:{edges:[],totalCount:0}},dt=async S=>{var m;q(!0);try{const X={id:Number(n),name:(d==null?void 0:d.name)||"",description:(d==null?void 0:d.description)||""};o?await ts({...X,status:S}):await es({...X,channelId:Ke}),A.success(h("shoppingList.shoppingListStatusUpdated")),(m=a.current)==null||m.initSearch()}finally{q(!1)}},v=()=>{var S;(S=a.current)==null||S.initSearch()},F=()=>{U(!1),_("")},Y=async(S="")=>{q(!0);try{if(S){if(await z(S),k.length>0){const m=k.filter(X=>{const{itemId:at}=X.node;return S!==at});D([...m])}}else{if(k.length===0)return;k.forEach(async m=>{const{node:X}=m;await z(X.itemId)}),D([])}A.success(h("shoppingList.productRemoved"))}finally{q(!1),v()}},xt=async()=>{await Y(Number(tt)),await F()},lt=async()=>{const{storeConfigSwitchStatus:{isEnabled:S}}=await Ze();yt(S==="1"&&p)};return c.useEffect(()=>{mt&&lt()},[mt]),c.useEffect(()=>{if(o&&d){const{companyInfo:S,customerInfo:m}=d,{shoppingListCreateActionsPermission:X}=Wt,at=Kt({code:X,companyId:Number((S==null?void 0:S.companyId)||0),userId:Number((m==null?void 0:m.userId)||0)});vt(at)}},[d,o]),t.jsxs(t.Fragment,{children:[t.jsxs(f,{sx:{display:"flex",flexDirection:"column",flex:1},children:[t.jsx(ws,{isB2BUser:o,shoppingListInfo:d,customerInfo:R,role:l,goToShoppingLists:u,handleUpdateShoppingList:dt,setOpenPage:y,isAgenting:b,openAPPParams:s,customColor:P}),t.jsxs(pt,{container:!0,spacing:2,sx:{marginTop:"0",overflow:"auto",flexWrap:w?"wrap":"nowrap",paddingBottom:"20px",marginBottom:w?"6rem":0},children:[t.jsx(f,{sx:w?{flexBasis:"100%",pl:"16px"}:{flexBasis:"690px",flexGrow:1,ml:"16px",pt:"16px"},children:t.jsx(xe,{isSpinning:L,spinningHeight:"auto",children:t.jsx(pt,{item:!0,sx:w?{flexBasis:"100%"}:{flexBasis:"690px",flexGrow:1},children:t.jsx(Rs,{ref:a,isReadForApprove:Q,isJuniorApprove:mt,allowJuniorPlaceOrder:E,setCheckedArr:D,shoppingListInfo:d,isRequestLoading:L,setIsRequestLoading:q,shoppingListId:n,getShoppingListDetails:K,setDeleteOpen:U,setDeleteItemId:_,isB2BUser:o,productQuoteEnabled:i,isCanEditShoppingList:Lt,role:l})})})}),t.jsx(pt,{item:!0,sx:w?{flexBasis:"100%"}:{flexBasis:"340px"},children:kt&&!Q&&!mt&&t.jsx(Cs,{updateList:v,type:"shoppingList",isB2BUser:o})})]}),!Q&&(E||i||!mt)&&t.jsx(As,{shoppingListInfo:d,allowJuniorPlaceOrder:E,checkedArr:k,selectedSubTotal:Qs(k),setLoading:q,setDeleteOpen:U,setValidateFailureProducts:ot,setValidateSuccessProducts:N,isB2BUser:o,customColor:P,isCanEditShoppingList:Lt,role:l,backendValidationEnabled:g})]}),t.jsx(Is,{shoppingListInfo:d,role:l,products:it,successProducts:W.length,allowJuniorPlaceOrder:E,setValidateFailureProducts:ot,setValidateSuccessProducts:N,textAlign:w?"left":"right",backendValidationEnabled:g}),t.jsx(vs,{open:j,handleCancelClick:F,handleDeleteProductClick:xt})]})}function mi({setOpenPage:y}){return t.jsx(ds,{children:t.jsx(Us,{setOpenPage:y})})}export{mi as default};
//# sourceMappingURL=index-GRPrO9O1.js.map
