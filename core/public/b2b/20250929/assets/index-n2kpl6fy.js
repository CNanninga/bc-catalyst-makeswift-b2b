import{j as e,A as es,ae as is,T as J,B as D,w as W,I as O}from"./mui-DjJKBaL-.js";import{r as n}from"./intl-D34a3Rgg.js";import{j as R,B as C,u as j,a2 as V,ad as K,I as H,ak as Q,ao as ns,at as os,aw as ps,ag as as,a as rs,G as ls,af as cs,am as ds,y as hs}from"./react-setup-Ctz-bmMs.js";import{B as us}from"./B3Filter-lpxTHO2P.js";import"./load-functions-utyuqH_X.js";import{S as d,f as gs,g as ms,a as Ls}from"./shoppingList-5c4DgHH6.js";import{a as fs,u as Ss}from"./useTableRef-CsMdwZmB.js";import"./base-CC7kTJh2.js";import{u as Bs}from"./form-pKe_k4Gy.js";import{B as xs}from"./B3CustomForm-BLuJSiae.js";import{S as bs}from"./ShoppingListStatusTag-SPDY5Pv_.js";import{a as ys}from"./router-DcuTQ_yx.js";import{E as Cs,q as Is,f as Ds}from"./muiIcon-BBtg8u0V.js";import"./reactVendor-CkUTLE5B.js";import"./eCache-97HTO8co.js";import"./redux-Bt5-tVzx.js";import"./toolkit-CpEbzTSY.js";import"./lodashEs-CONzB2I0.js";import"../index.js";import"./global-D7Yn0gGb.js";import"./dropzone-B1UJxEDf.js";import"./dateFns-DubixNBV.js";import"./B3FilterMore-a9Nafl2O.js";import"./B3FilterSearch-BPb2-EyD.js";const js=()=>{const s=R();return t=>{const S={value:d.Draft,label:s("global.shoppingLists.status.draft")},r={value:d.Rejected,label:s("global.shoppingLists.status.rejected")};return[{value:99,label:s("global.shoppingLists.status.all")},{value:d.Approved,label:s("global.shoppingLists.status.approved")},...t?[S]:[],{value:d.ReadyForApproval,label:s("global.shoppingLists.status.readyForApproval")},...t?[r]:[]]}},vs=()=>{const s=R(),t=js();return(S,r)=>{var L;return[{name:"createdBy",required:!1,default:"",fieldType:"dropdown",options:((L=r==null?void 0:r.createdByUser)==null?void 0:L.results.map(l=>({createdBy:"".concat(l.firstName," ").concat(l.lastName," (").concat(l.email,")")})))||[],replaceOptions:{label:"createdBy",value:"createdBy"},xs:12,variant:"filled",size:"small",label:s("global.shoppingLists.filter.createdBy")},{name:"status",required:!1,default:"",fieldType:"dropdown",options:t(S),xs:12,variant:"filled",size:"small",label:s("global.shoppingLists.filter.status")}]}},Fs=s=>[{name:"name",label:s("shoppingLists.name"),required:!0,default:"",fieldType:"text",xs:12,variant:"filled",size:"small",maxLength:200},{name:"description",label:s("shoppingLists.description"),required:!1,default:"",fieldType:"multiline",xs:12,variant:"filled",size:"small",rows:4,maxLength:200}],$s="\n  mutation CreateShoppingList ($shoppingListData: ShoppingListsInputType!){\n    shoppingListsCreate (\n      shoppingListData: $shoppingListData\n    ) {\n      shoppingList {\n        id,\n      }\n    }\n  }\n",qs=s=>C.graphqlB2B({query:$s,variables:{shoppingListData:s}}),ws="\n  mutation CreateCustomerShoppingList($shoppingListData: CustomerShoppingListsInputType!) {\n    customerShoppingListsCreate(shoppingListData: $shoppingListData) {\n      shoppingList {\n        id,\n      }\n    }\n  }\n",As=s=>C.graphqlB2B({query:ws,variables:{shoppingListData:{name:s.name,description:s.description,channelId:s!=null&&s.channelId?Number(s.channelId):1}}}),Ps="\n  mutation DuplicateB2BShoppingList($sampleShoppingListId: Int!, $shoppingListData: ShoppingListsDuplicateInputType!){\n    shoppingListsDuplicate(sampleShoppingListId: $sampleShoppingListId, shoppingListData: $shoppingListData) {\n      shoppingList {\n        id,\n      }\n    }\n  }\n",Es=s=>C.graphqlB2B({query:Ps,variables:{sampleShoppingListId:Number(s.sampleShoppingListId),shoppingListData:{name:s.name,description:s.description}}}),ks="\n  mutation DuplicateB2CShoppingList($sampleShoppingListId: Int!, $shoppingListData: ShoppingListsDuplicateInputType!){\n    customerShoppingListsDuplicate(sampleShoppingListId: $sampleShoppingListId, shoppingListData: $shoppingListData) {\n      shoppingList {\n        id,\n      }\n    }\n  }\n",Rs=s=>C.graphqlB2B({query:ks,variables:{sampleShoppingListId:Number(s.sampleShoppingListId),shoppingListData:{name:s.name,description:s.description}}}),Ns="\n  mutation UpdateB2BShoppingList ($id: Int!, $shoppingListData: ShoppingListsInputType!) {\n    shoppingListsUpdate(id: $id, shoppingListData: $shoppingListData) {\n      shoppingList {\n        id\n      }\n    }\n  }\n",Ts=s=>C.graphqlB2B({query:Ns,variables:{id:Number(s.id),shoppingListData:{name:s.name,description:s.description,status:s.status}}}),zs="mutation UpdateB2CShoppingList($id: Int!, $shoppingListData: CustomerShoppingListsInputType!){\n  customerShoppingListsUpdate(id: $id, shoppingListData: $shoppingListData) {\n    shoppingList {\n      id\n    }\n  }\n}",Us=s=>C.graphqlB2B({query:zs,variables:{id:Number(s.id),shoppingListData:{name:s.name,description:s.description,channelId:s!=null&&s.channelId?Number(s.channelId):1}}});function Os({renderList:s,isB2BUser:t},S){const r=j(V),{selectCompanyHierarchyId:h}=j(({company:g})=>g.companyHierarchyInfo),[L,l]=n.useState(!1),[a,x]=n.useState(""),[p,f]=n.useState(null),[v,B]=n.useState(!1),[b,F]=n.useState([]),u=R(),{control:o,handleSubmit:$,getValues:A,formState:{errors:P},clearErrors:T,setValue:I}=Bs({mode:"onSubmit"});n.useEffect(()=>{L&&a!=="add"&&p&&b.forEach(g=>{I(g.name,p[g.name])})},[p,L,I,a,b]);const q=()=>{b.forEach(g=>{I(g.name,"")}),T(),l(!1)},z=()=>{$(async g=>{B(!0);try{const m={...g};let y=t?qs:As,E=u("shoppingLists.addSuccess");if(a==="edit")t?(y=Ts,m.status=p==null?void 0:p.status):(y=Us,m.channelId=H),m.id=(p==null?void 0:p.id)||0,E=u("shoppingLists.updateSuccess");else if(a==="dup")y=t?Es:Rs,m.sampleShoppingListId=(p==null?void 0:p.id)||0,E=u("shoppingLists.duplicateSuccess");else if(a==="add")if(t){const{submitShoppingListPermission:U}=r;h&&(m.companyId=Number(h)),m.status=U?d.Draft:d.Approved}else m.channelId=H;await y(m),q(),Q.success(E),s()}finally{B(!1)}})()},N=(g,m)=>{const y=Fs(u);F(y),m&&f(m),x(g),l(!0)};n.useImperativeHandle(S,()=>({handleOpenAddEditShoppingListsClick:N}));const w=()=>u(a==="edit"?"shoppingLists.edit":a==="add"?"shoppingLists.createNewShoppingList":"shoppingLists.duplicateShoppingList");return e.jsx(K,{isOpen:L,title:w(),leftSizeBtn:u("shoppingLists.cancel"),rightSizeBtn:u("shoppingLists.save"),handleLeftClick:q,handRightClick:z,loading:v,children:e.jsx(xs,{formFields:b,errors:P,control:o,getValues:A,setValue:I})})}const Ms=n.forwardRef(Os),Gs="\n  mutation DeleteShoppingList($id: Int!) {\n    shoppingListsDelete(id: $id) {\n      message\n    }\n  }\n",Hs=s=>C.graphqlB2B({query:Gs,variables:{id:Number(s)}}),Ws="\n  mutation DeleteCustomerShoppingList ($id: Int!) {\n    customerShoppingListsDelete (id: $id) {\n      message\n    }\n  }\n",Vs=s=>C.graphqlB2B({query:Ws,variables:{id:Number(s)}}),Xs=W("div")(()=>({display:"flex",alignItems:"center",justifyContent:"space-between"})),M=W(J)(()=>({fontWeight:"500",paddingRight:"5px"})),G=W(D)(()=>({display:"flex",alignItems:"center",justifyContent:"start"}));function Js(s){const{item:t,onEdit:S,onDelete:r,onCopy:h,isPermissions:L,isB2BUser:l}=s,a=R(),[x,p]=n.useState(!0),{submitShoppingListPermission:f,approveShoppingListPermission:v}=j(V),B=o=>f?!(o===d.Draft||o===d.Approved):o===d.ReadyForApproval,b=o=>f?o===d.Deleted||o===d.Draft||o===d.Rejected:!0,F=ys(),u=o=>F("/shoppingList/".concat(o.id),{state:{from:"shoppingList"}});return n.useEffect(()=>{if(l){const{companyInfo:o,customerInfo:$}=t,{shoppingListCreateActionsPermission:A}=ns,P=os({code:A,companyId:Number((o==null?void 0:o.companyId)||0),userId:Number($.userId)});p(P)}},[t,l]),e.jsx(es,{sx:{"& .b2b-card-content":{paddingBottom:"16px"}},children:e.jsxs(is,{className:"b2b-card-content",sx:{color:"#313440"},children:[e.jsx(J,{variant:"h5",sx:{color:"rgba(0, 0, 0, 0.87)",width:"100%",wordBreak:"break-all"},children:t.name}),e.jsxs(D,{sx:{pt:"8px",pb:"20px"},children:[l&&(f||v&&t.approvedFlag)&&e.jsx(D,{sx:{pb:"25px"},children:e.jsx(bs,{status:t.status})}),e.jsx(D,{sx:{width:"100%",wordBreak:"break-all"},children:t.description}),l&&e.jsxs(G,{children:[e.jsx(M,{children:a("shoppingLists.card.createdBy")}),t.customerInfo.firstName," ",t.customerInfo.lastName]}),e.jsxs(G,{children:[e.jsx(M,{children:a("shoppingLists.card.products")}),t.products.totalCount]}),e.jsxs(G,{children:[e.jsx(M,{children:a("shoppingLists.card.lastActivity")}),"".concat(ps(t.updatedAt))]})]}),e.jsxs(Xs,{children:[e.jsx(as,{sx:{m:"0 0 0 -8px",minWidth:0},variant:"text",onClick:()=>u(t),children:a("shoppingLists.card.view")}),e.jsxs(D,{sx:{display:L?"block":"none"},children:[!B(t.status)&&x&&e.jsx(O,{"aria-label":"edit",size:"medium",sx:{marginRight:"8px"},onClick:()=>{S(t)},children:e.jsx(Cs,{fontSize:"inherit"})}),e.jsx(O,{"aria-label":"duplicate",size:"medium",sx:{marginRight:"8px"},onClick:()=>{h(t)},children:e.jsx(Is,{fontSize:"inherit"})}),b(t.status)&&x&&e.jsx(O,{"aria-label":"delete",size:"medium",onClick:()=>{r(t)},children:e.jsx(Ds,{fontSize:"inherit"})})]})]})]})},t.id)}function Ks(){const s=j(({b2bFeatures:x})=>x.masqueradeCompany.id),t=j(hs),S=j(({company:x})=>x.companyInfo.id),{shoppingListCreateActionsPermission:r,submitShoppingListPermission:h}=j(V),L=S||s;return{isB2BUser:t,shoppingListCreateActionsPermission:r,submitShoppingListPermission:h,deleteShoppingList:t?Hs:Vs,getUserShoppingLists:t?()=>gs(Number(L),1):()=>Promise.resolve({})}}function xt(){const[s,t]=n.useState(!1),[S,r]=n.useState(!1),[h,L]=n.useState(null),[l,a]=n.useState([]),x=vs(),[p]=rs(),f=R(),[v]=fs(),{isB2BUser:B,shoppingListCreateActionsPermission:b,submitShoppingListPermission:F,deleteShoppingList:u,getUserShoppingLists:o}=Ks(),{state:{openAPPParams:$},dispatch:A}=n.useContext(ls);n.useEffect(()=>{(async()=>{a(x(F,await o()))})(),$.shoppingListBtn&&A({type:"common",payload:{openAPPParams:{quoteBtn:"",shoppingListBtn:""}}})},[]);const P=Ss(),T={isEnabled:B?b:!0,customLabel:f("shoppingLists.createNew"),customButtonStyle:{fontSize:"15px",fontWeight:"500",width:"140px",padding:"0"}},I=F?"":[d.Approved,d.ReadyForApproval],q={search:"",createdBy:"",status:I,isDefault:!0},[z,N]=n.useState(q),w=n.useRef(null),g=()=>{var i;(i=v.current)==null||i.refresh()},m=(i,c)=>{if(i==="search"){const k={...q,search:c};N(k)}},y=i=>{const{status:c}=i,k=c===""||c===99?I:c,ts={...q,createdBy:i.createdBy,status:k,isDefault:c===""};N(ts)},E=async i=>{const{edges:c,totalCount:k}=B?await ms(i):await Ls({offset:i.offset,first:i.first,search:i.search,channelId:H});return{edges:c,totalCount:k}},U=()=>{var i;(i=w.current)==null||i.handleOpenAddEditShoppingListsClick("add")},Y=i=>{var c;(c=w.current)==null||c.handleOpenAddEditShoppingListsClick("edit",i)},Z=i=>{var c;(c=w.current)==null||c.handleOpenAddEditShoppingListsClick("dup",i)},_=i=>{L(i),r(!0)},X=()=>{r(!1)},ss=async()=>{if(h)try{t(!0),X(),await u((h==null?void 0:h.id)||0),Q.success(f("shoppingLists.deleteSuccess"))}finally{t(!1),g()}};return e.jsx(cs,{isSpinning:s,children:e.jsxs(D,{sx:{display:"flex",flexDirection:"column",flex:1},children:[e.jsx(us,{showB3FilterMoreIcon:B,filterMoreInfo:l,handleChange:m,handleFilterChange:y,customButtonConfig:T,handleFilterCustomButtonClick:U}),e.jsx(ds,{columnItems:[],ref:v,rowsPerPageOptions:[12,24,36],getRequestList:E,searchParams:z,isCustomRender:!0,itemXs:P?3:4,requestLoading:t,renderItem:i=>e.jsx(Js,{item:i,isPermissions:B?b:!0,onEdit:Y,onDelete:_,onCopy:Z,isB2BUser:B},i.id||"")}),e.jsx(Ms,{renderList:g,ref:w,isB2BUser:B}),e.jsx(K,{isOpen:S,title:f("shoppingLists.deleteShoppingList"),leftSizeBtn:f("shoppingLists.cancel"),rightSizeBtn:f("shoppingLists.delete"),handleLeftClick:X,handRightClick:ss,row:h,rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:e.jsx(D,{sx:{display:"flex",width:p?"100%":"450px",height:"100%"},children:f("shoppingLists.confirmDelete")})})]})})}export{xt as default};
//# sourceMappingURL=index-n2kpl6fy.js.map
