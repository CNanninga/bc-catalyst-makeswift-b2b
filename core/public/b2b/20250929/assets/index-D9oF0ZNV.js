import{j as h,B as I,a1 as fe,T as U}from"./mui-DjJKBaL-.js";import{r as x}from"./intl-D34a3Rgg.js";import{u as de}from"./form-pKe_k4Gy.js";import{t as W}from"./lodashEs-CONzB2I0.js";import{B as M,ae as G,j as J,k as ce,C as ue,a as me,af as pe,aa as A,ag as be,l as R,u as C,y as Fe,ah as he,ai as z,w as ge,aj as ye,ak as S,_ as xe,I as we}from"./react-setup-Ctz-bmMs.js";import{B as Be}from"./B3CustomForm-BLuJSiae.js";import"./load-functions-utyuqH_X.js";import"./base-CC7kTJh2.js";import{c as Ne,a as Ce}from"./users-DkbfJmiF.js";import{d,g as Ie}from"./config-bINWawad.js";import{L as _e,a as ve}from"./router-DcuTQ_yx.js";import{v as Ee}from"./validatorRules-BK2xeMTW.js";import"./reactVendor-CkUTLE5B.js";import"./eCache-97HTO8co.js";import"./redux-Bt5-tVzx.js";import"./toolkit-CpEbzTSY.js";import"../index.js";import"./global-D7Yn0gGb.js";import"./muiIcon-BBtg8u0V.js";import"./dropzone-B1UJxEDf.js";import"./dateFns-DubixNBV.js";const Ae=e=>"mutation{\n  updateAccountSettings (\n    updateData: ".concat(G(e),"\n  ){\n    result {\n      email\n    },\n  }\n}"),Me=e=>"mutation{\n  updateCustomerAccountSettings (\n    updateData: ".concat(G(e),"\n  ){\n    result {\n      email\n    },\n  }\n}"),Pe=e=>"query GetB2bAccountSettings {\n  accountSettings (\n    companyId: ".concat(e.companyId,"\n  ){\n    firstName,\n    lastName,\n    company,\n    phoneNumber,\n    email,\n    formFields {\n      name,\n      value\n    },\n    extraFields {\n      fieldName,\n      fieldValue,\n    }\n    role,\n    companyRoleId,\n    companyRoleName,\n  }\n}"),Te=()=>"query GetB2CAccountSettings {\n  customerAccountSettings {\n    firstName,\n    lastName,\n    company,\n    phoneNumber,\n    email,\n    formFields {\n      name,\n      value\n    },\n  }\n}",je=e=>M.graphqlB2B({query:Ae(e)}),qe=e=>M.graphqlB2B({query:Me(e)}),Le=e=>M.graphqlB2B({query:Pe(e)}),Ve=()=>M.graphqlB2B({query:Te()}),Ue=()=>[{name:"company",fieldId:"field_company",label:"Company",required:!1,default:"",fieldType:"text",xs:12,variant:"filled",size:"small"},{name:"role",fieldId:"field_role",label:"Role",required:!1,default:"",fieldType:"text",xs:12,variant:"filled",size:"small"}],Re=()=>[{name:"currentPassword",fieldId:"field_current_password",label:"Current Password",required:!1,default:"",fieldType:"password",xs:12,variant:"filled",size:"small"},{name:"password",fieldId:"field_password",label:"Password",required:!1,default:"",fieldType:"password",xs:12,variant:"filled",size:"small"},{name:"confirmPassword",fieldId:"field_confirm_password",label:"Confirm Password",required:!1,default:"",fieldType:"password",xs:12,variant:"filled",size:"small"}];function Se(){const e=J();return h.jsx(I,{children:h.jsx(fe,{severity:"info",variant:"filled",sx:{width:"inherit",'& button[title="Close"]':{display:"block"},mb:"24px",maxWidth:"1450px","& .MuiAlert-icon":{padding:"12px 0"},"& .MuiAlert-message":{width:"100%"}},children:h.jsxs(I,{display:"flex",flexWrap:"wrap",justifyContent:"space-between",width:"100%",children:[h.jsxs(I,{children:[h.jsx(U,{variant:"subtitle1",fontWeight:"800",children:e("accountSettings.registeredToB2b.title")}),h.jsx(U,{sx:{textWrap:"wrap"},children:e("accountSettings.registeredToB2b.description")})]}),h.jsx(U,{component:_e,to:"/registeredbctob2b",sx:{textDecoration:"none",textTransform:"uppercase"},fontWeight:"bold",color:"#fff",children:e("accountSettings.registeredToB2b.upgrade")})]})})})}const $=Ee(["email"]),De=(e,r,c,n)=>{const l=(e==null?void 0:e.extraFields)||[];return r.forEach(s=>{const a=s;d((s==null?void 0:s.name)||"")==="first_name"&&(a.default=e.firstName),d((s==null?void 0:s.name)||"")==="last_name"&&(a.default=e.lastName),d((s==null?void 0:s.name)||"")==="phone"&&(a.default=e.phoneNumber),d((s==null?void 0:s.name)||"")==="email"&&(a.default=e.email,a.validate=$)}),l.length>0&&l.forEach(s=>{const a=s,f=r.find(o=>d((o==null?void 0:o.name)||"")===a.fieldName);f&&(f.default=a.fieldValue)}),c.forEach(s=>{const a=s;s.name==="role"?(a.default=e.companyRoleName,a.disabled=!0):s.name==="company"&&(a.default=e.company,a.disabled=!0)}),n.forEach(s=>{const a=((e==null?void 0:e.formFields)||[]).find(o=>o.name===s.bcLabel),f=s;a&&(f.default=a.value)}),[...r,...c,...n]},Oe=(e,r,c)=>(r.forEach(n=>{const l=n;d((n==null?void 0:n.name)||"")==="first_name"&&(l.default=e.firstName),d((n==null?void 0:n.name)||"")==="last_name"&&(l.default=e.lastName),d((n==null?void 0:n.name)||"")==="phone"&&(l.default=e.phoneNumber),d((n==null?void 0:n.name)||"")==="email"&&(l.default=e.email,l.validate=$),d((n==null?void 0:n.name)||"")==="company"&&(l.default=e.company)}),c.forEach(n=>{const l=((e==null?void 0:e.formFields)||[]).find(a=>a.name===n.bcLabel),s=n;l&&(s.default=l.value)}),[...r,...c]),ze=(e,r,c,n)=>{const l=(r==null?void 0:r.extraFields)||[],s={};s.formFields=[];let a=!0,f=!0,o=!1;if(Object.keys(e).forEach(m=>{c.forEach(i=>{if(m===i.name&&(f=!1,d(i.name)==="first_name"&&(r.firstName!==e[i.name]&&(a=!1),s.firstName=e[i.name]),d(i.name)==="last_name"&&(r.lastName!==e[i.name]&&(a=!1),s.lastName=e[i.name]),d(i.name)==="phone"&&(r.phoneNumber!==e[i.name]&&(a=!1),s.phoneNumber=e[i.name]),d(i.name)==="email"&&(r.email!==e[i.name]&&(a=!1),s.email=e[i.name]),i.custom)){const y=l.find(t=>t.fieldName===d((i==null?void 0:i.name)||""));(y==null?void 0:y.fieldValue)!==e[i.name]&&(o=!0)}}),o&&(a=!1),f&&n.forEach(i=>{var y;if(i.fieldId===m&&(s!=null&&s.formFields)){const{name:t}=i;s.formFields.push({name:(i==null?void 0:i.bcLabel)||"",value:e[m]}),f=!1;const w=((r==null?void 0:r.formFields)||[]).find(N=>N.name===i.bcLabel);w&&JSON.stringify(w.value)!==JSON.stringify(e[m])&&(a=!1),!((y=r==null?void 0:r.formFields)!=null&&y.length)&&t&&e[t]&&(a=!1)}}),f&&(m==="password"?(s.newPassword=e[m],e[m]&&(a=!1)):s[m]=e[m]),f=!0}),delete s.company,delete s.role,!a)return s},We=(e,r,c,n)=>{const l={};l.formFields=[];let s=!0,a=!0;if(Object.keys(e).forEach(f=>{c.forEach(o=>{f===o.name&&(a=!1,d(o.name)==="first_name"&&(r.firstName!==e[o.name]&&(s=!1),l.firstName=e[o.name]),d(o.name)==="last_name"&&(r.lastName!==e[o.name]&&(s=!1),l.lastName=e[o.name]),d(o.name)==="phone"&&(r.phoneNumber!==e[o.name]&&(s=!1),l.phoneNumber=e[o.name]),d(o.name)==="email"&&(r.email!==e[o.name]&&(s=!1),l.email=e[o.name]),d(o.name)==="company"&&(r.company!==e[o.name]&&(s=!1),l.company=e[o.name]))}),a&&n.forEach(o=>{if(o.fieldId===f&&(l!=null&&l.formFields)){l.formFields.push({name:(o==null?void 0:o.bcLabel)||"",value:e[f]}),a=!1;const m=((r==null?void 0:r.formFields)||[]).find(i=>i.name===o.bcLabel);m&&JSON.stringify(m.value)!==JSON.stringify(e[f])&&(s=!1)}}),a&&(f==="password"?(l.newPassword=e[f],e[f]&&(s=!1)):l[f]=e[f]),a=!0}),!s)return l};function Ge(){const e=C(Fe),r=C(({company:t})=>t.companyInfo.id),c=C(({company:t})=>t.customer),n=C(({company:t})=>t.customer.role),l=C(({b2bFeatures:t})=>t.masqueradeCompany.id),s=C(({b2bFeatures:t})=>t.masqueradeCompany.isAgenting),a=Number(n===3&&s?l:r),f=!e||n===3&&!s,o=he.B2C===c.role&&[z.B2C,z.MULTIPLE_B2C].includes(c.userType)&&ge==="catalyst";return{isBCUser:f,companyId:a,customer:c,validateEmailValue:async t=>{if(c.emailAddress===W(t))return!0;const w={email:t,channelId:we},{isValid:N}=f?await Ne(w):await Ce(w);return N},emailValidation:t=>!(t.email!==c.emailAddress&&!t.currentPassword),passwordValidation:t=>t.password===t.confirmPassword,isDisplayUpgradeBanner:o}}function us(){const{isBCUser:e,companyId:r,customer:c,validateEmailValue:n,emailValidation:l,passwordValidation:s,isDisplayUpgradeBanner:a}=Ge(),{control:f,handleSubmit:o,getValues:m,formState:{errors:i},setValue:y,setError:t}=de({mode:"onSubmit"}),[w,N]=ce("sf-isFinishUpdate",!1,sessionStorage),{state:{portalStyle:{backgroundColor:P="#FEF9F5"}}}=x.useContext(ue),u=J(),[T]=me(),k=ve(),[j,H]=x.useState([]),[K,Q]=x.useState([]),[X,Y]=x.useState([]),[Z,_]=x.useState(!1),[ee,se]=x.useState({}),[ae,oe]=x.useState(!1);x.useEffect(()=>{(async()=>{try{_(!0);const g=e?Ve:Le,B=e?{}:{companyId:r},p=e?"customerAccountSettings":"accountSettings",D=await ye(e?1:2),b=Ie(D.accountFormFields||[]),v=((b==null?void 0:b.contactInformation)||[]).filter(V=>V.fieldId!=="field_email_marketing_newsletter"),{additionalInformation:q=[]}=b,{[p]:L}=await g(B),ie=e?Oe(L,v,q):De(L,v,Ue(),q),te=Re(),O=[...ie,...te],E=O.find(V=>V.name==="role");E!=null&&E.fieldType&&(E.fieldType="text"),H(O),se(L),Q(v),Y(q)}finally{w&&(S.success(u("accountSettings.notification.detailsUpdated")),N(!1)),_(!1),oe(!0)}})()},[w]);const re=(F,g)=>g.filter(p=>p.custom&&p.groupId===1).map(p=>({fieldName:d((p==null?void 0:p.name)||""),fieldValue:F[p.name]})),le=()=>{o(async F=>{_(!0);try{const g=await n(F.email);g||t("email",{type:"custom",message:u("accountSettings.notification.emailExists")});const B=l(F);B||S.error(u("accountSettings.notification.updateEmailPassword"));const p=s(F);if(p||(t("confirmPassword",{type:"manual",message:u("global.registerComplete.passwordMatchPrompt")}),t("password",{type:"manual",message:u("global.registerComplete.passwordMatchPrompt")})),g&&B&&p){const b=(e?We:ze)(F,ee,K,X);if(b&&(e||(b.companyId=r,b.extraFields=re(F,j)),b.newPassword===""&&b.confirmPassword===""&&(delete b.newPassword,delete b.confirmPassword)),!b){S.success(u("accountSettings.notification.noEdits"));return}await(e?qe:je)(b),F.password&&F.currentPassword||c.emailAddress!==W(F.email)?k("/login?loginFlag=loggedOutLogin"):(xe.clear(),N(!0))}}finally{_(!1)}})()},ne=x.useMemo(()=>{const F={field_first_name:u("accountSettings.form.firstName"),field_last_name:u("accountSettings.form.lastName"),field_email:u("accountSettings.form.email"),field_phone_number:u("accountSettings.form.phoneNumber"),field_company:u("accountSettings.form.company"),field_role:u("accountSettings.form.role"),field_current_password:u("accountSettings.form.currentPassword"),field_password:u("accountSettings.form.password"),field_confirm_password:u("accountSettings.form.confirmPassword")};return j.map(g=>{var B,p;return{...g,label:(p=F[(B=g.fieldId)!=null?B:""])!=null?p:g.label}})},[j,u]);return h.jsx(pe,{isSpinning:Z,background:P,children:h.jsxs(I,{children:[a&&h.jsx(Se,{}),h.jsxs(I,{sx:{width:T?"100%":"35%",minHeight:T?"800px":"300px","& input, & .MuiFormControl-root .MuiTextField-root, & .MuiSelect-select.MuiSelect-filled, & .MuiTextField-root .MuiInputBase-multiline":{bgcolor:A("#FFFFFF",.87),borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"},"& .MuiButtonBase-root.MuiCheckbox-root:not(.Mui-checked), & .MuiRadio-root:not(.Mui-checked)":{color:A(R(P),.6)},"& .MuiTypography-root.MuiTypography-body1.MuiFormControlLabel-label, & .MuiFormControl-root .MuiFormLabel-root:not(.Mui-focused)":{color:A(R(P),.87)},"& .MuiInputLabel-root.MuiInputLabel-formControl:not(.Mui-focused)":{color:A(R("#FFFFFF"),.6)}},children:[h.jsx(Be,{formFields:ne,errors:i,control:f,getValues:m,setValue:y}),h.jsx(be,{sx:{mt:"28px",mb:T?"20px":"0",width:"100%",visibility:ae?"visible":"hidden"},onClick:le,variant:"contained",children:u("accountSettings.button.saveUpdates")})]})]})})}export{us as default};
//# sourceMappingURL=index-D9oF0ZNV.js.map
