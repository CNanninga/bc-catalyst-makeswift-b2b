import{O as Ae,j as e,B as h,A as he,ae,b as tt,am as rt,G as O,T as y,s as ie}from"./mui-DjJKBaL-.js";import{r as f}from"./intl-D34a3Rgg.js";import{g as st}from"./reactVendor-CkUTLE5B.js";import{G as Re,j as W,u as Q,a2 as Le,af as Qe,aT as nt,aI as Se,a7 as Ne,bu as ve,bv as Fe,w as Te,a as fe,ag as me,C as ot,l as at,aa as it,aw as ke,bw as _,bs as G,aN as Be,am as ct,bh as lt,ao as ut,bx as dt,ak as V,by as pt,y as xt,bg as mt,at as ht,ba as ft,bb as gt}from"./react-setup-Ctz-bmMs.js";import"./load-functions-utyuqH_X.js";import{b as bt}from"./base-CC7kTJh2.js";import{u as Ie,g as yt,q as Ct,Q as jt,a as Pt,b as wt,e as St}from"./QuoteStatus-DYr8EgTf.js";import{B as $e,Q as Nt,a as vt,b as Tt,g as kt}from"./getQuoteExtraFields-BMutsMTX.js";import{m as It,i as Et}from"./muiIcon-BBtg8u0V.js";import{f as Dt,a as qt}from"./dateFns-DubixNBV.js";import{s as At,a as Rt}from"./b3checkout-CprzFgHU.js";import{u as ge,a as be,c as Lt}from"./router-DcuTQ_yx.js";import{j as Ee}from"./lodashEs-CONzB2I0.js";import"./eCache-97HTO8co.js";import"./redux-Bt5-tVzx.js";import"./toolkit-CpEbzTSY.js";import"../index.js";import"./global-D7Yn0gGb.js";import"./dropzone-B1UJxEDf.js";var de,De;function Qt(){return De||(De=1,de=function(){var n=document.getSelection();if(!n.rangeCount)return function(){};for(var c=document.activeElement,p=[],j=0;j<n.rangeCount;j++)p.push(n.getRangeAt(j));switch(c.tagName.toUpperCase()){case"INPUT":case"TEXTAREA":c.blur();break;default:c=null;break}return n.removeAllRanges(),function(){n.type==="Caret"&&n.removeAllRanges(),n.rangeCount||p.forEach(function(N){n.addRange(N)}),c&&c.focus()}}),de}var pe,qe;function Ft(){if(qe)return pe;qe=1;var n=Qt(),c={"text/plain":"Text","text/html":"Url",default:"Text"},p="Copy to clipboard: #{key}, Enter";function j(b){var l=(/mac os x/i.test(navigator.userAgent)?"âŒ˜":"Ctrl")+"+C";return b.replace(/#{\s*key\s*}/g,l)}function N(b,l){var s,P,i,u,v,C,T=!1;l||(l={}),s=l.debug||!1;try{i=n(),u=document.createRange(),v=document.getSelection(),C=document.createElement("span"),C.textContent=b,C.ariaHidden="true",C.style.all="unset",C.style.position="fixed",C.style.top=0,C.style.clip="rect(0, 0, 0, 0)",C.style.whiteSpace="pre",C.style.webkitUserSelect="text",C.style.MozUserSelect="text",C.style.msUserSelect="text",C.style.userSelect="text",C.addEventListener("copy",function(g){if(g.stopPropagation(),l.format)if(g.preventDefault(),typeof g.clipboardData>"u"){s&&console.warn("unable to use e.clipboardData"),s&&console.warn("trying IE specific stuff"),window.clipboardData.clearData();var r=c[l.format]||c.default;window.clipboardData.setData(r,b)}else g.clipboardData.clearData(),g.clipboardData.setData(l.format,b);l.onCopy&&(g.preventDefault(),l.onCopy(g.clipboardData))}),document.body.appendChild(C),u.selectNodeContents(C),v.addRange(u);var A=document.execCommand("copy");if(!A)throw new Error("copy command was unsuccessful");T=!0}catch(g){s&&console.error("unable to copy using execCommand: ",g),s&&console.warn("trying IE specific stuff");try{window.clipboardData.setData(l.format||"text",b),l.onCopy&&l.onCopy(window.clipboardData),T=!0}catch(r){s&&console.error("unable to copy using clipboardData: ",r),s&&console.error("falling back to prompt"),P=j("message"in l?l.message:p),window.prompt(P,b)}}finally{v&&(typeof v.removeRange=="function"?v.removeRange(u):v.removeAllRanges()),C&&document.body.removeChild(C),i()}return T}return pe=N,pe}var Bt=Ft();const $t=st(Bt);function Mt({msg:n,isEndMessage:c,isCustomer:p}){const j=W();return e.jsxs(h,{sx:{display:"flex",flexDirection:"column",alignItems:p?"flex-end":"flex-start",paddingTop:"5px"},children:[(n==null?void 0:n.role)&&e.jsx(h,{sx:{height:"14px",fontWeight:400,lineHeight:"14px",fontSize:"10px",letterSpacing:"0.17px",color:"rgba(0, 0, 0, 0.38)"},children:n.role}),(n==null?void 0:n.message)&&e.jsxs(h,{sx:{display:"inline-block",lineHeight:"34px",padding:"0 10px",background:p?"rgba(25, 118, 210, 0.3)":"rgba(0, 0, 0, 0.12)",borderRadius:"18px",m:"1px"},children:[e.jsx(rt,{title:Dt((n.sendTime||0)*1e3,"K:m aa"),placement:"top",arrow:!0,children:e.jsx(h,{sx:{wordBreak:"break-word"},children:n.message})}),c&&e.jsx(h,{sx:{height:"14px",fontWeight:400,lineHeight:"14px",fontSize:"10px",letterSpacing:"0.17px",color:"rgba(0, 0, 0, 0.38)"},children:"".concat(j("quoteDetail.message.sent")," ").concat(qt(new Date((n.sendTime||0)*1e3),new Date,{addSuffix:!0}))})]})]})}function Ht({msg:n}){return e.jsx(h,{sx:{color:"rgba(0, 0, 0, 0.6)",textAlign:"center",height:"21px",mb:"5px"},children:"".concat(nt((n==null?void 0:n.date)||0))})}function Ut({msgs:n,id:c,isB2BUser:p,email:j,status:N}){const{dispatch:b}=f.useContext(Re),s=Ae().palette.primary.main,P=W(),i=f.useRef(null),u=f.useRef(0),[v,C]=f.useState([]),[T,A]=f.useState(0),[g,r]=f.useState(""),[t,x]=f.useState(!1),{quotesUpdateMessageActionsPermission:m}=Q(Le),w=p?m:!0,k=S=>{let D={};const U=[];let $=0;S.forEach((a,ce)=>{var K,te,X,Y,re,se,ne,oe,J;ce===0?(U.push({isCustomer:!((K=a.role)!=null&&K.includes("Sales rep:")),date:a==null?void 0:a.date,key:"".concat(a==null?void 0:a.date,"date")}),U.push({isCustomer:!((te=a.role)!=null&&te.includes("Sales rep:")),message:a.message,sendTime:a.date,role:a.role,key:a==null?void 0:a.date}),D=a,D.isCustomer=!((X=a.role)!=null&&X.includes("Sales rep:"))):(((a==null?void 0:a.date)||0)-((D==null?void 0:D.date)||0)>3600&&U.push({isCustomer:!((Y=a.role)!=null&&Y.includes("Sales rep:")),date:a==null?void 0:a.date,key:"".concat(a==null?void 0:a.date,"date")}),D.isCustomer===!((re=a.role)!=null&&re.includes("Sales rep:"))?U.push({isCustomer:!((se=a.role)!=null&&se.includes("Sales rep:")),message:a.message,sendTime:a.date,key:a==null?void 0:a.date}):U.push({isCustomer:!((ne=a.role)!=null&&ne.includes("Sales rep:")),message:a.message,role:a.role,sendTime:a.date,key:a==null?void 0:a.date}),D=a,D.isCustomer=!((oe=a.role)!=null&&oe.includes("Sales rep:"))),(J=a.role)!=null&&J.includes("Sales rep:")&&!a.read&&($+=1)}),A($),C(U)},L=f.useMemo(()=>e.jsxs(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:["".concat(P("quoteDetail.message.message")," "),T!==0&&e.jsx(h,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:"20px",height:"20px",borderRadius:"50%",background:s||"#1976D2",color:"#fff",fontSize:"12px",ml:"8px"},children:T})]}),[s,T]);f.useEffect(()=>{k(n)},[n]),f.useEffect(()=>{i.current&&v.length&&(i.current.scrollTop=i.current.scrollHeight)},[v]);const R=async S=>{try{x(!0);const{quoteUpdate:{quote:{trackingHistory:D}}}=await Ie({id:Number(c),quoteData:{message:S,lastMessage:parseInt("".concat(new Date().getTime()/1e3),10),userEmail:j||"",storeHash:Se}});r(""),A(0),k(D)}finally{x(!1)}},H=S=>{S.key==="Enter"&&R(S.target.value||"")},F=f.useCallback(S=>{var D;if(S){if(!w&&p)return;u.current===0&&n.length&&Ie({id:Number(c),quoteData:{lastMessage:(D=n[n.length-1])==null?void 0:D.date,userEmail:j||"",storeHash:Se}}),A(0),i.current&&(i.current.scrollTop=i.current.scrollHeight),u.current+=1}},[j,c,p,n,w]);return f.useEffect(()=>{b({type:"common",payload:{quoteDetailHasNewMessages:T!==0}})},[T]),e.jsx(he,{children:e.jsx(ae,{sx:{p:"16px !important"},children:e.jsxs($e,{handleOnChange:F,title:L,children:[e.jsxs(h,{sx:{padding:"16px 0"},children:[e.jsx(h,{sx:{position:"relative",color:"rgba(0, 0, 0, 0.6)",opacity:.6,textAlign:"left",width:"100%",fontSize:"14px"},children:P("quoteDetail.message.merchantAnswers")}),e.jsx(h,{ref:i,sx:{mt:"20px",maxHeight:"280px",overflowY:"auto","&::-webkit-scrollbar":{display:"none"}},children:v.map((S,D)=>e.jsxs(h,{children:[e.jsx(Mt,{msg:S,isEndMessage:D===v.length-1,isCustomer:!!S.isCustomer}),S.date&&e.jsx(Ht,{msg:S})]},S.key))})]}),N!==4&&w&&e.jsx(Qe,{isSpinning:t,spinningHeight:50,size:10,isCloseLoading:!0,tip:"waiting..",children:e.jsxs(h,{sx:{display:"flex",width:"100%"},children:[e.jsx(tt,{onKeyDown:H,sx:{width:"100%","& .MuiFormLabel-root":{color:"rgba(0, 0, 0, 0.38)"},"& input":{padding:"1.5rem 0.7rem 0.5rem"}},value:g,onChange:S=>{r(S.target.value)},size:"small",label:P("quoteDetail.message.typeMessage"),variant:"filled"}),e.jsx(h,{onClick:()=>R(g),sx:{width:"42px",height:"36px",margin:"10px 0 0 10px",background:"#BAD6F2",borderRadius:"50%"},children:e.jsx(It,{sx:{height:"18px",width:"18px",margin:"8px 0 0 9px",color:"#0000008A"},fontSize:"small"})})]})})]})})})}const Me=async({role:n,proceedingCheckoutFn:c,location:p,quoteId:j,navigate:N})=>{try{if(Ne.dispatch(ve("")),c())return;const{storefrontProductSettings:{hidePriceFromGuests:l}}=await yt();if(l&&Number(n)===100&&N){Ne.dispatch(ve(p.pathname+p.search)),N("/login");return}const s=Fe(p.search,"date"),P=await Ct({id:Number(j)});At(j,s);const{quoteCheckout:{quoteCheckout:{checkoutUrl:i,cartId:u}}}=P;if(Te==="bigcommerce"){window.location.href=i;return}if(Te==="catalyst"){window.location.href="/checkout?cartId=".concat(u);return}await Rt(u,i)}catch(b){bt.error(b)}};function zt(n){const{quoteId:c,role:p,isAgenting:j,status:N,proceedingCheckoutFn:b}=n,[l]=fe(),s=W(),P=ge(),i=be(),u=l?{alignItems:"flex-end",flexDirection:"column"}:{alignItems:"center"};return N!==5?e.jsx(h,{sx:{position:"fixed",bottom:l&&j?"52px":0,left:0,backgroundColor:"#fff",width:"100%",padding:"0.8rem 1rem",height:"auto",display:"flex",zIndex:"999",justifyContent:l?"center":"flex-end",displayPrint:"none",...u},children:e.jsx(me,{variant:"contained",onClick:()=>{Me({proceedingCheckoutFn:b,role:p,location:P,quoteId:c,navigate:i})},sx:{width:l?"100%":"auto"},children:s("quoteDetail.footer.proceedToCheckout")})}):null}const xe=ie("div")(()=>({display:"flex",alignItems:"center",marginTop:"0.5rem"}));function Ot(n){const[c]=fe(),p=W(),{status:j,quoteNumber:N,issuedAt:b,expirationDate:l,exportPdf:s,printQuote:P,role:i,salesRepInfo:u}=n,{state:{portalStyle:{backgroundColor:v="#FEF9F5"}}}=f.useContext(ot),C=at(v),A=Ae().palette.primary.main,g=be(),r=t=>c?{}:{xs:t};return e.jsxs(e.Fragment,{children:[Number(i)!==100&&e.jsx(h,{sx:{marginBottom:"10px",width:"fit-content",displayPrint:"none"},children:e.jsxs(h,{sx:{color:"#1976d2",cursor:"pointer",display:"flex",alignItems:"center"},onClick:()=>{g("/quotes")},children:[e.jsx(Et,{fontSize:"small",sx:{fontSize:"12px",marginRight:"0.5rem",color:A}}),e.jsx("p",{style:{color:A,margin:"0"},children:p("quoteDetail.header.backToQuoteLists")})]})}),e.jsxs(O,{container:!0,spacing:2,sx:{display:"flex",justifyContent:"space-between",flexDirection:c?"column":"row",mb:c?"16px":""},children:[e.jsxs(O,{item:!0,...r(8),sx:{color:C},children:[e.jsxs(h,{sx:{display:"flex",alignItems:c?"start":"center",flexDirection:c?"column":"row"},children:[e.jsx(y,{sx:{marginRight:"10px",fontSize:"34px",color:it(C,.87)},children:p("quoteDetail.header.quoteNumber",{quoteNumber:N||""})}),e.jsx(jt,{code:j})]}),((u==null?void 0:u.salesRepName)||(u==null?void 0:u.salesRepEmail))&&e.jsxs(xe,{children:[e.jsx(y,{variant:"subtitle2",sx:{marginRight:"0.5rem",fontSize:"16px"},children:p("quoteDetail.header.salesRep")}),e.jsx("span",{children:(u==null?void 0:u.salesRepEmail)!==""?"".concat(u==null?void 0:u.salesRepName,"(").concat(u==null?void 0:u.salesRepEmail,")"):u==null?void 0:u.salesRepName})]}),e.jsxs(h,{children:[e.jsxs(xe,{children:[e.jsx(y,{variant:"subtitle2",sx:{marginRight:"0.5rem",fontSize:"16px"},children:p("quoteDetail.header.issuedOn")}),e.jsx("span",{children:"".concat(b?ke(Number(b)):"")})]}),e.jsxs(xe,{children:[e.jsx(y,{variant:"subtitle2",sx:{marginRight:"0.5rem",fontSize:"16px"},children:p("quoteDetail.header.expirationDate")}),e.jsx("span",{children:"".concat(l?ke(Number(l)):"")})]})]})]}),Number(i)!==100&&e.jsx(O,{item:!0,sx:{textAlign:c?"none":"end",displayPrint:"none"},...r(4),children:e.jsxs(h,{children:[e.jsx(me,{variant:"outlined",sx:{marginRight:"1rem",displayPrint:"none"},onClick:P,children:p("quoteDetail.header.print")}),e.jsx(me,{variant:"outlined",onClick:s,children:p("quoteDetail.header.downloadPDF")})]})})]})]})}function Vt({quoteSummary:{originalSubtotal:n,discount:c,tax:p,shipping:j,totalAmount:N},quoteDetailTax:b=0,status:l,quoteDetail:s,isHideQuoteCheckout:P}){const i=W(),u=Q(({storeConfigs:m})=>m.currencies.enteredInclusiveTax),v=Q(({global:m})=>m.showInclusiveTaxPrice),C=(m,w)=>u?v?m:m-w:v?m+w:m,T=m=>_(m,{currency:s.currency,isConversionRate:!1,useCurrentCurrency:!!s.currency}),g=(()=>{var m,w,k,L;return(m=s==null?void 0:s.shippingMethod)!=null&&m.id?{shippingText:"".concat(i("quoteDetail.summary.shipping"),"(").concat(((w=s==null?void 0:s.shippingMethod)==null?void 0:w.description)||"",")"),shippingVal:T(Number(j)),taxText:i("quoteDetail.summary.tax"),taxVal:T(Number(p))}:!(s!=null&&s.salesRepEmail)&&!((k=s==null?void 0:s.shippingMethod)!=null&&k.id)&&Number(l)===1?{shippingText:i("quoteDetail.summary.shipping"),shippingVal:i("quoteDetail.summary.tbd"),taxText:i("quoteDetail.summary.estimatedTax"),taxVal:T(Number(p))}:s!=null&&s.salesRepEmail&&!((L=s==null?void 0:s.shippingMethod)!=null&&L.id)&&(Number(l)===1||Number(l)===5)?{shippingText:"".concat(i("quoteDetail.summary.shipping"),"(").concat(i("quoteDetail.summary.quoteCheckout"),")"),shippingVal:i("quoteDetail.summary.tbd"),taxText:i("quoteDetail.summary.tax"),taxVal:i("quoteDetail.summary.tbd")}:null})(),r=m=>P?i("quoteDraft.quoteSummary.tbd"):m,t=Number(n),x=Number(n)-Number(c);return e.jsx(he,{children:e.jsx(ae,{children:e.jsxs(h,{children:[e.jsx(y,{variant:"h5",children:i("quoteDetail.summary.quoteSummary")}),e.jsxs(h,{sx:{marginTop:"20px",color:"#212121"},children:[(s==null?void 0:s.displayDiscount)&&e.jsxs(O,{container:!0,justifyContent:"space-between",sx:{margin:"4px 0"},children:[e.jsx(y,{children:i("quoteDetail.summary.originalSubtotal")}),e.jsx(y,{children:r(T(C(t,b)))})]}),!(s!=null&&s.salesRepEmail)&&Number(l)===1?null:e.jsxs(O,{container:!0,justifyContent:"space-between",sx:{margin:"4px 0",display:s!=null&&s.displayDiscount?"":"none"},children:[e.jsx(y,{children:i("quoteDetail.summary.discountAmount")}),e.jsx(y,{children:Number(c)>0?"-".concat(T(Number(c))):T(Number(c))})]}),e.jsxs(O,{container:!0,justifyContent:"space-between",sx:{margin:"4px 0"},children:[e.jsx(y,{sx:{fontWeight:"bold",color:"#212121"},children:i("quoteDetail.summary.quotedSubtotal")}),e.jsx(y,{sx:{fontWeight:"bold",color:"#212121"},children:r(T(C(x,b)))})]}),g&&e.jsxs(e.Fragment,{children:[e.jsxs(O,{container:!0,justifyContent:"space-between",sx:{margin:"4px 0"},children:[e.jsx(y,{sx:{maxWidth:"70%",wordBreak:"break-word"},children:g.shippingText}),e.jsx(y,{children:r(g.shippingVal)})]}),e.jsxs(O,{container:!0,justifyContent:"space-between",sx:{margin:"4px 0"},children:[e.jsx(y,{children:g.taxText}),e.jsx(y,{children:r(g.taxVal)})]})]}),e.jsxs(O,{container:!0,justifyContent:"space-between",sx:{margin:"24px 0 0"},children:[e.jsx(y,{sx:{fontWeight:"bold",color:"#212121"},children:i("quoteDetail.summary.grandTotal")}),e.jsx(y,{sx:{fontWeight:"bold",color:"#212121"},children:r(T(Number(N)))})]})]})]})})})}const _t=ie("img")(()=>({maxWidth:"60px",height:"auto",marginRight:"0.5rem"}));function Wt(n){const{item:c,len:p,itemIndex:j,getTaxRate:N,showPrice:b,currency:l,displayDiscount:s}=n,P=W(),i=Q(({storeConfigs:$})=>$.currencies.enteredInclusiveTax),{basePrice:u,quantity:v,imageUrl:C,productName:T,options:A,sku:g,notes:r,offeredPrice:t,productsSearch:{productUrl:x,variants:m=[],taxClassId:w}}=c,k=N(w,m),L=i?Number(u)*k/(1+k):Number(u)*k,R=i?Number(t)*k/(1+k):Number(t)*k,H=G(Number(u),L),F=G(Number(t),R),S=Number(u)-Number(t)>0&&s,D=Number(H)*Number(v),U=F*Number(v);return e.jsx(h,{width:"100%",sx:{borderTop:"1px solid #D9DCE9",borderBottom:j===p-1?"1px solid #D9DCE9":""},children:e.jsxs(ae,{sx:{color:"#313440",display:"flex",pl:0},children:[e.jsx(h,{children:e.jsx(_t,{src:C||Be,alt:"Product-img",loading:"lazy"})}),e.jsxs(h,{sx:{flex:1},children:[e.jsx(y,{variant:"body1",color:"#212121",onClick:()=>{const{location:{origin:$}}=window;x&&(window.location.href="".concat($).concat(x))},sx:{cursor:"pointer"},children:T}),e.jsx(y,{variant:"body1",color:"#616161",children:g}),e.jsx(h,{sx:{margin:"1rem 0"},children:A.length>0&&e.jsx(h,{children:A.map($=>e.jsx(y,{sx:{fontSize:"0.75rem",lineHeight:"1.5",color:"#455A64"},children:"".concat($.optionName,": ").concat($.optionLabel)},$.optionName))})}),e.jsx(y,{variant:"body1",color:"#616161",children:r}),e.jsxs(y,{sx:{fontSize:"14px"},children:[P("quoteDetail.tableCard.price"),S&&e.jsx("span",{style:{marginLeft:"5px",textDecoration:"line-through"},children:"".concat(b(_(H,{currency:l}),c))}),e.jsx("span",{style:{marginLeft:"5px",color:S?"#2E7D32":"#212121"},children:"".concat(b(_(t,{currency:l}),c))})]}),e.jsx(y,{sx:{padding:"12px 0",fontSize:"14px"},children:P("quoteDetail.tableCard.qty",{quantity:v})}),e.jsxs(y,{sx:{fontSize:"14px"},children:[P("quoteDetail.tableCard.total"),S&&e.jsx("span",{style:{marginLeft:"5px",textDecoration:"line-through"},children:"".concat(b(_(D,{currency:l}),c))}),e.jsx("span",{style:{marginLeft:"5px",color:S?"#2E7D32":"#212121"},children:"".concat(b(_(U,{currency:l}),c))})]})]})]})},c.id)}const Gt=ie("div")(()=>({backgroundColor:"#FFFFFF",padding:"1rem",width:"100%",border:"1px solid #E0E0E0",boxShadow:"0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px rgba(0, 0, 0, 0.14), 0px 1px 3px rgba(0, 0, 0, 0.12)",borderRadius:"4px","& tbody":{"& tr":{"& td":{verticalAlign:"top"},"& td: first-of-type":{verticalAlign:"inherit"}},"& tr: hover":{"& #shoppingList-actionList":{opacity:1}}}})),Kt=ie("img")(()=>({maxWidth:"60px",height:"auto",marginRight:"0.5rem"}));function Xt(n,c){const p=W(),{total:j,getQuoteTableDetails:N,getTaxRate:b,isHandleApprove:l,displayDiscount:s,currency:P}=n,i=Q(({global:r})=>r.blockPendingQuoteNonPurchasableOOS.isEnableProduct),u=Q(({storeConfigs:r})=>r.currencies.enteredInclusiveTax),v=f.useRef(null),[C,T]=f.useState({first:12,offset:0});f.useImperativeHandle(c,()=>({getList:()=>{var r;return(r=v.current)==null?void 0:r.getList()},refreshList:()=>{T({offset:0})}}));const A=(r,t)=>i?l?r:lt({price:r,productInfo:t,showText:p("quoteDraft.quoteSummary.tbd")}):r,g=[{key:"Product",title:p("quoteDetail.table.product"),render:r=>{var m;const t=r.options,x=(m=r.productsSearch)==null?void 0:m.productUrl;return e.jsxs(h,{sx:{display:"flex",alignItems:"flex-start"},children:[e.jsx(Kt,{src:r.imageUrl||Be,alt:"Product-img",loading:"lazy"}),e.jsxs(h,{children:[e.jsx(y,{variant:"body1",color:"#212121",onClick:()=>{const{location:{origin:w}}=window;x&&(window.location.href="".concat(w).concat(x))},sx:{cursor:"pointer"},children:r.productName}),e.jsx(y,{variant:"body1",color:"#616161",children:r.sku}),t.length>0&&e.jsx(h,{children:t.map(w=>w.optionLabel&&e.jsxs(y,{sx:{fontSize:"0.75rem",lineHeight:"1.5",color:"#455A64"},children:[w.optionName,": ",w.optionLabel]},"".concat(w.optionId,"_").concat(w.optionName,"_").concat(w.optionLabel)))}),r.notes&&e.jsxs(y,{variant:"body1",color:"#ED6C02",sx:{fontSize:"0.9rem",whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[e.jsx("span",{children:"Notes: "}),r.notes]})]})]})},width:"40%"},{key:"Price",title:p("quoteDetail.table.price"),render:r=>{const{basePrice:t,offeredPrice:x,productsSearch:{variants:m=[],taxClassId:w}}=r,k=b(w,m),L=u?Number(t)*k/(1+k):Number(t)*k,R=u?Number(x)*k/(1+k):Number(x)*k,H=G(Number(t),L),F=G(Number(x),R),S=Number(t)-Number(x)>0&&s;return e.jsxs(e.Fragment,{children:[S&&e.jsx(y,{sx:{padding:"12px 0 0 0",textDecoration:"line-through"},children:A(_(H,{currency:P,isConversionRate:!1,useCurrentCurrency:!!P}),r)}),e.jsx(y,{sx:{padding:S?"0":"12px 0 0 0",color:S?"#2E7D32":"#212121"},children:A(_(F,{currency:P,isConversionRate:!1,useCurrentCurrency:!!P}),r)})]})},width:"15%",style:{textAlign:"right"}},{key:"Qty",title:p("quoteDetail.table.qty"),render:r=>e.jsx(y,{sx:{padding:"12px 0"},children:r.quantity}),width:"15%",style:{textAlign:"right"}},{key:"Total",title:p("quoteDetail.table.total"),render:r=>{const{basePrice:t,quantity:x,offeredPrice:m,productsSearch:{variants:w=[],taxClassId:k}}=r,L=b(k,w),R=u?Number(t)*L/(1+L):Number(t)*L,H=u?Number(m)*L/(1+L):Number(m)*L,F=G(Number(t),R),S=G(Number(m),H),D=Number(t)-Number(m)>0&&s,U=F*Number(x),$=S*Number(x);return e.jsxs(h,{children:[D&&e.jsx(y,{sx:{padding:"12px 0 0 0",textDecoration:"line-through"},children:A(_(U,{currency:P,isConversionRate:!1,useCurrentCurrency:!!P}),r)}),e.jsx(y,{sx:{padding:D?"0":"12px 0 0 0",color:D?"#2E7D32":"#212121"},children:A(_($,{currency:P,isConversionRate:!1,useCurrentCurrency:!!P}),r)})]})},width:"20%",style:{textAlign:"right"}}];return e.jsxs(Gt,{children:[e.jsx(h,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",margin:"0.5rem 0 1rem 0"},children:e.jsx(y,{sx:{fontSize:"24px"},children:p("quoteDetail.table.totalProducts",{total:j||0})})}),e.jsx(ct,{ref:v,columnItems:g,rowsPerPageOptions:[12,24,36],getRequestList:N,isCustomRender:!1,hover:!0,searchParams:C,labelRowsPerPage:p("quoteDetail.table.perPage"),showBorder:!1,itemIsMobileSpacing:0,noDataText:p("quoteDetail.table.noProducts"),tableKey:"productId",renderItem:(r,t)=>e.jsx(Wt,{len:j||0,item:r,showPrice:A,itemIndex:t,currency:P,displayDiscount:s,getTaxRate:b})})]})}const Yt=f.forwardRef(Xt);function Jt(n){const{quoteLegalTerms:c=""}=n,[p,j]=f.useState(!1),N=W(),b=l=>{j(l)};return e.jsx(he,{sx:{".MuiCardContent-root":{maxHeight:p?"637px":"auto"}},children:e.jsx(ae,{sx:{p:"16px !important"},children:e.jsx($e,{title:N("quoteDetail.termsAndConditions"),handleOnChange:b,children:e.jsx(h,{children:e.jsx(y,{variant:"body1",sx:{padding:"16px 0",maxHeight:"545px",whiteSpace:"pre-wrap",overflow:"auto"},children:c})})})})})}function Zt(){const{id:n=""}=Lt(),{state:{bcLanguage:c,quoteConfig:p}}=f.useContext(Re),j=Q(({company:x})=>x.companyInfo.id),N=Q(({company:x})=>x.customer.emailAddress),b=Q(({company:x})=>x.customer.customerGroupId),l=Q(({company:x})=>x.customer.role),s=Q(xt),{selectCompanyHierarchyId:P}=Q(({company:x})=>x.companyHierarchyInfo),i=Q(({b2bFeatures:x})=>x.masqueradeCompany.isAgenting),{currency_code:u}=Q(mt),v=Q(({global:x})=>x.taxZoneRates),C=Q(({storeConfigs:x})=>x.currencies.enteredInclusiveTax),T=Q(({global:x})=>{var m;return(m=x.blockPendingQuoteNonPurchasableOOS)==null?void 0:m.isEnableProduct}),{purchasabilityPermission:A}=Q(Le),g=async x=>{if(x.length>0){const m=[];x.forEach(R=>{m.includes(R.productId)||m.push(R.productId)});const w={productIds:m,currencyCode:u,companyId:j,customerGroupId:b},{productsSearch:k}=await ft(w),L=gt(k);return x.forEach(R=>{const H=R,F=L.find(S=>{const{id:D}=S;return Number(R.productId)===Number(D)});H.productsSearch=F||{}}),x}},r=ge();return{id:n,bcLanguage:c,quoteConfig:p,role:l,emailAddress:N,isB2BUser:s,selectCompanyHierarchyId:P,isAgenting:i,taxZoneRates:v,enteredInclusiveTax:C,isEnableProduct:T,purchasabilityPermission:A,handleGetProductsById:g,getQuote:async()=>{const{search:x}=r,m=Fe(x,"date")||"",w={id:Number(n),date:m.toString()},{quote:k}=await(Number(l)===99?Pt(w):wt(w));return k}}}function yr(){const n=be(),{id:c,bcLanguage:p,quoteConfig:j,role:N,emailAddress:b,isB2BUser:l,selectCompanyHierarchyId:s,isAgenting:P,taxZoneRates:i,enteredInclusiveTax:u,isEnableProduct:v,purchasabilityPermission:C,handleGetProductsById:T,getQuote:A}=Zt(),[g]=fe(),r=W(),[t,x]=f.useState({}),[m,w]=f.useState([]),[k,L]=f.useState([]),[R,H]=f.useState(!1),[F,S]=f.useState(!0),[D,U]=f.useState({originalSubtotal:0,discount:0,tax:0,shipping:0,totalAmount:0}),[$,a]=f.useState(!1),[ce,K]=f.useState(!1),[te,X]=f.useState(0),[Y,re]=f.useState({oos:"",nonPurchasable:""}),[se,ne]=f.useState({quotePurchasabilityPermission:!1,quoteConvertToOrderPermission:!1}),[oe,J]=f.useState(!1),Z=ge();f.useEffect(()=>{if(!(t!=null&&t.id))return;const{quoteConvertToOrderPermission:o}=ut,d=()=>{var q,B;if(l){const z=((q=t==null?void 0:t.companyId)==null?void 0:q.id)||null,ee=((B=t==null?void 0:t.contactInfo)==null?void 0:B.email)||"";return{quotePurchasabilityPermission:C,quoteConvertToOrderPermission:ht({code:o,companyId:z,userEmail:ee})}}return{quotePurchasabilityPermission:!0,quoteConvertToOrderPermission:!0}},{quotePurchasabilityPermission:I,quoteConvertToOrderPermission:E}=d();ne({quotePurchasabilityPermission:I,quoteConvertToOrderPermission:E})},[l,t,s,C]),f.useEffect(()=>{let o="",d="";m.forEach(E=>{const q=dt(E);q!=null&&q.type&&v&&!(E!=null&&E.purchaseHandled)&&(q.type==="oos"&&(o+="".concat(E.productName).concat(o?",":"")),q.type==="non-purchasable"&&(d+="".concat(E.productName).concat(d?",":"")))});const I=!!o||!!d;v&&R&&I&&(o&&V.error(r("quoteDetail.message.insufficientStock",{ProductName:o})),d&&V.error(r("quoteDetail.message.nonPurchasable",{ProductName:d}))),S(I),re({oos:o,nonPurchasable:d})},[v,R,m]);const ye=f.useCallback(()=>{if(F){const{oos:o,nonPurchasable:d}=Y;o&&V.error(r("quoteDetail.message.insufficientStock",{ProductName:o})),d&&V.error(r("quoteDetail.message.nonPurchasable",{ProductName:d}))}return F},[F,Y]),le=[];if(i!=null&&i.length){const o=i==null?void 0:i.find(d=>d.id===1);if(o){const{rates:d=[]}=o;d[0]&&d[0].enabled&&d[0].classRates.length&&d[0].classRates.forEach(I=>le.push(I))}}const Ce=(o,d)=>{var I;if(d.length){const E=Ee(d,"[0].bc_calculated_price.tax_exclusive",0),q=Ee(d,"[0].bc_calculated_price.tax_inclusive",0);return E>0?(q-E)/E:0}return le.length?(((I=le.find(E=>E.taxClassId===o))==null?void 0:I.rate)||0)/100:0},He=async o=>{const d=await kt(),I=[];return d.length&&d.forEach(E=>{const q=E,B=o.find(z=>z.fieldName===q.name);I.push({fieldName:q.name||"",fieldValue:(B==null?void 0:B.fieldValue)||q.default})}),I},Ue=async()=>{a(!0),K(!1);try{const o=await A(),d=await T(o.productsList).catch(()=>{}),I=await He(o.extraFields);if(x({...o,extraFields:I}),U({originalSubtotal:o.subtotal,discount:o.discount,tax:o.taxTotal,shipping:o.shippingTotal,totalAmount:o.totalAmount}),w(d),Number(o.shippingTotal)===0)X(Number(o.taxTotal));else{let M=0;d==null||d.forEach(Je=>{const{quantity:Pe,offeredPrice:we,productsSearch:{variants:Ze=[],taxClassId:et}}=Je,ue=Ce(et,Ze);M+=u?Number(we)*ue/(1+ue)*Number(Pe):Number(we)*ue*Number(Pe)}),X(M)}const{backendAttachFiles:E=[],storefrontAttachFiles:q=[],salesRep:B,salesRepEmail:z}=o;H(!!B||!!z);const ee=[];return q.forEach(M=>{ee.push({fileName:M.fileName,fileType:M.fileType,fileUrl:M.fileUrl,id:M.id,hasDelete:t.status!==4,title:r("quoteDetail.uploadedByCustomer",{createdBy:M.createdBy})})}),E.forEach(M=>{ee.push({fileName:M.fileName,fileType:M.fileType,fileUrl:M.fileUrl,id:M.id,title:r("quoteDetail.uploadedBySalesRep",{createdBy:M.createdBy})})}),L(ee),o}catch(o){throw V.error(o),o}finally{a(!1),K(!0)}},je=async o=>{a(!0);const{id:d,createdAt:I}=t;try{const E={quoteId:Number(d),createdAt:I,isPreview:o,lang:p},q=await St(E);if(q)return{url:q.quoteFrontendPdf.url,content:q.quoteFrontendPdf.content}}catch(E){V.error(E)}return{url:"",content:""}},ze=async()=>{try{const{url:o}=await je(!1);o&&window.open("".concat(o),"_blank")}catch(o){V.error(o)}finally{a(!1)}},Oe=async()=>{var o,d,I,E,q;try{const{content:B}=await je(!0),z=document.createElement("iframe");z.setAttribute("style","display:none;"),(o=document.getElementById("bundle-container"))==null||o.appendChild(z),(d=z.contentDocument)==null||d.open(),(I=z.contentDocument)==null||I.write(B),(E=z.contentDocument)==null||E.close(),a(!1),(q=z.contentWindow)==null||q.print()}catch(B){V.error(B)}},Ve=async o=>{let d=m;if(d.length===0){const B=await Ue();d=(B==null?void 0:B.productsList)||[]}const I=Number(o.offset),E=Number(o.first)+I;return d.length?{edges:d.slice(I,E),totalCount:d.length}:{edges:[],totalCount:0}};f.useEffect(()=>{const{state:o}=Z;o&&(setTimeout(()=>{V.success(Number(N)===100?r("quoteDetail.submittedQuote"):r("quoteDetail.quoteSubmitted"),{action:{label:Number(N)===100?r("quoteDetail.copyQuoteLink"):r("quoteDetail.reviewAllQuotes"),onClick:()=>{Number(N)===100?($t(window.location.href),V.success(r("quoteDetail.copySuccessful"))):n("/quotes")}}})},10),Z.state=null)},[Z,n,N]);const _e=async()=>{try{J(!0),await Me({quoteId:c,proceedingCheckoutFn:ye,role:N,location:Z,navigate:n})}finally{J(!1)}};f.useEffect(()=>{Z.search.includes("isCheckout")&&c&&_e()},[c,F]);const We=f.useMemo(()=>{var d;return!(!(((d=j.find(I=>I.key==="quote_auto_quoting"))==null?void 0:d.value)==="1")&&!R)},[j,R]),Ge=()=>v?!!(R&&F||!F):!0,Ke=f.useMemo(()=>{var d;const o=(d=t==null?void 0:t.extraFields)==null?void 0:d.map(I=>({fieldName:I.fieldName,value:I.fieldValue}));return{info:{quoteTitle:(t==null?void 0:t.quoteTitle)||"",referenceNumber:(t==null?void 0:t.referenceNumber)||""},extraFields:o||[],recipients:(t==null?void 0:t.recipients)||[]}},[t]);pt(!1);const{quotePurchasabilityPermission:Xe,quoteConvertToOrderPermission:Ye}=se;return e.jsx(Qe,{isSpinning:$||oe,children:e.jsxs(h,{sx:{display:"flex",flexDirection:"column",flex:1},children:[e.jsx(Ot,{status:t.status,quoteNumber:t.quoteNumber,issuedAt:t.createdAt,expirationDate:t.expiredAt,exportPdf:ze,printQuote:Oe,role:N,salesRepInfo:t.salesRepInfo}),e.jsx(h,{sx:{marginTop:"1rem"},children:e.jsx(Nt,{quoteAndExtraFieldsInfo:Ke,contactInfo:t.contactInfo,shippingAddress:t.shippingAddress,billingAddress:t.billingAddress})}),e.jsxs(O,{container:!0,spacing:g?2:0,rowSpacing:0,sx:{overflow:"auto",flexWrap:g?"wrap":"nowrap",paddingBottom:"20px",marginBottom:g?"6rem":0,marginTop:g?0:"1rem","@media print":{overflow:"hidden"}},children:[e.jsx(O,{item:!0,xs:g?12:8,rowSpacing:0,sx:g?{flexBasis:"100%",pl:"16px"}:{mr:"16px"},children:e.jsx(h,{sx:g?{flexBasis:"100%"}:{},children:e.jsx(Yt,{total:m.length,currency:t.currency,isHandleApprove:R,getQuoteTableDetails:Ve,getTaxRate:Ce,displayDiscount:t.displayDiscount})})}),e.jsxs(O,{item:!0,xs:g?12:4,rowSpacing:0,sx:g?{flexBasis:"100%"}:{pl:0},children:[e.jsx(h,{sx:{marginBottom:"1rem"},children:e.jsx(Vt,{isHideQuoteCheckout:F,quoteSummary:D,quoteDetailTax:te,status:t.status,quoteDetail:t})}),t.notes&&e.jsx(h,{sx:{marginBottom:"1rem",displayPrint:"none"},children:e.jsx(vt,{quoteNotes:t.notes})}),e.jsx(h,{sx:{marginBottom:"1rem",displayPrint:"none"},children:e.jsx(Ut,{id:c,status:t.status,isB2BUser:l,email:b||"",msgs:(t==null?void 0:t.trackingHistory)||[]})}),e.jsx(h,{sx:{marginBottom:"1rem",displayPrint:"none"},children:e.jsx(Tt,{allowUpload:Number(t.status)!==4,quoteId:t.id,status:t.status,defaultFileList:k})}),t.legalTerms&&e.jsx(h,{sx:{displayPrint:"none"},children:e.jsx(Jt,{quoteLegalTerms:t.legalTerms})})]})]}),Ye&&Xe&&Number(t.status)!==4&&ce&&(t==null?void 0:t.allowCheckout)&&We&&Ge()&&e.jsx(zt,{quoteId:t.id,role:N,isAgenting:P,status:t.status,proceedingCheckoutFn:ye})]})})}export{yr as default};
//# sourceMappingURL=index-DXw4m3yz.js.map
