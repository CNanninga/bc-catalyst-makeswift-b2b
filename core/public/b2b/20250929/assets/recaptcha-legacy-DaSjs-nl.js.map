{"version":3,"file":"recaptcha-legacy-DaSjs-nl.js","sources":["../../src/components/captcha/Captcha.tsx","../../src/components/captcha/frameCaptchaCode.js?raw","../../src/shared/service/b2b/graphql/recaptcha.ts"],"sourcesContent":["import { useEffect, useMemo, useRef } from 'react';\n\nimport { themeFrameSelector, useAppSelector } from '@/store';\n\n// eslint-disable-next-line import/extensions\nimport FRAME_HANDLER_CODE from './frameCaptchaCode.js?raw';\n\nconst CAPTCHA_URL = 'https://www.google.com/recaptcha/api.js?render=explicit';\n\ninterface CaptchaProps {\n  siteKey: string;\n  size?: 'compact' | 'normal';\n  theme?: 'dark' | 'light';\n  handleGetKey: (arg: string) => void;\n}\n\nexport function loadCaptchaScript(iframeDocument: HTMLIFrameElement['contentDocument']) {\n  if (iframeDocument?.head.querySelector(`script[src=\"${CAPTCHA_URL}\"]`) === null) {\n    const captchaScript = iframeDocument.createElement('script');\n    captchaScript.src = CAPTCHA_URL;\n    iframeDocument.head.appendChild(captchaScript);\n  }\n}\n\nexport function loadCaptchaWidgetHandlers(\n  iframeDocument: HTMLIFrameElement['contentDocument'],\n  widgetId: string,\n) {\n  if (!iframeDocument) {\n    return;\n  }\n\n  const handlerScript = iframeDocument.createElement('script');\n\n  const code = FRAME_HANDLER_CODE.replace(/PREFIX/g, widgetId).replace(\n    /PARENT_ORIGIN/g,\n    window.location.origin,\n  );\n\n  handlerScript.textContent = code;\n  iframeDocument.head.appendChild(handlerScript);\n}\n\nconst useWidgetId = () => {\n  return useMemo(() => `widget_${Date.now()}`, []);\n};\n\nexport function Captcha({ theme, size, handleGetKey, siteKey }: CaptchaProps) {\n  const iframeDocument = useAppSelector(themeFrameSelector);\n  const widgetId = useWidgetId();\n  const initialized = useRef(false);\n\n  useEffect(() => {\n    const onMessage = (event: MessageEvent) => {\n      if (event?.data?.startsWith?.(widgetId)) {\n        const message = event.data.slice(widgetId.length);\n        const { payload: key, type } = JSON.parse(message);\n\n        if (type === 'CAPTCHA_SUCCESS' && key) {\n          handleGetKey(key);\n        }\n      }\n    };\n\n    window.addEventListener('message', onMessage, false);\n\n    return () => {\n      if (initialized.current) {\n        window.removeEventListener('message', onMessage);\n      }\n    };\n  }, [widgetId, handleGetKey]);\n\n  useEffect(() => {\n    if (iframeDocument === undefined || initialized.current) {\n      return;\n    }\n\n    loadCaptchaScript(iframeDocument);\n    loadCaptchaWidgetHandlers(iframeDocument, widgetId);\n    initialized.current = true;\n  }, [iframeDocument, widgetId]);\n\n  return <div id={widgetId} data-sitekey={siteKey} data-theme={theme} data-size={size} />;\n}\n","export default \"/* eslint-disable */\\n\\nwindow.INITIALIZE_CAPTCHA_PREFIX = function () {\\n  if (window.grecaptcha?.render === undefined) {\\n    return\\n  }\\n\\n  if (window.WIDGET_TIMER_PREFIX !== null) {\\n    window.clearInterval(window.WIDGET_TIMER_PREFIX)\\n    window.WIDGET_TIMER_PREFIX = null\\n  }\\n\\n  var sendMessage = function (eventType, payload) {\\n    window.parent.postMessage(\\n      'PREFIX' +\\n        JSON.stringify({\\n          type: eventType,\\n          payload: payload,\\n        }),\\n      'PARENT_ORIGIN'\\n    )\\n  }\\n\\n  window.grecaptcha.render(\\n    'PREFIX',\\n    {\\n      callback: function (token) {\\n        sendMessage('CAPTCHA_SUCCESS', token)\\n      },\\n      'error-callback': function () {\\n        sendMessage('CAPTCHA_ERROR', null)\\n      },\\n      'expired-callback': function () {\\n        sendMessage('CAPTCHA_EXPIRED', null)\\n      },\\n    },\\n    true\\n  )\\n}\\n\\nwindow.WIDGET_TIMER_PREFIX = window.setInterval(\\n  window.INITIALIZE_CAPTCHA_PREFIX,\\n  250\\n)\\n\"","import B3Request from '../../request/b3Fetch';\n\nconst getStorefrontTokenQuery = `query {\n    site {\n        settings {\n            reCaptcha {\n                siteKey\n                isEnabledOnStorefront\n            }\n        }\n    }\n}`;\n\nconst resetPassword = `mutation recaptcha($token: String!, $email: String!) {\n    customer {\n      requestResetPassword(\n        reCaptchaV2: { \n            token: $token\n        },\n        input: {\n          email: $email,\n        }\n      ) {\n        errors {\n          ... on ValidationError {\n            message\n          }\n        }\n      }\n    }\n  }\n`;\n\nexport const requestResetPassword = (token: string, email: string): Promise<void> =>\n  B3Request.graphqlBCProxy({\n    query: resetPassword,\n    variables: { token, email },\n  });\n\ninterface CaptchaConfig {\n  siteKey: string;\n  isEnabledOnStorefront: boolean;\n}\n\nexport const getStorefrontToken = (): Promise<CaptchaConfig | undefined> =>\n  B3Request.graphqlBCProxy({\n    query: getStorefrontTokenQuery,\n  }).then((res) => res?.data?.site?.settings?.reCaptcha);\n"],"names":["theme","size","handleGetKey","siteKey","iframeDocument","useAppSelector","themeFrameSelector","widgetId","useWidgetId","initialized","useRef","useEffect","onMessage","event","data","startsWith","message","slice","length","payload","key","type","JSON","parse","window","addEventListener","current","removeEventListener","head","querySelector","CAPTCHA_URL","captchaScript","createElement","src","appendChild","loadCaptchaScript","handlerScript","code","FRAME_HANDLER_CODE","replace","location","origin","textContent","loadCaptchaWidgetHandlers","jsx","id","useMemo","Date","now","exports","token","email","B3Request","graphqlBCProxy","query","variables","then","res","site","settings","reCaptcha"],"mappings":"6OA+CO,UAAiBA,MAAEA,EAAAC,KAAOA,EAAAC,aAAMA,EAAAC,QAAcA,IACnD,MAAMC,EAAiBC,EAAeC,GAChCC,EAAWC,IACXC,EAAcC,EAAAA,QAAO,GAiC3B,OA/BAC,EAAAA,UAAU,KACR,MAAMC,EAAaC,IACjB,GAAIA,GAAOC,MAAMC,aAAaR,GAAW,CACvC,MAAMS,EAAUH,EAAMC,KAAKG,MAAMV,EAASW,SAClCC,QAASC,EAAAC,KAAKA,GAASC,KAAKC,MAAMP,GAE7B,oBAATK,GAA8BD,GAChClB,EAAakB,EAEjB,GAKF,OAFAI,OAAOC,iBAAiB,UAAWb,GAAW,GAEvC,KACDH,EAAYiB,SACdF,OAAOG,oBAAoB,UAAWf,KAGzC,CAACL,EAAUL,IAEdS,EAAAA,UAAU,UACe,IAAnBP,GAAgCK,EAAYiB,UA1D7C,SAA2BtB,GAChC,GAA2E,OAAvEA,GAAgBwB,KAAKC,cAAc,eAAeC,OAA2B,CAC/E,MAAMC,EAAgB3B,EAAe4B,cAAc,UACnDD,EAAcE,IAAMH,EACpB1B,EAAewB,KAAKM,YAAYH,EAClC,CACF,CAwDII,CAAkB/B,GAtDf,SACLA,EACAG,GAEA,IAAKH,EACH,OAGF,MAAMgC,EAAgBhC,EAAe4B,cAAc,UAE7CK,EAAOC,EAAmBC,QAAQ,UAAWhC,GAAUgC,QAC3D,iBACAf,OAAOgB,SAASC,QAGlBL,EAAcM,YAAcL,EAC5BjC,EAAewB,KAAKM,YAAYE,EAClC,CAsCIO,CAA0BvC,EAAgBG,GAC1CE,EAAYiB,SAAU,IACrB,CAACtB,EAAgBG,IAEbqC,MAAC,OAAIC,GAAItC,EAAU,eAAcJ,EAAS,aAAYH,EAAO,YAAWC,GACjF,GCpFA,MAAAqC,EAAe,29BDOTR,EAAc,0DAoCdtB,EAAcA,IACXsC,EAAAA,QAAQ,IAAM,UAAUC,KAAKC,QAAS,IEXlCC,EAAA,IAAuB,CAACC,EAAeC,IAClDC,EAAUC,eAAe,CACvBC,MAtBkB,kWAuBlBC,UAAW,CAAEL,QAAOC,YAQXF,EAAA,IAAqB,IAChCG,EAAUC,eAAe,CACvBC,MA5C4B,yKA6C3BE,KAAMC,GAAQA,GAAK3C,MAAM4C,MAAMC,UAAUC"}