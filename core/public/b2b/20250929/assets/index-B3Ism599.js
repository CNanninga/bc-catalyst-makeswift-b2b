import{j as y}from"./mui-DjJKBaL-.js";import{r as b}from"./intl-D34a3Rgg.js";import{c as B}from"./load-functions-utyuqH_X.js";import{b9 as T,j as v,u as S,aM as j,a7 as E,ba as V,bb as F,bc as D,bd as G,be as N,G as R,y as U,bf as _}from"./react-setup-Ctz-bmMs.js";import"./base-CC7kTJh2.js";import{b as H,c as M}from"./shoppingList-5c4DgHH6.js";import{O as z,C as $}from"./OrderShoppingList-qu8HwRgc.js";import{a as J}from"./router-DcuTQ_yx.js";import"./reactVendor-CkUTLE5B.js";import"./eCache-97HTO8co.js";import"../index.js";import"./global-D7Yn0gGb.js";import"./redux-Bt5-tVzx.js";import"./toolkit-CpEbzTSY.js";import"./lodashEs-CONzB2I0.js";import"./muiIcon-BBtg8u0V.js";import"./dropzone-B1UJxEDf.js";import"./dateFns-DubixNBV.js";import"./form-pKe_k4Gy.js";import"./B3CustomForm-BLuJSiae.js";class w extends Error{constructor(s){super(s),this.name="ValidationError"}}const K=o=>{const s=o instanceof w?o.message:"Something went wrong. Please try again.";T.error(s)};function Q(){const o=v(),s=S(({global:e})=>e.setOpenPageFn),i=e=>s==null?void 0:s({isOpen:!0,openUrl:"/shoppingList/".concat(e),params:{shoppingListBtn:"add"}});return e=>{T.success(o("shoppingList.addToShoppingList.productsAdded"),{action:{label:o("pdp.notification.viewShoppingList"),onClick:()=>i(e)}})}}const W=async({isB2BUser:o,customerGroupId:s,items:i,shoppingListId:e})=>{var u,l;const{currency_code:h}=j(),{id:a}=E.getState().company.companyInfo,{productsSearch:f}=await V({productIds:i.map(({productId:n})=>n),currencyCode:h,companyId:a,customerGroupId:s}),t=F(f),r=[];for(let n=0;n<t.length;n+=1){const{allOptions:g,variants:p}=t[n],{productId:c,sku:m,variantId:L,quantity:C,optionSelections:I}=i[n],q=L||((u=p.find(A=>A.sku===m))==null?void 0:u.variant_id)||((l=p[0])==null?void 0:l.variant_id),O=I?D(I):[],{isValid:P,message:x}=G(g,O);if(!P)throw new w(x);const k=N(O,t[n]);r.push({productId:c,variantId:q,quantity:C,optionList:k})}await(o?H:M)({shoppingListId:e,items:r})};function X(){const{state:{shoppingListClickNode:o}}=b.useContext(R),s=S(({company:t})=>t.customer.customerGroupId),i=S(({global:t})=>t.storeInfo.platform),e=S(({global:t})=>t.setOpenPageFn),h=S(U);return{setOpenPageFn:e,getShoppingListItem:()=>{var n,g,p,c,m;if(i!=="bigcommerce")return window.b2b.utils.shoppingList.itemFromCurrentPage[0];if(!o)return;const t=o.closest(B["dom.productView"]);if(!t)return;const r=(n=t.querySelector("input[name=product_id]"))==null?void 0:n.value,d=(p=(g=t.querySelector('[name="qty[]"]'))==null?void 0:g.value)!=null?p:1,u=((m=(c=t.querySelector("[data-product-sku]"))==null?void 0:c.innerHTML)!=null?m:"").trim(),l=t.querySelector("form[data-cart-item-add]");return{productId:Number(r),sku:u,quantity:Number(d),optionSelections:_(l)}},addToShoppingList:({shoppingListId:t,product:r})=>W({isB2BUser:h,customerGroupId:s,shoppingListId:t,items:[r]})}}function Lt(){const{setOpenPageFn:o,getShoppingListItem:s,addToShoppingList:i}=X(),e=v(),[h,a]=b.useState(!0),[f,t]=b.useState(!1),[r,d]=b.useState(!1),u=Q(),l=J(),n=()=>{window.scrollTo(0,0),a(!1),t(!1),l("/"),o==null||o({isOpen:!1,openUrl:""})},g=async L=>{const C=s();if(C)try{d(!0),await i({shoppingListId:L,product:C}).then(()=>u(L)).catch(K),n()}finally{d(!1)}},p=()=>{a(!1),t(!0)},c=()=>{t(!1),a(!0)},m=()=>{c(),a(!0)};return y.jsxs(y.Fragment,{children:[y.jsx(z,{isOpen:h,dialogTitle:e("pdp.addToShoppingList"),onClose:n,onConfirm:g,onCreate:p,isLoading:r,setLoading:d}),y.jsx($,{open:f,onChange:m,onClose:c})]})}export{W as addProductsToShoppingList,K as addProductsToShoppingListErrorHandler,Lt as default,Q as useAddedToShoppingListAlert};
//# sourceMappingURL=index-B3Ism599.js.map
