{"version":3,"file":"index-legacy-Dbad94uA.js","sources":["../../src/pages/ForgotPassword/index.tsx"],"sourcesContent":["import { useContext, useEffect, useState } from 'react';\nimport { useForm } from 'react-hook-form';\nimport { useNavigate } from 'react-router-dom';\nimport { Box, ImageListItem, Typography } from '@mui/material';\n\nimport { B3Card, B3CustomForm } from '@/components';\nimport CustomButton from '@/components/button/CustomButton';\nimport { Captcha } from '@/components/form';\nimport B3Spin from '@/components/spin/B3Spin';\nimport { useMobile } from '@/hooks';\nimport { useB3Lang } from '@/lib/lang';\nimport { CustomStyleContext } from '@/shared/customStyleButton';\nimport { GlobalContext } from '@/shared/global';\nimport { getStorefrontToken, requestResetPassword } from '@/shared/service/b2b/graphql/recaptcha';\nimport b2bLogger from '@/utils/b3Logger';\n\nimport { getForgotPasswordFields, sendForgotPasswordEmailFor } from '../Login/config';\nimport { B3ResetPassWordButton, LoginImage } from '../Login/styled';\nimport { type PageProps } from '../PageProps';\n\ninterface ForgotPasswordProps extends PageProps {\n  logo?: string;\n  isEnabledOnStorefront: boolean;\n  storefrontSiteKey: string;\n}\n\ninterface FormFields {\n  email: string;\n}\n\nexport function ForgotPassword({\n  setOpenPage,\n  isEnabledOnStorefront,\n  storefrontSiteKey,\n  logo,\n}: ForgotPasswordProps) {\n  const [isMobile] = useMobile();\n  const [isLoading, setLoading] = useState<boolean>(false);\n  const b3Lang = useB3Lang();\n  const forgotPasswordFields = getForgotPasswordFields(b3Lang);\n  const [isCaptchaMissing, setIsCaptchaMissing] = useState(false);\n  const [captchaKey, setCaptchaKey] = useState('');\n\n  const {\n    control,\n    handleSubmit,\n    getValues,\n    formState: { errors },\n    setValue,\n  } = useForm<FormFields>({\n    mode: 'onSubmit',\n  });\n\n  const navigate = useNavigate();\n\n  useEffect(() => {\n    if (captchaKey || !isEnabledOnStorefront) setIsCaptchaMissing(false);\n  }, [captchaKey, isEnabledOnStorefront]);\n\n  const handleLoginClick = handleSubmit(async ({ email }) => {\n    if (isEnabledOnStorefront && !captchaKey) {\n      setIsCaptchaMissing(true);\n      return;\n    }\n\n    try {\n      setLoading(true);\n      if (isEnabledOnStorefront && captchaKey) {\n        try {\n          await requestResetPassword(captchaKey, email);\n          navigate('/login?loginFlag=receivePassword');\n          setLoading(false);\n        } catch (e) {\n          b2bLogger.error(e);\n        }\n      }\n\n      if (!isEnabledOnStorefront) {\n        await sendForgotPasswordEmailFor(email);\n        setLoading(false);\n        navigate('/login?loginFlag=receivePassword');\n      }\n    } catch (e) {\n      b2bLogger.error(e);\n    }\n  });\n\n  return (\n    <B3Card setOpenPage={setOpenPage}>\n      <Box\n        sx={{\n          bgcolor: '#FFFFFF',\n          borderRadius: '4px',\n          display: 'flex',\n          flexDirection: 'column',\n          mr: 'auto',\n          ml: 'auto',\n          maxWidth: '537px',\n        }}\n      >\n        <Box sx={{ mt: '20px' }}>\n          {logo && (\n            <LoginImage>\n              <ImageListItem\n                sx={{\n                  maxWidth: isMobile ? '175px' : '250px',\n                }}\n                onClick={() => {\n                  window.location.assign('/');\n                }}\n              >\n                <img src={logo} alt={b3Lang('global.tips.registerLogo')} loading=\"lazy\" />\n              </ImageListItem>\n            </LoginImage>\n          )}\n        </Box>\n        <Box\n          sx={{\n            margin: '20px 0 0 0',\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          <Typography\n            variant=\"h5\"\n            sx={{\n              margin: '16px 0',\n            }}\n          >\n            {b3Lang('forgotPassword.resetPassword')}\n          </Typography>\n          <Typography\n            variant=\"body1\"\n            sx={{\n              margin: '0 16px 16px 16px',\n            }}\n          >\n            {b3Lang('forgotPassword.requestEmail')}\n          </Typography>\n          <B3CustomForm\n            formFields={forgotPasswordFields}\n            errors={errors}\n            control={control}\n            getValues={getValues}\n            setValue={setValue}\n            sx={{ margin: '0 16px', maxWidth: isMobile ? '311px' : '505px' }}\n          />\n          {isEnabledOnStorefront && isCaptchaMissing ? (\n            <Typography\n              variant=\"body1\"\n              sx={{\n                color: 'red',\n                display: 'flex',\n                alignSelf: 'flex-start',\n                marginLeft: '18px',\n                marginTop: '2px',\n                fontSize: '13px',\n              }}\n            >\n              {b3Lang('login.loginText.missingCaptcha')}\n            </Typography>\n          ) : (\n            ''\n          )}\n          {isEnabledOnStorefront ? (\n            <Box sx={{ marginTop: '20px' }}>\n              <Captcha siteKey={storefrontSiteKey} size=\"normal\" handleGetKey={setCaptchaKey} />\n            </Box>\n          ) : (\n            ''\n          )}\n          <B3Spin isSpinning={isLoading} size={20} isFlex={false}>\n            <B3ResetPassWordButton>\n              <CustomButton\n                type=\"submit\"\n                size=\"medium\"\n                onClick={handleLoginClick}\n                variant=\"contained\"\n                sx={{ width: 'auto' }}\n              >\n                {b3Lang('forgotPassword.resetPasswordBtn')}\n              </CustomButton>\n            </B3ResetPassWordButton>\n          </B3Spin>\n        </Box>\n      </Box>\n    </B3Card>\n  );\n}\n\nexport default function Page({ setOpenPage }: PageProps) {\n  const { logo } = useContext(GlobalContext).state;\n  const { loginPageDisplay } = useContext(CustomStyleContext).state;\n  const [isEnabledOnStorefront, setIsEnabledOnStorefront] = useState(false);\n  const [storefrontSiteKey, setStorefrontSiteKey] = useState('');\n\n  useEffect(() => {\n    const getIsEnabledOnStorefront = async () => {\n      try {\n        const response = await getStorefrontToken();\n\n        if (response) {\n          setIsEnabledOnStorefront(response.isEnabledOnStorefront);\n          setStorefrontSiteKey(response.siteKey);\n        }\n      } catch (e) {\n        b2bLogger.error(e);\n      }\n    };\n\n    getIsEnabledOnStorefront();\n  }, []);\n\n  return (\n    <ForgotPassword\n      setOpenPage={setOpenPage}\n      logo={loginPageDisplay.displayStoreLogo ? logo : undefined}\n      isEnabledOnStorefront={isEnabledOnStorefront}\n      storefrontSiteKey={storefrontSiteKey}\n    />\n  );\n}\n"],"names":["ForgotPassword","setOpenPage","isEnabledOnStorefront","storefrontSiteKey","logo","isMobile","useMobile","isLoading","setLoading","useState","b3Lang","useB3Lang","forgotPasswordFields","getForgotPasswordFields","isCaptchaMissing","setIsCaptchaMissing","captchaKey","setCaptchaKey","control","handleSubmit","getValues","formState","errors","setValue","useForm","mode","navigate","useNavigate","useEffect","handleLoginClick","async","email","requestResetPassword","e","b2bLogger","error","sendForgotPasswordEmailFor","jsx","B3Card","children","jsxs","Box","sx","bgcolor","borderRadius","display","flexDirection","mr","ml","maxWidth","mt","LoginImage","ImageListItem","onClick","window","location","assign","src","alt","loading","margin","alignItems","justifyContent","Typography","variant","B3CustomForm","formFields","color","alignSelf","marginLeft","marginTop","fontSize","Captcha","siteKey","size","handleGetKey","B3Spin","isSpinning","isFlex","B3ResetPassWordButton","CustomButton","type","width","useContext","GlobalContext","state","loginPageDisplay","CustomStyleContext","setIsEnabledOnStorefront","setStorefrontSiteKey","response","getStorefrontToken","getIsEnabledOnStorefront","displayStoreLogo"],"mappings":"4kCA8BO,SAASA,GAAeC,YAC7BA,EAAAC,sBACAA,EAAAC,kBACAA,EAAAC,KACAA,IAEA,MAAOC,GAAYC,KACZC,EAAWC,GAAcC,EAAAA,UAAkB,GAC5CC,EAASC,IACTC,EAAuBC,EAAwBH,IAC9CI,EAAkBC,GAAuBN,EAAAA,UAAS,IAClDO,EAAYC,GAAiBR,EAAAA,SAAS,KAEvCS,QACJA,EAAAC,aACAA,EAAAC,UACAA,EACAC,WAAWC,OAAEA,GAAOC,SACpBA,GACEC,EAAoB,CACtBC,KAAM,aAGFC,EAAWC,IAEjBC,EAAAA,UAAU,MACJZ,GAAed,GAAuBa,GAAoB,IAC7D,CAACC,EAAYd,IAEhB,MAAM2B,EAAmBV,EAAaW,OAASC,YAC7C,IAAI7B,GAA0Bc,EAK9B,IAEE,GADAR,GAAW,GACPN,GAAyBc,EAC3B,UACQgB,EAAqBhB,EAAYe,GACvCL,EAAS,oCACTlB,GAAW,EACb,OAASyB,GACPC,EAAUC,MAAMF,EAClB,CAGG/B,UACGkC,EAA2BL,GACjCvB,GAAW,GACXkB,EAAS,oCAEb,OAASO,GACPC,EAAUC,MAAMF,EAClB,MAvBElB,GAAoB,KA0BxB,OACEsB,EAAAA,IAACC,GAAOrC,cACNsC,SAAAC,EAAAA,KAACC,EAAA,CACCC,GAAI,CACFC,QAAS,UACTC,aAAc,MACdC,QAAS,OACTC,cAAe,SACfC,GAAI,OACJC,GAAI,OACJC,SAAU,SAGZV,SAAA,CAAAF,EAAAA,IAACI,EAAA,CAAIC,GAAI,CAAEQ,GAAI,QACZX,SAAAnC,SACE+C,EAAA,CACCZ,SAAAF,EAAAA,IAACe,EAAA,CACCV,GAAI,CACFO,SAAU5C,EAAW,QAAU,SAEjCgD,QAASA,KACPC,OAAOC,SAASC,OAAO,MAGzBjB,SAAAF,EAAAA,IAAC,OAAIoB,IAAKrD,EAAMsD,IAAKhD,EAAO,4BAA6BiD,QAAQ,eAKzEnB,EAAAA,KAACC,EAAA,CACCC,GAAI,CACFkB,OAAQ,aACRf,QAAS,OACTC,cAAe,SACfe,WAAY,SACZC,eAAgB,UAGlBvB,SAAA,CAAAF,EAAAA,IAAC0B,EAAA,CACCC,QAAQ,KACRtB,GAAI,CACFkB,OAAQ,UAGTrB,WAAO,kCAEVF,EAAAA,IAAC0B,EAAA,CACCC,QAAQ,QACRtB,GAAI,CACFkB,OAAQ,oBAGTrB,WAAO,iCAEVF,EAAAA,IAAC4B,EAAA,CACCC,WAAYtD,EACZU,SACAJ,UACAE,YACAG,WACAmB,GAAI,CAAEkB,OAAQ,SAAUX,SAAU5C,EAAW,QAAU,WAExDH,GAAyBY,EACxBuB,EAAAA,IAAC0B,EAAA,CACCC,QAAQ,QACRtB,GAAI,CACFyB,MAAO,MACPtB,QAAS,OACTuB,UAAW,aACXC,WAAY,OACZC,UAAW,MACXC,SAAU,QAGXhC,WAAO,oCAGV,GAEDrC,EACCmC,EAAAA,IAACI,EAAA,CAAIC,GAAI,CAAE4B,UAAW,QACpB/B,SAAAF,EAAAA,IAACmC,EAAA,CAAQC,QAAStE,EAAmBuE,KAAK,SAASC,aAAc1D,MAGnE,GAEFoB,EAAAA,IAACuC,GAAOC,WAAYtE,EAAWmE,KAAM,GAAII,QAAQ,EAC/CvC,SAAAF,EAAAA,IAAC0C,EAAA,CACCxC,SAAAF,EAAAA,IAAC2C,EAAA,CACCC,KAAK,SACLP,KAAK,SACLrB,QAASxB,EACTmC,QAAQ,YACRtB,GAAI,CAAEwC,MAAO,QAEZ3C,WAAO,gDAQxB,6BAEA,UAA6BtC,YAAEA,IAC7B,MAAMG,KAAEA,GAAS+E,aAAWC,GAAeC,OACrCC,iBAAEA,GAAqBH,aAAWI,GAAoBF,OACrDnF,EAAuBsF,GAA4B/E,EAAAA,UAAS,IAC5DN,EAAmBsF,GAAwBhF,EAAAA,SAAS,IAmB3D,OAjBAmB,EAAAA,UAAU,KACyBE,WAC/B,IACE,MAAM4D,QAAiBC,IAEnBD,IACFF,EAAyBE,EAASxF,uBAClCuF,EAAqBC,EAASjB,SAElC,OAASxC,GACPC,EAAUC,MAAMF,EAClB,GAGF2D,IACC,IAGDvD,EAAAA,IAACrC,EAAA,CACCC,cACAG,KAAMkF,EAAiBO,iBAAmBzF,OAAO,EACjDF,wBACAC,qBAGN"}