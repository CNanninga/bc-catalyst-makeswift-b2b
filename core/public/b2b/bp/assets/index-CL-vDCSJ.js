import{j as t,s as Fe,v as ne,x as re,O as je,A as Ee,ae as Le,T as Be,w as Ae,B as J,I as he,af as we}from"./mui-DjJKBaL-.js";import{r as f}from"./intl-D34a3Rgg.js";import{B as Ie}from"./B3Filter-DObKChJb.js";import{j as Y,ad as ge,ak as v,ag as ke,al as ve,a as be,aj as Ne,u as G,y as Te,G as Pe,ah as Ce,af as Re,am as qe,an as ze,ao as pe}from"./react-setup-Bynf4djQ.js";import"./load-functions-BXOIym8k.js";import{u as Oe,a as Ue}from"./useTableRef-CsMdwZmB.js";import{b as Q}from"./base-CC7kTJh2.js";import{c as Ve,u as De,a as Me,b as _e,d as Ge,e as He,g as Ke,f as We,h as Xe,i as $e}from"./address-CYtEo48I.js";import{b as Je,a as Qe,u as Ye,f as Ze,c as es}from"./config-C5eWAJB1.js";import{u as ss}from"./form-pKe_k4Gy.js";import{f as ts}from"./lodashEs-CONzB2I0.js";import{B as as}from"./B3CustomForm-CTyEaR6B.js";import{d as ie,v as is,g as Se}from"./config-CpxXwVv4.js";import{E as ns,f as rs}from"./muiIcon-BBtg8u0V.js";import"./reactVendor-CkUTLE5B.js";import"./eCache-97HTO8co.js";import"./B3FilterMore-BqyWUWvQ.js";import"./dateFns-DubixNBV.js";import"./B3FilterSearch-8dQX3CC_.js";import"./redux-Bt5-tVzx.js";import"./toolkit-CpEbzTSY.js";import"../index.Cj-kImQU.js";import"./global-D7Yn0gGb.js";import"./router-DcuTQ_yx.js";import"./dropzone-B1UJxEDf.js";import"./validatorRules-BSvG4GLb.js";const ds=Fe("div")(()=>({display:"flex","& div::first-of-type":{marginRight:"2rem"},"& div":{minWidth:"45%",display:"flex",flexDirection:"column"}}));function ls({addressFields:s,updateAddressList:m,companyId:c,isBCPermission:n,countries:r},A){const y=Y(),[S,p]=f.useState(!1),[C,R]=f.useState(""),[I,z]=f.useState(!1),[N,q]=f.useState(!1),[F,k]=f.useState(s),[V,K]=f.useState([]),[T,Z]=f.useState([]),[g,de]=f.useState(null),[E,O]=f.useState({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),P=!n,{control:U,handleSubmit:W,getValues:ee,formState:{errors:X},watch:$,setError:se,setValue:L,reset:te}=ss({mode:"all"}),M=async u=>{var l;try{const i=V.map(e=>({fieldName:ie(e.name),fieldValue:u[e.name]||e.default})),h=await is({extraFields:i});if(h.code!==200){const e=((l=h.data)==null?void 0:l.errMsg)||h.message||"",a=e.split(":");if(a.length>=2){const o=V.find(x=>ie(x.name)===a[0]);if(o)return se(o.name,{type:"manual",message:a[1]}),q(!1),!1}throw e}return!0}catch(i){throw v.error(i),i}},le=()=>{te(),O({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),p(!1),R("")},oe=()=>{W(async u=>{q(!0);try{if(!await M(u))return;const i=V.map(w=>({fieldName:ie(w.name),fieldValue:u[w.name]||w.default})),{country:h,state:e}=u;let a="",o="",x=e;r.forEach(w=>{const{countryName:d,countryCode:j,states:D}=w;if(j===h)if(a=d,D.length>0){const B=D.find(_=>_.stateCode===x||_.stateName===x);o=(B==null?void 0:B.stateName)||o,x=(B==null?void 0:B.stateCode)||x}else x="",o=e});const b={...u,companyId:Number(c),extraFields:i,isShipping:E.isShipping?1:0,isBilling:E.isBilling?1:0,isDefaultShipping:E.isDefaultShipping?1:0,isDefaultBilling:E.isDefaultBilling?1:0,country:a,countryCode:h,state:o,stateCode:x};if(C==="add")await Ve(b),v.success(y("addresses.addressForm.newAddressAdded"));else if(C==="edit"&&g){const{id:w}=g;await De({...b,id:Number(w)}),v.success(y("addresses.addressForm.addressUpdated"))}O({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),p(!1),await m(!0)}catch(l){v.error(l)}finally{q(!1)}})()},ce=()=>{W(async u=>{q(!0);try{const l=V.map(b=>({name:b.bcLabel,value:u[b.name]||b.default})),{country:i,state:h}=u;let e="",a="",o=h;r.forEach(b=>{const{countryName:w,countryCode:d,states:j}=b;if(d===i)if(e=w,j.length>0){const D=j.find(B=>B.stateCode===o||B.stateName===o);a=(D==null?void 0:D.stateName)||a,o=(D==null?void 0:D.stateCode)||o}else o="",a=h});const x={...u,formFields:l,country:e,countryCode:i,state:a,stateCode:o,addressType:""};if(C==="add")await Me(x),v.success(y("addresses.addressForm.newAddressAdded"));else if(C==="edit"&&g){const{bcAddressId:b}=g;b&&await _e({...x,id:Number(b)}),v.success(y("addresses.addressForm.addressUpdated"))}p(!1),await m(!0)}catch(l){v.error(l)}finally{q(!1)}})()},ue=()=>{P?oe():ce()},fe=(u,l)=>{u==="add"&&T.length>0&&F.forEach(i=>{const h=i;if(i.custom)if(P){const e=T.filter(a=>a.name===i.name)[0];h.default=e.default||""}else{const e=T.filter(a=>a.name===i.name||a.bcLabel===i.bcLabel)[0];h.default=e.default||""}}),te(),de(l),R(u),p(!0),z(!1)};f.useImperativeHandle(A,()=>({handleOpenAddEditAddressClick:fe}));const me=(u,l)=>{O(l==="isShipping"?{...E,[l]:u,isDefaultShipping:!1}:{...E,[l]:u,isDefaultBilling:!1})};f.useEffect(()=>{const u=s.map(i=>({...i,label:y(i.idLang)||i.label,default:!P&&i.fieldId==="field_21"?"":i.default}));k(u);const l=s.filter(i=>i.custom);if(K(l),T.length===0){const i=ts(s);Z(i)}},[s,T.length,P]);const ae=f.useCallback(()=>{if(g){const{isShipping:u,isBilling:l,isDefaultShipping:i,isDefaultBilling:h,state:e,stateCode:a,countryCode:o,extraFields:x}=g,b=r.filter(w=>w.countryCode===o);O({isShipping:u===1,isBilling:l===1,isDefaultShipping:i===1,isDefaultBilling:h===1}),F.forEach(w=>{const d=w;if(d.custom&&x.length>0)if(P){const j=ie(d.name),D=x.find(_=>_.fieldName===j),B=T.find(_=>_.name===j);D?(L(d.name,D.fieldValue||""),d.default=D.fieldValue||""):(L(d.name,""),d.default=B.default)}else{const j=x.find(B=>B.fieldName===d.name||B.fieldName===d.bcLabel),D=T.filter(B=>B.name===d.name||B.bcLabel===d.bcLabel)[0];j?(L(d.name,j.fieldValue||""),d.default=j.fieldValue||D.default):(L(d.name,""),d.default=D.default)}else if(d.name==="country")L(d.name,o);else if(d.name==="state"){if(L(d.name,a||e),b[0]){const{states:j}=b[0];j.length>0?(d.options=j,d.fieldType="dropdown",d.required=!0):(d.options=[],d.fieldType="text",d.required=!1)}}else L(d.name,g[d.name]==="undefined"?"":g[d.name])})}},[g,r,P,T,L,F]);return f.useEffect(()=>{S&&C==="edit"&&g&&!I&&(ae(),z(!0))},[S,C,g,I,ae]),f.useEffect(()=>{const u=i=>{var a;const h=((a=r.find(o=>o.countryCode===i))==null?void 0:a.states)||[],e=F.find(o=>o.name==="state");e&&(h.length>0?(e.fieldType="dropdown",e.options=h,e.required=!0):(e.fieldType="text",e.options=[],e.required=!1)),L("state",""),k([...F])},l=$((i,{name:h,type:e})=>{const{country:a}=i;h==="country"&&e==="change"&&u(a)});return()=>l.unsubscribe()},[F,r,$]),t.jsxs(ge,{isOpen:S,title:y(C==="add"?"addresses.addressForm.addNewAddress":"addresses.addressForm.editAddress"),leftSizeBtn:y("addresses.addressForm.cancel"),rightSizeBtn:y("addresses.addressForm.saveAddress"),handleLeftClick:le,handRightClick:ue,loading:N,isShowBordered:!0,children:[P&&t.jsxs(t.Fragment,{children:[t.jsx("p",{children:y("addresses.addressForm.selectAddressType")}),t.jsx(ds,{children:Je.map(u=>{const{child:l,name:i,idLang:h}=u;return t.jsxs("div",{children:[t.jsx(ne,{control:t.jsx(re,{checked:E[i],onChange:e=>{me(e.target.checked,i)}}),label:y(h)}),l&&t.jsx(ne,{control:t.jsx(re,{checked:E[l.name],onChange:()=>{O({...E,[l.name]:!E[l.name]})}}),label:y(l.idLang),sx:{display:E[i]?"":"none"}})]},i)})})]}),t.jsx(as,{formFields:F,errors:X,control:U,getValues:ee,setValue:L})]})}const os=f.forwardRef(ls),cs=Ae("div")(({marginBottom:s})=>({marginBottom:s,"& > span:not(:last-child)":{marginRight:"4px"}})),us=Ae("div")(({theme:s})=>({display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:s.spacing(3)}));function ye({children:s}){return t.jsx(ve,{color:"#C4DD6C",textColor:"rgba(0, 0, 0, 0.87)",children:s})}function H({children:s}){return t.jsx(Be,{variant:"body1",children:s})}function fs({item:s,onEdit:m,onDelete:c,onSetDefault:n}){const r=je(),A=Y(),y=!!(m||c||n),S=s.isDefaultShipping===1,p=s.isDefaultBilling===1;return t.jsx(Ee,{children:t.jsxs(Le,{sx:{color:"#313440",wordBreak:"break-word"},children:[s.label&&t.jsx(Be,{variant:"h5",sx:{marginBottom:S||p?r.spacing(1):r.spacing(3),color:"rgba(0, 0, 0, 0.87)"},children:s.label}),t.jsxs(cs,{marginBottom:S||p?r.spacing(3):0,children:[S&&t.jsx(ye,{children:A("addresses.addressItemCard.defaultShipping")}),p&&t.jsx(ye,{children:A("addresses.addressItemCard.defaultBilling")})]}),t.jsxs(H,{children:[s.firstName," ",s.lastName]}),t.jsx(H,{children:s.company||""}),t.jsx(H,{children:s.addressLine1}),t.jsx(H,{children:s.addressLine2==="undefined"?"":s.addressLine2}),t.jsxs(H,{children:[s.city,", ",s.state," ",s.zipCode,", ",s.country]}),t.jsx(H,{children:s.phoneNumber}),y&&t.jsxs(us,{children:[n&&t.jsx(ke,{variant:"text",sx:{ml:"-8px"},onClick:n,children:A("addresses.addressItemCard.setAsDefault")}),t.jsxs(J,{sx:{flex:1,display:"flex",justifyContent:"flex-end",gap:"8px"},children:[m&&t.jsx(he,{"aria-label":"edit",size:"small",onClick:m,children:t.jsx(ns,{fontSize:"inherit"})}),c&&t.jsx(he,{"aria-label":"delete",size:"small",onClick:c,children:t.jsx(rs,{fontSize:"inherit"})})]})]})]})},s.id)}function ms(s){const{isOpen:m,closeDialog:c,addressData:n,updateAddressList:r,setIsLoading:A,companyId:y,isBCPermission:S}=s,[p]=be(),C=Y(),R=async()=>{if(n)try{A(!0),c();const{id:I="",bcAddressId:z=""}=n;S?await He({bcAddressId:z}):await Ge({addressId:I,companyId:y}),v.success(C("addresses.deleteAddressDialog.successfullyDeleted")),r()}catch(I){A(!1)}};return t.jsx(ge,{isOpen:m,title:C("addresses.deleteAddressDialog.deleteAddress"),leftSizeBtn:C("addresses.deleteAddressDialog.cancel"),rightSizeBtn:C("addresses.deleteAddressDialog.delete"),handleLeftClick:c,handRightClick:R,rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:t.jsx(J,{sx:{display:"flex",alignItems:p?"start":"center",justifyContent:p?"center":"start",width:p?"100%":"450px",height:"100%"},children:C("addresses.deleteAddressDialog.confirmDelete")})})}function ps(s){const{isOpen:m,closeDialog:c,setIsLoading:n,addressData:r,updateAddressList:A,companyId:y}=s,[S]=be(),p=Y(),[C,R]=f.useState();f.useEffect(()=>{R(r)},[r]);const I=N=>q=>{const{checked:F}=q.target;if(C){const k={...C};N==="isDefaultShipping"&&(k.isDefaultShipping=F?1:0,k.isShipping=F?1:k.isShipping),N==="isDefaultBilling"&&(k.isDefaultBilling=F?1:0,k.isBilling=F?1:k.isShipping),R(k)}},z=async()=>{try{n(!0),c(),await De({...C,companyId:y}),v.success(p("addresses.setDefaultDialog.successfullySet")),A()}catch(N){n(!1)}};return t.jsx(ge,{isOpen:m,title:p("addresses.setDefaultDialog.setDefaultAddress"),leftSizeBtn:p("addresses.setDefaultDialog.cancel"),rightSizeBtn:"set",handleLeftClick:c,handRightClick:z,children:t.jsx(J,{sx:{display:"flex",alignItems:S?"start":"center",width:S?"100%":"450px",height:"100%"},children:C&&t.jsx(J,{sx:{padding:S?"0":"10px 0"},children:t.jsxs(we,{children:[t.jsx(ne,{control:t.jsx(re,{checked:C.isDefaultShipping===1,onChange:I("isDefaultShipping")}),label:p("addresses.setDefaultDialog.setDefaultShippingAddress")}),t.jsx(ne,{control:t.jsx(re,{checked:C.isDefaultBilling===1,onChange:I("isDefaultBilling")}),label:p("addresses.setDefaultDialog.setDefaultBillingAddress")})]})})})})}const gs=s=>{if(s.length===0)return[];const m=s.filter(r=>r.visibleToEnduser)||[];if((m==null?void 0:m.length)===0)return[];const c=m.map(r=>({...r,groupId:4,visible:r.visibleToEnduser})),n=Se(c).address;return n.map(r=>{const A=r;return A.custom=!0,r}),n},hs=async()=>{try{const{accountFormFields:s}=await Ne(1),m=s.filter(n=>n.groupId===4);return Se(m).address}catch(s){Q.error(s)}},Cs=async()=>{try{const s=await Ke(),m=gs(s.addressExtraFields);return[...Qe,...m]}catch(s){Q.error(s)}return[]},ys=async(s,m)=>{let c=[];try{if(s){const n=await Cs();n&&(c=n)}else c=await hs();return c.map(n=>{const r=n;return n.name==="country"&&(r.options=m,r.required=!0),n.name==="state"&&(r.fieldType="text",r.required=!1),n}),c}catch(n){Q.error(n)}return[]},xs=[pe.addressesCreateActionsPermission,pe.addressesUpdateActionsPermission,pe.addressesDeleteActionsPermission],xe=(s,m)=>{var c;return((c=(s!=null?s:[]).find(n=>n.key===m))==null?void 0:c.isEnabled)==="1"};function Ks(){const s=G(Te),m=G(({company:e})=>e.companyInfo.id),c=G(({company:e})=>e.customer.role),n=G(({b2bFeatures:e})=>e.masqueradeCompany.id),r=G(({b2bFeatures:e})=>e.masqueradeCompany.isAgenting),{state:{addressConfig:A},dispatch:y}=f.useContext(Pe),{selectCompanyHierarchyId:S}=G(({company:e})=>e.companyHierarchyInfo),p=Y(),C=Oe(),[R]=Ue(),I=f.useRef(null),[z,N]=f.useState(!1),[q,F]=f.useState([]),[k,V]=f.useState([]),[K,T]=f.useState({search:""}),Z=c===Ce.SUPER_ADMIN&&r?n:m,g=!s||c===Ce.SUPER_ADMIN&&!r;f.useEffect(()=>{(async()=>{const{countries:a}=await ze();V(a),N(!0);try{const o=await ys(!g,a);F(o||[])}catch(o){Q.error(o)}finally{N(!1)}})()},[g]);const de=async(e={})=>{if(!g){const{edges:x=[],totalCount:b}=await Xe({companyId:Z,...e});return{edges:x,totalCount:b}}const{edges:a=[],totalCount:o}=await $e({...e});return{edges:a.map(x=>({node:es(x.node)})),totalCount:o}},E=(e,a)=>{e==="search"&&T({...K,search:a})},O=e=>{T({...K,country:e.country||"",state:e.state||"",city:e.city||""})},P=()=>{var e;(e=R.current)==null||e.refresh()},[U,W]=f.useState(!1),[ee,X]=f.useState(),$=()=>X(void 0),[se,L]=f.useState(),[te,M,le]=Ye(xs);f.useEffect(()=>{(async()=>{if(g){W(!0);return}if(M)try{let a=A;if(!a){const{addressConfig:x}=await We();a=x,y({type:"common",payload:{addressConfig:a}})}const o=xe(a,"address_book")&&xe(a,c===3?"address_sales_rep":"address_admin");W(o)}catch(a){Q.error(a)}})()},[A,y,g,c,M]);const oe=()=>{var e;if(!U){v.error(p("addresses.noPermissionToAdd"));return}(e=I.current)==null||e.handleOpenAddEditAddressClick("add")},ce=e=>{var a;if(!U){v.error(p("addresses.noPermissionToEdit"));return}(a=I.current)==null||a.handleOpenAddEditAddressClick("edit",e)},ue=e=>{if(!U){v.error(p("addresses.noPermissionToEdit"));return}L({...e}),X("delete")},fe=e=>{L({...e}),X("setDefault")},me={isEnabled:g||U&&te,customLabel:p("addresses.addNewAddress")},ae=Ze.map(({idLang:e,...a})=>({...a,label:p(e)})),u=Number(S)||Number(Z),l=M||g,i=le||g,h=!g&&M;return t.jsx(Re,{isSpinning:z,children:t.jsxs(J,{sx:{display:"flex",flexDirection:"column",flex:1},children:[t.jsx(Ie,{filterMoreInfo:ae,handleChange:E,handleFilterChange:O,customButtonConfig:me,handleFilterCustomButtonClick:oe}),t.jsx(qe,{ref:R,columnItems:[],rowsPerPageOptions:[12,24,36],getRequestList:de,searchParams:K,isCustomRender:!0,itemXs:C?3:4,requestLoading:N,tableKey:"id",renderItem:e=>t.jsx(fs,{item:e,onEdit:l?()=>ce(e):void 0,onDelete:i?()=>ue(e):void 0,onSetDefault:h?()=>fe(e):void 0},e.id)}),t.jsx(os,{updateAddressList:P,addressFields:q,ref:I,companyId:u,isBCPermission:g,countries:k}),U&&!g&&t.jsx(ps,{isOpen:ee==="setDefault",closeDialog:$,setIsLoading:N,addressData:se,updateAddressList:P,companyId:u}),U&&t.jsx(ms,{isOpen:ee==="delete",closeDialog:$,setIsLoading:N,addressData:se,updateAddressList:P,companyId:u,isBCPermission:g})]})})}export{Ks as default};
//# sourceMappingURL=index-CL-vDCSJ.js.map
