import{O as J,j as n,A as X,ae as Y,w as Z,B as L,T as P}from"./mui-DjJKBaL-.js";import{r as q}from"./intl-D34a3Rgg.js";import{B as v}from"./B3Filter-DObKChJb.js";import{a7 as $,bs as ee,aM as te,j as S,aw as A,ay as se,a as ae,G as re,af as oe,am as ne,u as N,y as ie,bw as le,I as F}from"./react-setup-Bynf4djQ.js";import"./load-functions-BXOIym8k.js";import"./base-CC7kTJh2.js";import{Q as M,k as de,l as ue}from"./QuoteStatus-POhKVew-.js";import{f as ce}from"./shoppingList-BQaqjTk4.js";import{u as me}from"./useSort-57pG6e8y.js";import{a as pe}from"./router-DcuTQ_yx.js";import"./reactVendor-CkUTLE5B.js";import"./eCache-97HTO8co.js";import"./B3FilterMore-BqyWUWvQ.js";import"./form-pKe_k4Gy.js";import"./B3CustomForm-CTyEaR6B.js";import"./lodashEs-CONzB2I0.js";import"./muiIcon-BBtg8u0V.js";import"./dateFns-DubixNBV.js";import"./B3FilterSearch-8dQX3CC_.js";import"./redux-Bt5-tVzx.js";import"./toolkit-CpEbzTSY.js";import"../index.Cj-kImQU.js";import"./global-D7Yn0gGb.js";import"./dropzone-B1UJxEDf.js";const ye={subtotal:0,shipping:0,tax:0,grandTotal:0},{decimal_places:be=2}=te(),E=a=>parseFloat(a.toFixed(be)),fe=()=>{const{draftQuoteList:a}=$.getState().quoteInfo,{showInclusiveTaxPrice:e}=$.getState().global;return a.reduce((d,i)=>{const{basePrice:u,taxPrice:r=0,quantity:o,additionalCalculatedPrices:x=[]}=i.node;let{subtotal:y,grandTotal:h,tax:s}=d;const{shipping:c}=d;let C=0,f=0;return x.forEach(b=>{C+=b.additionalCalculatedPriceTax,f+=b.additionalCalculatedPrice}),y+=E(ee(Number(u)+f,Number(r))*o),s+=E((Number(r)+C)*o),h=e?y+c:y+c+s,{grandTotal:h,shipping:c,tax:s,subtotal:y}},{...ye})},ge=Z("div")({display:"flex",flexDirection:"column",alignItems:"start",marginBottom:"1rem"});function qe(a){const{item:e,goToDetail:l}=a,d=J(),i=S(),u=d.palette.primary.main,r=[{key:"quoteTitle",title:i("quotes.quoteItemCard.title")},{key:"salesRepEmail",title:i("quotes.quoteItemCard.salesRep")},{key:"createdBy",title:i("quotes.quoteItemCard.createdBy")},{key:"createdAt",title:i("quotes.quoteItemCard.dateCreated"),render:()=>"".concat(Number(e.status)!==0?A(Number(e.createdAt)):e.createdAt)},{key:"updatedAt",title:i("quotes.quoteItemCard.lastUpdate"),render:()=>"".concat(Number(e.status)!==0?A(Number(e.updatedAt)):e.updatedAt)},{key:"expiredAt",title:i("quotes.quoteItemCard.expirationDate"),render:()=>"".concat(Number(e.status)!==0?A(Number(e.expiredAt)):e.expiredAt)},{key:"totalAmount",title:i("quotes.quoteItemCard.subtotal"),render:()=>{const{totalAmount:o}=e;return se(Number(o))}}];return n.jsx(X,{children:n.jsxs(Y,{sx:{color:"rgba(0, 0, 0, 0.6)"},children:[n.jsxs(ge,{children:[n.jsx(L,{sx:{display:"flex",alignItems:"center",mb:"1rem"},children:n.jsx(P,{variant:"h6",sx:{color:"rgba(0, 0, 0, 0.87)"},children:e.quoteNumber})}),n.jsx(L,{children:n.jsx(M,{code:e.status})})]}),r.map(o=>n.jsxs(L,{sx:{display:"flex"},children:[n.jsx(P,{sx:{fontWeight:"bold",color:"rgba(0, 0, 0, 0.87)",mr:"5px",whiteSpace:"nowrap"},children:"".concat(o.title,":")}),n.jsx(P,{sx:{color:"black",wordBreak:"break-all"},children:o!=null&&o.render?o.render():e[o.key]})]},o.key)),n.jsx(L,{onClick:()=>l(e,Number(e.status)),sx:{mt:"1rem",pl:0,color:u||"#1976D2",cursor:"pointer",fontWeight:"bold",display:"inline-block"},children:i("quotes.quoteItemCard.view")})]})})}const xe=[{idLangCustomLabel:"quotes.open",statusCode:1},{idLangCustomLabel:"quotes.ordered",statusCode:4},{idLangCustomLabel:"quotes.expired",statusCode:5}],Q="quoteNumber",D={quoteNumber:"quoteNumber",quoteTitle:"quoteTitle",salesRep:"salesRep",createdBy:"createdBy",createdAt:"createdAt",updatedAt:"updatedAt",expiredAt:"expiredAt",status:"status"};function Ce(){const a=N(({company:s})=>s.companyInfo.id),e=N(({company:s})=>s.customer),l=N(ie),d=N(({quoteInfo:s})=>s.draftQuoteList.length),i=N(({b2bFeatures:s})=>s.masqueradeCompany.id),u=S(),r=a||i,o=s=>l?de({...s,channelId:F}):ue({...s,channelId:F}),x=()=>[{name:"status",label:u("quotes.quoteStatus"),required:!1,default:"",fieldType:"dropdown",options:xe.map(({idLangCustomLabel:s,...c})=>({customLabel:u(s),...c})),replaceOptions:{label:"customLabel",value:"statusCode"},xs:12,variant:"filled",size:"small"}],y=async()=>{var f,b,g,R;const s=await ce(Number(r),2),c=((b=(f=s==null?void 0:s.createdByUser)==null?void 0:f.results)==null?void 0:b.createdBy.map(m=>({createdBy:m.email?"".concat(m.name," (").concat(m.email,")"):"".concat(m.name)})))||[],C=((R=(g=s==null?void 0:s.createdByUser)==null?void 0:g.results)==null?void 0:R.salesRep.map(m=>({salesRep:"".concat(m.salesRep||m.salesRepEmail)})))||[];return[...x(),{name:"createdBy",label:u("quotes.createdBy"),required:!1,default:"",fieldType:"dropdown",options:c,replaceOptions:{label:"createdBy",value:"createdBy"},xs:12,variant:"filled",size:"small"},{name:"salesRep",label:u("quotes.salesRep"),required:!1,default:"",fieldType:"dropdown",options:C,replaceOptions:{label:"salesRep",value:"salesRep"},xs:12,variant:"filled",size:"small"}]};return{companyId:r,isB2BUser:l,draftQuoteListLength:d,customer:e,getQuotesList:o,getAvailableFilters:async()=>l?y():x()}}const Be=()=>{const a=S();return q.useMemo(()=>[{key:"quoteNumber",title:a("quotes.quoteNumber"),isSortable:!0},{key:"quoteTitle",title:a("quotes.title"),isSortable:!0},{key:"salesRep",title:a("quotes.salesRep"),render:e=>"".concat(e.salesRep||e.salesRepEmail),isSortable:!0},{key:"createdBy",title:a("quotes.createdBy"),isSortable:!0},{key:"createdAt",title:a("quotes.dateCreated"),render:e=>"".concat(Number(e.status)!==0?A(Number(e.createdAt)):e.createdAt),isSortable:!0},{key:"updatedAt",title:a("quotes.lastUpdate"),render:e=>"".concat(Number(e.status)!==0?A(Number(e.updatedAt)):e.updatedAt),isSortable:!0},{key:"expiredAt",title:a("quotes.expirationDate"),render:e=>"".concat(Number(e.status)!==0?A(Number(e.expiredAt)):e.expiredAt),isSortable:!0},{key:"totalAmount",title:a("quotes.subtotal"),render:e=>{const{totalAmount:l,currency:d}=e,i=d;return le(Number(l),{currency:i,isConversionRate:!1,useCurrentCurrency:!!d})},style:{textAlign:"right"}},{key:"status",title:a("quotes.status"),render:e=>n.jsx(M,{code:e.status}),isSortable:!0}],[a])};function He(){const{getAvailableFilters:a,draftQuoteListLength:e,customer:l,getQuotesList:d}=Ce(),i=Be(),u={q:"",orderBy:"-".concat(D[Q]),createdBy:"",salesRep:"",status:"",dateCreatedBeginAt:"",dateCreatedEndAt:""},[r,o]=q.useState(u),[x,y]=q.useState(!1),[h,s]=q.useState([]),[c,C,f]=me(D,Q,r,o),b=pe(),g=S(),[R]=ae(),{state:{openAPPParams:m},dispatch:O}=q.useContext(re);q.useEffect(()=>{a().then(t=>s(t)),m.quoteBtn&&O({type:"common",payload:{openAPPParams:{quoteBtn:"",shoppingListBtn:""}}})},[]);const T=(t,p)=>{Number(p)===0?b("/quoteDraft"):b("/quoteDetail/".concat(t.id,"?date=").concat(t.createdAt))},U=q.useCallback(async t=>{const{edges:p=[],totalCount:z}=await d(t);if(t.offset===0&&e){const B=fe(),I={node:{quoteNumber:"—",quoteTitle:"—",createdAt:"—",salesRepEmail:"—",createdBy:"".concat(l.firstName," ").concat(l.lastName),updatedAt:"—",expiredAt:"—",totalAmount:B==null?void 0:B.grandTotal,status:0,taxTotal:B==null?void 0:B.tax}},{status:G,createdBy:w,salesRep:W,dateCreatedBeginAt:_,dateCreatedEndAt:H}=r,j=!G&&!W&&!_&&!H;if(w&&j){const k=/^[^(]+/.exec(w);(k!=null&&k.length?k[0].trim():"")===I.node.createdBy&&p.unshift(I)}else j&&p.unshift(I)}return{edges:p,totalCount:z}},[d,e,l.firstName,l.lastName,r]),K=(t,p)=>{t==="search"&&o({...r,q:p})},V=t=>{const p={createdBy:(t==null?void 0:t.createdBy)||"",status:(t==null?void 0:t.status)||"",salesRep:(t==null?void 0:t.salesRep)||"",dateCreatedBeginAt:(t==null?void 0:t.startValue)||"",dateCreatedEndAt:(t==null?void 0:t.endValue)||""};o({...r,...p})};return n.jsx(oe,{isSpinning:x,children:n.jsxs(L,{sx:{display:"flex",flexDirection:"column",flex:1},children:[n.jsx(v,{filterMoreInfo:h,startPicker:{isEnabled:!0,label:g("quotes.from"),defaultValue:(r==null?void 0:r.dateCreatedBeginAt)||"",pickerKey:"start"},endPicker:{isEnabled:!0,label:g("quotes.to"),defaultValue:(r==null?void 0:r.dateCreatedEndAt)||"",pickerKey:"end"},handleChange:K,handleFilterChange:V}),n.jsx(ne,{columnItems:i,rowsPerPageOptions:[10,20,30],getRequestList:U,searchParams:r,isCustomRender:!1,requestLoading:y,tableKey:"quoteNumber",sortDirection:C,orderBy:f,sortByFn:c,labelRowsPerPage:g(R?"quotes.cardsPerPage":"quotes.quotesPerPage"),renderItem:t=>n.jsx(qe,{item:t,goToDetail:T}),onClickRow:t=>{T(t,Number(t.status))},hover:!0})]})})}export{He as default};
//# sourceMappingURL=index-JuU-79uD.js.map
