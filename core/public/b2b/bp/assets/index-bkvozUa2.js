import{j as e,A as O,B as b,I as z,C as H,X as N,Y as T,aE as F,D as K,E as P,H as J,J as v,K as k,M as W}from"./mui-DjJKBaL-.js";import{r as o}from"./intl-D34a3Rgg.js";import{j as B,C as A,a as X,u as I,af as Y,cm as q}from"./react-setup-Bynf4djQ.js";import"./load-functions-BXOIym8k.js";import{H as G,b as Q}from"./HierarchyDialog-CV0mKfqM.js";import"./base-CC7kTJh2.js";import{B as L,M as R,K as U}from"./muiIcon-BBtg8u0V.js";import"./reactVendor-CkUTLE5B.js";import"./eCache-97HTO8co.js";import"./redux-Bt5-tVzx.js";import"./toolkit-CpEbzTSY.js";import"./lodashEs-CONzB2I0.js";import"../index.Cj-kImQU.js";import"./global-D7Yn0gGb.js";import"./router-DcuTQ_yx.js";import"./dropzone-B1UJxEDf.js";import"./dateFns-DubixNBV.js";function V({company:s,currentCompanyId:x="",selectCompanyId:l="",onSwitchCompany:n,getDisplayName:m=r=>r.companyName,getNodeId:d=r=>r.companyId}){const r=o.useId(),i=d(s),[c,p]=o.useState(null),t=B(),{state:{switchAccountButton:{color:h="#ED6C02"}}}=o.useContext(A),u=Number(i)===Number(x),g=Number(i)===Number(l),a=!!c,f=o.useMemo(()=>l?Number(l)!==Number(s.companyId):Number(x)!==Number(s.companyId),[x,l,s]),w=C=>{p(C.currentTarget)},j=()=>{p(null)},M=()=>{j(),n==null||n(s)},E=a?{borderRadius:"10%",backgroundColor:"rgba(0, 0, 0, 0.14)"}:{};return e.jsxs(O,{sx:{padding:"16px",marginBottom:"16px"},role:"listitem","aria-labelledby":r,children:[e.jsxs(b,{children:[e.jsxs(b,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between"},children:[e.jsxs(b,{id:r,sx:{display:"flex",alignItems:"flex-start"},children:[e.jsx(L,{sx:{color:"rgba(0, 0, 0, 0.54)",mr:1}}),m(s)]}),(s==null?void 0:s.channelFlag)&&f&&e.jsx(z,{size:"small",onClick:w,"aria-controls":a?"company-menu":void 0,"aria-haspopup":"true","aria-expanded":a?"true":void 0,"data-testid":"actions",sx:{pt:0,"& svg":{...E}},children:e.jsx(R,{})})]}),g&&e.jsx(H,{label:t("companyHierarchy.chip.selectCompany"),size:"small",sx:{mt:2,backgroundColor:h,color:"white",height:24,"& .MuiChip-label":{px:1}}}),u&&e.jsx(H,{label:t("companyHierarchy.chip.currentCompany"),size:"small",sx:{mt:2,backgroundColor:"primary.main",color:"white",height:24,"& .MuiChip-label":{px:1}}})]}),e.jsx(N,{id:"company-menu",anchorEl:c,open:a,onClose:j,MenuListProps:{"aria-labelledby":"company-button"},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(T,{sx:{color:"primary.main"},onClick:M,children:t("companyHierarchy.dialog.title")})})]})}function S({node:s,level:x=0,currentCompanyId:l="",selectCompanyId:n="",onSwitchCompany:m,getDisplayName:d=i=>i.companyName,getNodeId:r=i=>i.companyId}){const[i,c]=o.useState(!0),[p,t]=o.useState(null),h=B(),{state:{switchAccountButton:{color:u="#ED6C02"}}}=o.useContext(A),g=s.children&&s.children.length>0,a=r(s),f=Number(a)===Number(l),w=Number(a)===Number(n),j=!!p,M=o.useMemo(()=>n?Number(n)!==Number(s.companyId):Number(l)!==Number(s.companyId),[l,n,s]),E=y=>{t(y.currentTarget)},C=()=>{t(null)},D=()=>{C(),m==null||m(s)};return e.jsxs(e.Fragment,{children:[e.jsxs(v,{sx:{"&:last-child td, &:last-child th":{border:0},"& > td":{bgcolor:"background.paper"},height:"3.25rem"},children:[e.jsx(k,{sx:{width:"100%",py:1},children:e.jsx(b,{sx:{display:"flex",alignItems:"center"},children:e.jsxs(b,{sx:{display:"flex",ml:x*4,alignItems:"center"},children:[g?e.jsx(z,{"data-testid":i?"collapse":"open",size:"small",onClick:()=>c(!i),sx:{mr:1},children:e.jsx(U,{sx:{transform:i?"rotate(0deg)":"rotate(-90deg)",transition:"transform 0.2s",color:"rgba(0, 0, 0, 0.54)"}})}):e.jsx(b,{sx:{width:40}}),e.jsx(b,{sx:{mr:1,display:"flex",alignItems:"center"},children:e.jsx(L,{sx:{color:"rgba(0, 0, 0, 0.54)"}})}),e.jsx(b,{component:"span",sx:{mr:1},children:d(s)}),w&&e.jsx(H,{label:h("companyHierarchy.chip.selectCompany"),size:"small",sx:{backgroundColor:u,color:"white",height:24,"& .MuiChip-label":{px:1}}}),f&&e.jsx(H,{label:h("companyHierarchy.chip.currentCompany"),size:"small",sx:{backgroundColor:"primary.main",color:"white",height:24,"& .MuiChip-label":{px:1}}})]})})}),e.jsxs(k,{align:"right",sx:{width:48,py:1},children:[(s==null?void 0:s.channelFlag)&&M&&e.jsx(z,{size:"small",onClick:E,"aria-controls":j?"company-menu":void 0,"aria-haspopup":"true","aria-expanded":j?"true":void 0,"data-testid":"actions",children:e.jsx(R,{})}),e.jsx(N,{id:"company-menu",anchorEl:p,open:j,onClose:C,MenuListProps:{"aria-labelledby":"company-button"},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(T,{sx:{color:"primary.main"},onClick:D,children:h("companyHierarchy.dialog.title")})})]})]}),i&&g&&((s==null?void 0:s.children)||[]).map(y=>e.jsx(S,{node:y,level:x+1,currentCompanyId:l,selectCompanyId:n,onSwitchCompany:m,getDisplayName:d,getNodeId:r},r(y)))]})}function Z({data:s,currentCompanyId:x,selectCompanyId:l,onSwitchCompany:n,getDisplayName:m=r=>r.companyName,getNodeId:d=r=>r.companyId}){const[r]=X(),i=B(),c=(t,h)=>(t.length===0||t.forEach(u=>{h.push({...u,children:[]}),u.children&&u.children.length>0&&c((u==null?void 0:u.children)||[],h)}),h),p=c(s,[]);return e.jsx(e.Fragment,{children:r?e.jsx("div",{role:"list",children:p.map(t=>e.jsx(V,{company:t,currentCompanyId:x,selectCompanyId:l,onSwitchCompany:n,getDisplayName:m,getNodeId:d},d(t)))}):e.jsx(F,{sx:{width:"100%",minHeight:"100px",mx:"auto",mt:2},children:e.jsx(K,{children:e.jsxs(P,{size:"small","aria-label":"company structure table",children:[e.jsx(J,{children:e.jsxs(v,{sx:{height:"3.25rem"},children:[e.jsx(k,{sx:{fontWeight:500,pl:8},children:i("companyHierarchy.table.name")}),e.jsx(k,{sx:{width:48}})]})}),e.jsx(W,{children:s.map(t=>e.jsx(S,{node:t,currentCompanyId:x,selectCompanyId:l,onSwitchCompany:n,getDisplayName:m,getNodeId:d},d(t)))})]})})})})}function pe(){const[s,x]=o.useState([]),[l,n]=o.useState(!1),[m,d]=o.useState(null),[r,i]=o.useState(!1),c=o.useRef([]),{id:p}=I(({company:a})=>a.companyInfo),{selectCompanyHierarchyId:t}=I(({company:a})=>a.companyHierarchyInfo),h=async()=>{i(!0);const{companySubsidiaries:a}=await q(),f=Q({data:a||[]});c.current=a,x(f),i(!1)};o.useEffect(()=>{p&&h()},[p]);const u=()=>{n(!1)},g=a=>{d(a),n(!0)};return e.jsx(Y,{isSpinning:r,children:e.jsxs(b,{sx:{display:"flex",flexDirection:"column",flex:1,width:"100%"},children:[e.jsx(Z,{data:s,onSwitchCompany:g,currentCompanyId:p,selectCompanyId:t}),e.jsx(G,{open:l,handleClose:u,currentRow:m,companyHierarchyAllList:(c==null?void 0:c.current)||[]})]})})}export{pe as default};
//# sourceMappingURL=index-bkvozUa2.js.map
