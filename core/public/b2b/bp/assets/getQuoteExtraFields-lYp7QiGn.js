import{j as e,B as f,T as g,N as G,O as Y,w as T,am as X,A as W,ae as H,b as Z}from"./mui-DjJKBaL-.js";import{r as h}from"./intl-D34a3Rgg.js";import{j as C,bR as ee,af as te,bS as oe,ak as N,bT as ae,bk as se,i as ne,u as E,bU as re,bJ as ie,bp as le,a as K,ag as ce,y as de,a2 as ue,a7 as Q,bV as R}from"./react-setup-Bynf4djQ.js";import"./load-functions-BXOIym8k.js";import{b as fe}from"./base-CC7kTJh2.js";import{h as pe,i as xe,j as he}from"./QuoteStatus-POhKVew-.js";import{n as P}from"./lodashEs-CONzB2I0.js";import{n as me,o as ge,f as be,H as je,p as ye}from"./muiIcon-BBtg8u0V.js";function _(o){const{children:c,title:t="",header:s,defaultOpen:a=!1,handleOnChange:n}=o,[i,p]=h.useState(a),x=()=>{p(!i)};return h.useEffect(()=>{n&&n(i)},[n,i]),h.useEffect(()=>{a&&p(a)},[a]),e.jsxs(f,{children:[e.jsxs(f,{onClick:x,sx:{display:"flex",justifyContent:"space-between",cursor:"pointer",alignItems:"center"},children:[s||e.jsx(g,{variant:"h5",children:t}),i?e.jsx(me,{}):e.jsx(ge,{})]}),e.jsx(G,{in:i,timeout:"auto",unmountOnExit:!0,children:c})]})}const Fe=T(f)(({style:o})=>({"& .file-upload-area":{cursor:"pointer","& .MuiDropzoneArea-textContainer":{display:"flex",alignItems:"center",color:(o==null?void 0:o.color)||"#1976D2"},"& .MuiDropzoneArea-text":{order:1,textTransform:"uppercase",fontWeight:500,fontSize:"14px",lineHeight:"24px"}}})),we=T(f)(o=>({display:"flex",background:o.hasdelete==="true"?"rgba(25, 118, 210, 0.3)":"rgba(0, 0, 0, 0.12)",borderRadius:"18px",padding:"6px 8px",alignItems:"center",margin:"0 0 2px",color:"rgba(0, 0, 0, 0.54)","& .fileList-name-area":{display:"flex",flex:1,alignItems:"center"},"& .fileList-name":{whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",flexGrow:1,flexBasis:"100px",maxWidth:"200px",color:"#313440",fontSize:"14px",cursor:"pointer"}})),Ie=T(g)({marginBottom:"16px",fontSize:"10px",color:"rgba(0, 0, 0, 0.38)",padding:"0 12px",textAlign:"right",wordBreak:"break-word"}),O=T(ye)(()=>({transform:"rotate(45deg)",marginRight:"5px"}));function qe(o,c){const t=C(),{title:s=t("global.fileUpload.addAttachment"),tips:a=t("global.fileUpload.maxFileSizeMessage"),maxFileSize:n=2097152,fileNumber:i=3,limitUploadFn:p,acceptedFiles:x=ee,onchange:j=P,fileList:y=[],allowUpload:d=!0,onDelete:u=P,isEndLoadding:w=!1,requestType:B="quoteAttachedFile"}=o,A=Y().palette.primary.main,[U,l]=h.useState(!1);h.useImperativeHandle(c,()=>({setUploadLoadding:r=>l(r)}));const m=r=>r/1048576>1?"".concat((r/1048576).toFixed(1),"MB"):r/1024>1?"".concat((r/1024).toFixed(1),"KB"):"".concat(r,"B"),F=(r,I,S)=>{const{size:z,type:$}=r;let k=!1;I.forEach(J=>{k=new RegExp(J).test($)||k});let D="";return k||(D=t("global.fileUpload.fileTypeNotSupported")),z>S&&(D=t("global.fileUpload.fileSizeExceedsLimit",{maxFileSize:m(S)})),D&&N.error(D),D},b=()=>(N.error(t("global.fileUpload.fileSizeExceedsLimit",{maxFileSize:m(n)})),""),q=async r=>{const I=r.length>0?r[0]:null;if(!(I&&p&&p())){if(!p&&I&&y.length>=i){N.error(t("global.fileUpload.maxFileNumber",{fileNumber:i}));return}if(I)try{l(!0);const{code:S,data:z,message:$}=await ae({file:I,type:B});S===200?j({...z,id:se()}):N.error($)}finally{w||l(!1)}}},L=r=>{u(r)},V=r=>{r&&window.open(r,"_blank")};return e.jsx(te,{isSpinning:U,children:e.jsxs(f,{sx:{padding:"12px 0 0",width:"100%"},children:[e.jsx(f,{children:y.map((r,I)=>e.jsxs(f,{children:[e.jsxs(we,{hasdelete:((r==null?void 0:r.hasDelete)||"").toString(),children:[e.jsxs(f,{className:"fileList-name-area",children:[e.jsx(O,{}),e.jsx(g,{className:"fileList-name",onClick:()=>{V(r.fileUrl)},children:r.fileName})]}),r.hasDelete&&e.jsx(be,{sx:{cursor:"pointer"},onClick:()=>{L((r==null?void 0:r.id)||"")}})]}),e.jsx(Ie,{children:r.title||""})]},r.id||I))}),d&&e.jsxs(f,{sx:{display:"flex",justifyContent:"space-between",marginTop:"10px"},children:[e.jsx(Fe,{style:{color:A},children:e.jsx(oe,{dropzoneClass:"file-upload-area",Icon:O,filesLimit:1,onChange:q,showPreviews:!1,showPreviewsInDropzone:!1,maxFileSize:n,showAlerts:!1,dropzoneText:s,getDropRejectMessage:F,getFileLimitExceedMessage:b,acceptedFiles:x})}),e.jsx(X,{title:a,sx:{fontSize:"20px",color:"rgba(0, 0, 0, 0.54)"},children:e.jsx(je,{})})]})]})})}const Ce=h.forwardRef(qe);function Me(o){const{allowUpload:c=!0,defaultFileList:t=[],status:s,quoteId:a}=o,n=C(),i=ne(),p=E(({company:l})=>l.customer.firstName),x=E(({company:l})=>l.customer.lastName),j=E(({quoteInfo:l})=>l.draftQuoteInfo),[y]=re(),[d,u]=h.useState([]),w=h.useRef(null);h.useEffect(()=>{if(s===0){const{fileInfo:l=[]}=j||{};u(typeof l!="object"?[]:l)}else t.length&&u(t)},[t.length,s]);const B=l=>{if(j){const m={...j,fileInfo:l};i(ie(m))}},M=async l=>{var m;try{let F=[];if(s!==0){const b={fileName:l.fileName,fileType:l.fileType,fileUrl:l.fileUrl,fileSize:l.fileSize},{quoteAttachFileCreate:{attachFiles:q}}=await pe({fileList:[{...b}],quoteId:a});b.id=q[0].id,F=[{...b,title:n("global.quoteAttachment.uploadedByCustomer",{createdBy:q[0].createdBy}),hasDelete:!0},...d]}else F=[{...l,title:n("global.quoteAttachment.uploadedByCustomerWithName",{firstName:p,lastName:x}),hasDelete:!0},...d],B(F);u(F)}finally{(m=w.current)==null||m.setUploadLoadding(!1)}},A=async l=>{var m,F;try{(m=w.current)==null||m.setUploadLoadding(!0);const b=d.find(L=>L.id===l),q=d.filter(L=>L.id!==l);s!==0&&b?await xe({fileId:(b==null?void 0:b.id)||"",quoteId:a}):B(q),u(q)}finally{(F=w.current)==null||F.setUploadLoadding(!1)}},U=()=>d.filter(m=>(m==null?void 0:m.title)&&m.title.includes("by customer")).length>=3?(N.error(n("global.quoteAttachment.maxFilesMessage")),!0):!1;return e.jsx(W,{children:e.jsx(H,{sx:{p:"16px !important"},children:e.jsx(_,{title:n("global.quoteAttachment.title"),children:e.jsx(f,{children:e.jsx(Ce,{ref:w,requestType:y!=="b2b"?"customerQuoteAttachedFile":"quoteAttachedFile",isEndLoadding:!0,fileList:d,limitUploadFn:U,onchange:M,onDelete:A,allowUpload:c})})})})})}const Le=T("div")(({padding:o="1rem",alignItems:c="flex-start",flexDirection:t="row",backgroundColor:s="white",width:a="100%",xs:n})=>({display:"flex",flexDirection:t,alignItems:c,padding:o,width:a,backgroundColor:s,...n}));function De({status:o,quoteInfo:c}){const t=C(),{info:{quoteTitle:s,referenceNumber:a},extraFields:n=[],recipients:i}=c,p=h.useId();return e.jsxs(f,{role:"article","aria-labelledby":p,sx:{width:"100%"},children:[e.jsx(g,{id:p,sx:{fontWeight:400,fontSize:"24px",height:"32px"},children:t("quoteDraft.quoteInfo.title")}),e.jsxs(f,{sx:{p:"15px 0"},children:[(s||o==="Draft")&&e.jsx(g,{children:"".concat(t("quoteDraft.quoteInfo.titleText")," ").concat(s)}),(a||o==="Draft")&&e.jsx(g,{children:"".concat(t("quoteDraft.quoteInfo.referenceText")," ").concat(a)}),o==="Draft"&&!i.length?e.jsx(g,{children:t("quoteDraft.quoteInfo.ccEmailText")}):i.map(x=>e.jsx(g,{sx:{wordBreak:"break-all"},children:"".concat(t("quoteDraft.quoteInfo.ccEmailText")," ").concat(x)},"ccEmail-".concat(le.encode(x)))),n.map(x=>(x.value||o==="Draft")&&e.jsx(g,{children:"".concat(x.fieldName,": ").concat(x.value)},"extraField-".concat(x.fieldName)))]})]})}const Ne=["name","email","companyName","phoneNumber"],Ee=["label","firstName","lastName","company","address","apartment","city","state","zipCode","country","phoneNumber"],Te=["label",["firstName","lastName"],"company","address","apartment",["city","state","zipCode","country"],"phoneNumber"];function v({flag:o,title:c,info:t,status:s}){const a=o==="info"?Ne:Te,[n]=K(),i=C(),p=s==="Draft"?"Please add ".concat(o==="Billing"?"billing":"shipping"," address "):"No ".concat(o==="Billing"?"billing":"shipping"," address"),x=o!=="info"?Ee.some(d=>t&&!!t[d]):!1,j=o==="info"||n?0:"10px",y=h.useId();return e.jsxs(f,{"aria-labelledby":y,role:"article",sx:{width:n||o==="info"?"100%":"33.3%",paddingLeft:j},children:[e.jsx(g,{id:y,sx:{fontWeight:400,fontSize:"24px",height:"32px"},children:c}),e.jsxs(f,{sx:{p:"15px 0"},children:[(x||o==="info")&&JSON.stringify(t)!=="{}"&&a.map(d=>d==="quoteTitle"?s==="Draft"?e.jsx(g,{sx:{wordBreak:"break-all"},variant:"body1",children:"".concat(i("quoteDraft.quoteInfo.quoteTitle")).concat(t[d]||"")},d):"":typeof d=="string"?e.jsx(g,{variant:"body1",children:t&&t[d]||""},d):e.jsx(g,{variant:"body1",children:d.map((u,w)=>w===d.length-1?t[u]||"":u==="firstName"?"".concat(t[u]||""," "):t[u]?"".concat(t[u]||"",", "):"")},"".concat(d))),!x&&o!=="info"&&e.jsx(f,{children:p})]})]})}function Re({quoteAndExtraFieldsInfo:o,contactInfo:c,shippingAddress:t,billingAddress:s,handleEditInfoClick:a,status:n}){const i=C(),[p]=K();return e.jsxs(Le,{flexDirection:"column",xs:{boxShadow:"0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px rgba(0, 0, 0, 0.14), 0px 1px 3px rgba(0, 0, 0, 0.12)",borderRadius:"4px"},children:[e.jsxs(f,{sx:{width:"100%",display:"flex",justifyContent:"space-between",flexDirection:p?"column":"row"},children:[e.jsxs(f,{sx:{width:p?"100%":"33.3%"},children:[e.jsx(v,{title:i("quoteDraft.contactInfo.contact"),flag:"info",status:n,info:c}),e.jsx(De,{status:n,quoteInfo:o})]}),e.jsx(v,{title:i("global.quoteInfo.billing"),flag:"Billing",status:n,info:s}),e.jsx(v,{title:i("global.quoteInfo.shipping"),flag:"Shipping",status:n,info:t})]}),a&&e.jsx(ce,{sx:{mt:"10px",mb:"15px"},onClick:a,variant:"outlined",children:i("global.quoteInfo.editInfo")})]})}function Pe(o){const c=C(),{quoteStatus:t,quoteNotes:s=""}=o,[a,n]=h.useState(""),[i,p]=h.useState(!1),x=E(de),j=E(ue),y=x?j.quotesCreateActionsPermission:!0,d=u=>{n((u==null?void 0:u.target.value)||""),Q.dispatch(R((u==null?void 0:u.target.value)||""))};return h.useEffect(()=>{const u=Q.getState().quoteInfo.draftQuoteInfo.note||"";n(u)},[]),h.useEffect(()=>{Q.dispatch(R(a||""))},[a]),h.useEffect(()=>{s&&p(!0)},[s]),e.jsx(W,{children:e.jsx(H,{sx:{p:"16px !important"},children:e.jsx(_,{title:c(t&&t==="Draft"?"global.quoteNote.message":"global.quoteNote.notes"),defaultOpen:i,children:e.jsxs(f,{sx:{padding:"16px 0"},children:[t&&t==="Draft"&&e.jsx(f,{sx:{fontSize:"16px",color:"rgba(0, 0, 0, 0.38)",mb:"16px"},children:c("global.quoteNote.messageNote")}),s?e.jsx(g,{variant:"body1",style:{whiteSpace:"pre-line",maxHeight:"400px",overflow:"auto"},children:s}):e.jsx(f,{children:y?e.jsx(Z,{multiline:!0,fullWidth:!0,rows:5,value:a,onChange:d,label:c("global.quoteNote.typeMessage"),size:"small",variant:"filled",sx:{"& .MuiFormLabel-root":{color:"rgba(0, 0, 0, 0.38)"}}}):null})]})})})})}const Be=o=>o.map(t=>{const{listOfValue:s}=t,a={isExtraFields:!0,name:t.fieldName||"",label:t.labelName||"",required:t.isRequired,default:t.defaultValue||"",fieldType:t.fieldCategory||"",xs:6,variant:"filled",size:"small",id:t.id};switch(t.fieldCategory){case"dropdown":if(s){const n=s==null?void 0:s.map(i=>({label:i,value:i}));n.length>0&&(a.options=n)}break;case"number":a.max=t.maximumValue||"";break;case"multiline":a.rows=t.numberOfRows||"";break;default:a.maxLength=t.maximumLength||"";break}return a}),Oe=async()=>{let o=[];try{const{quoteExtraFieldsConfig:c}=await he(),t=c.filter(a=>a.visibleToEnduser);o=Be(t)}catch(c){fe.error(c)}return o};export{_ as B,Le as C,Re as Q,Pe as a,Me as b,Oe as g};
//# sourceMappingURL=getQuoteExtraFields-lYp7QiGn.js.map
