import{j as e,B as g,O as q,T as Ce,y as D,a0 as Le,a1 as H,a7 as Te}from"./mui-DjJKBaL-.js";import{r as d}from"./intl-D34a3Rgg.js";import{a as U,d as _,L as O}from"./router-DcuTQ_yx.js";import{g as je,b as Be}from"./getAssetUrl-oCLVNTu_.js";import{B as Fe}from"./B3Card-T4k1TeiE.js";import{u as x,aE as N,a7 as Ie,aF as Pe,aC as Ae,n as W,aG as G,j as Y,l as ke,a as K,K as ve,a3 as J,i as z,r as Se,w as Re,G as He,C as Ee,ak as v,af as Me,aH as qe,e as De,I as Ue,aI as _e,L as Oe,aJ as Ne,M as We,ai as E,ah as Ge,P as Ye,aK as Ke,aL as Je}from"./react-setup-Bynf4djQ.js";import{b as V}from"./base-CC7kTJh2.js";import"./load-functions-BXOIym8k.js";import{l as ze}from"./b3Login-DqPiw-tJ.js";import{b as $,a as Ve,c as $e}from"./login-CubI-V0G.js";import{a as Qe,i as Xe,l as M,b as Ze}from"./config-CMx15DDp.js";import{u as et}from"./form-pKe_k4Gy.js";import{B as tt}from"./B3CustomForm-CTyEaR6B.js";import{a as ot,L as st}from"./styled-DAyP9heS.js";import"./reactVendor-CkUTLE5B.js";import"./eCache-97HTO8co.js";import"./redux-Bt5-tVzx.js";import"./toolkit-CpEbzTSY.js";import"./lodashEs-CONzB2I0.js";import"../index.Cj-kImQU.js";import"./global-D7Yn0gGb.js";import"./muiIcon-BBtg8u0V.js";import"./dropzone-B1UJxEDf.js";import"./dateFns-DubixNBV.js";import"./validatorRules-BSvG4GLb.js";function S(t){const{html:s,sx:a}=t;return e.jsx(g,{sx:{...a},dangerouslySetInnerHTML:{__html:s}})}const nt=()=>$().then(t=>{if(t.data.logout.result!=="success")throw new Error("Failed to logout")}),at=()=>{const t=x(({b2bFeatures:a})=>a.masqueradeCompany.isAgenting),s=x(({b2bFeatures:a})=>a.masqueradeCompany.id);return d.useCallback(async()=>{t&&W(Number(s))},[t,s])},it=()=>{const{selectCompanyHierarchyId:t}=x(({company:s})=>s.companyHierarchyInfo);return d.useCallback(async()=>{t&&await G()},[t])};function rt(){const t=U(),s=at(),a=it(),i=x(N),r=x(({company:u})=>u.tokens.B2BToken),[y]=_(),C=y.get("loginFlag");return d.useEffect(()=>{const u=setTimeout(()=>{window.location.href="/login"},3e3);return()=>{clearTimeout(u)}},[r]),d.useEffect(()=>{C==="loggedOutLogin"||!r?Promise.all([nt(),s(),a()]).catch(()=>{t("/orders")}).then(()=>{window.sessionStorage.clear(),Ie.dispatch(Pe()),window.b2b.callbacks.dispatchEvent("on-logout")}):i&&t("/orders")},[a,s,i,C,t,r]),e.jsx(Ae,{})}function lt(t){const{loginBtn:s,handleLoginSubmit:a,backgroundColor:i}=t,r=Y(),y=q(),{control:C,handleSubmit:u,getValues:l,formState:{errors:F},setValue:I}=et({mode:"onSubmit"}),L=j=>{a(j)},h=Qe(r,u(L));return e.jsxs(g,{sx:{display:"flex",flexDirection:"column"},children:[e.jsx(Ce,{variant:"h5",sx:{margin:"20px 0",display:"flex",justifyContent:"center",alignItems:"center"},children:r("login.loginText.signInHeader")}),e.jsx(g,{sx:{width:"100%","& input":{bgcolor:"#F5F5F5",borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"}},children:e.jsxs("form",{onSubmit:u(L),children:[e.jsx(tt,{formFields:h,errors:F,control:C,getValues:l,setValue:I}),e.jsxs(g,{sx:{display:"flex",justifyContent:"flex-start ",alignItems:"center",mt:2,gap:2},children:[e.jsx(D,{type:"submit",variant:"contained",sx:{backgroundColor:y.palette.primary.main},children:s}),e.jsx(Le,{component:O,color:ke(i),to:"/forgotPassword",children:r("login.loginText.forgotPasswordText")})]})]})})]})}function ct(t){const{widgetBodyText:s,createAccountButtonText:a}=t,i=q(),[r]=K();return e.jsxs(g,{sx:{padding:r?"16px":"20px",borderRadius:"4px",mt:r?"0":"-25px"},children:[e.jsx(S,{sx:{minHeight:"250px","& .panel":{".panel-title":{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",fontWeight:400,fontSize:"24px"}}},html:s}),e.jsx(g,{sx:{marginTop:"5px"},children:e.jsx(D,{component:O,to:"/register",variant:"contained",sx:{ml:r?0:1,backgroundColor:i.palette.primary.main},children:a})})]})}const gt=()=>{const t=x(({b2bFeatures:i})=>i.masqueradeCompany.isAgenting),s=x(({b2bFeatures:i})=>i.masqueradeCompany.id),a=z();return d.useCallback(async()=>{t&&(await W(Number(s)),a(Se()))},[s,a,t])},ut=()=>{const{selectCompanyHierarchyId:t}=x(({company:s})=>s.companyHierarchyInfo);return d.useCallback(async()=>{t&&await G()},[t])},dt=()=>{const t=gt(),s=ut();return async(a=!0)=>{try{const{result:i}=(await $()).data.logout;if(i!=="success")return;await Promise.all([s(),t()])}catch(i){V.error(i)}finally{window.sessionStorage.clear(),ve(),a&&J("on-logout")}}},pt={"Your business account is pending approval. You will gain access to business account features, products, and pricing after account approval.":"global.statusNotifications.willGainAccessToBusinessFeatProductsAndPricingAfterApproval","Your business account is pending approval. Products, pricing, and ordering will be enabled after account approval.":"global.statusNotifications.productsPricingAndOrderingWillBeEnabledAfterApproval","Your business account is pending approval. You will gain access to business account features after account approval.":"global.statusNotifications.willGainAccessToBusinessFeatAfterApproval"};function mt(t){const{setOpenPage:s}=t,a=z(),i=dt(),r=x(N),y=x(({quoteInfo:o})=>o.quoteDetailToCheckoutUrl),[C,u]=d.useState(!0),[l]=K(),[F,I]=d.useState(!0),[L,h]=d.useState(),[j,Q]=d.useState({email:"",password:""}),B=U(),m=Y(),[P,X]=_(),{state:{isCheckout:Z,logo:ee,registerEnabled:T}}=d.useContext(He),{state:{loginPageButton:te,loginPageDisplay:oe,loginPageHtml:se,portalStyle:{backgroundColor:ne="FEF9F5"}}}=d.useContext(Ee),{createAccountButtonText:ae,primaryButtonColor:ie,signInButtonText:re}=te,{displayStoreLogo:le,pageTitle:ce}=oe,{bottomHtmlRegionEnabled:ge,bottomHtmlRegionHtml:ue,createAccountPanelHtml:de,topHtmlRegionEnabled:pe,topHtmlRegionHtml:me}=se,f={loginTitle:ce||m("login.button.signIn"),loginBtn:re||m("login.button.signInUppercase"),createAccountButtonText:ae||m("login.button.createAccount"),btnColor:ie||"",widgetHeadText:pe?me:void 0,widgetBodyText:de||qe,widgetFooterText:ge?ue:void 0,logo:le?ee:void 0};d.useEffect(()=>{(async()=>{try{const o=P.get("loginFlag"),n=P.get("showTip")!=="false";if(I(n),Xe(o)&&h(o),o==="invoiceErrorTip"){const{tip:p}=M[o];v.error(m(p))}o==="loggedOutLogin"&&r&&await i(),u(!1)}finally{u(!1)}})()},[m,r,i,P]);const xe=(o,n="")=>{const{tip:p,alertType:b}=M[o];return{message:m(p,{email:n}),severity:b}},A=async o=>{const n=await Je(o);h(n?"resetPassword":"accountIncorrect")},fe=async(o,n)=>{const{errors:p}=await $e({email:o,password:n});if(p!=null&&p[0]){const{message:b}=p[0];if(b==="Reset password")return A(o),!0}return!1},he=async o=>{if(u(!0),Q(o),X(n=>(n.delete("loginFlag"),n)),Z)try{const n=await Ze(o);n.status===400&&n.type==="reset_password_before_login"?h("resetPassword"):n.type==="invalid_login"?h("accountIncorrect"):window.location.href=De}catch(n){V.error(n),await A(o.email)}finally{u(!1)}else try{const n={email:o.email,password:o.password,storeHash:_e,channelId:Ue};if(await fe(o.email,o.password))return;const{login:{result:{token:b,storefrontLoginToken:R},errors:w}}=await Ve({loginData:n});if(a(Oe(b)),Ne(R),J("on-login",{storefrontToken:R}),w!=null&&w[0]||!b){if(w!=null&&w[0]){const{message:c}=w[0];if(c==="Operation cannot be performed as the storefront channel is not live"){h("accountPrelaunch"),u(!1);return}}A(o.email)}else{const c=await We(b);if(y){B(y);return}if((c==null?void 0:c.userType)===E.MULTIPLE_B2C&&(c==null?void 0:c.role)===Ge.SUPER_ADMIN){B("/dashboard");return}if(!ze(B))return;(c==null?void 0:c.userType)===E.B2C&&B(Ye.ORDERS);const we=Ke(Number(c==null?void 0:c.role));B(we)}}catch(n){if(n instanceof Error){const p=pt[n.message];p?(v.error(m(p)),await i(!1)):v.error(m("login.loginTipInfo.accountIncorrect"))}}finally{u(!1)}},ye=T?"100%":"50%",be=T?"50%":"auto",k=L&&xe(L,j==null?void 0:j.email);return e.jsx(Fe,{setOpenPage:s,children:e.jsx(ot,{paddings:l?"0":"20px 20px",children:e.jsx(Me,{isSpinning:C,tip:m("global.tips.loading"),background:"transparent",children:e.jsx(g,{sx:{display:"flex",flexDirection:"column",width:"100%",minHeight:"400px",minWidth:"343px"},children:f&&e.jsxs(e.Fragment,{children:[L&&F&&e.jsx(g,{sx:{padding:l?0:"0 5%",margin:"30px 0 0 0"},children:k&&e.jsx(H,{severity:k.severity,variant:"filled",children:k.message})}),y&&e.jsx(H,{severity:"error",variant:"filled",children:m("login.loginText.quoteDetailToCheckoutUrl")}),e.jsx(g,{sx:{margin:"20px 0",minHeight:"150px"},children:e.jsx(st,{children:e.jsx(Te,{sx:{maxWidth:l?"70%":"250px"},onClick:()=>{window.location.href="/"},children:e.jsx("img",{src:f.logo||je(Be),alt:m("login.registerLogo"),loading:"lazy"})})})}),f.widgetHeadText&&e.jsx(S,{sx:{minHeight:"48px",width:T||l?"100%":"50%"},html:f.widgetHeadText}),e.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:e.jsx(g,{sx:{bgcolor:"#FFFFFF",borderRadius:"4px",margin:"20px 0",display:"flex",flexDirection:"column",justifyContent:"center",width:l?"auto":ye},children:e.jsxs(g,{sx:{mb:"20px",display:"flex",flexDirection:l?"column":"row",justifyContent:"center",width:l?"auto":"100%"},children:[e.jsx(g,{sx:{width:l?"auto":be,paddingRight:l?0:"2%",ml:"16px",mr:l?"16px":"",pb:T?"":"36px"},children:e.jsx(lt,{loginBtn:f.loginBtn,handleLoginSubmit:he,backgroundColor:ne})}),T&&e.jsx(g,{sx:{flex:"1",paddingLeft:l?0:"2%"},children:e.jsx(ct,{createAccountButtonText:f.createAccountButtonText,widgetBodyText:f.widgetBodyText})})]})})}),f.widgetFooterText&&e.jsx(S,{sx:{minHeight:"48px",width:T||l?"100%":"50%"},html:f.widgetFooterText})]})})})})})}function Ot(t){return Re==="catalyst"?e.jsx(rt,{}):e.jsx(mt,{...t})}export{Ot as default};
//# sourceMappingURL=index-CP7rvleV.js.map
