System.register(["./mui-legacy-Co1sKVsS.js","./intl-legacy-f5dGU49Z.js","./form-legacy-LlvE08FY.js","./lodashEs-legacy-BTGS6uHg.js","./react-setup-legacy-CKF-9cua.js","./B3CustomForm-legacy-iy2Vgra_.js","./load-functions-legacy-B3DSplhu.js","./base-legacy-DAqmyLJs.js","./users-legacy-wCSVfkv4.js","./config-legacy-BtHQq4oE.js","./router-legacy-CQEMCAt4.js","./validatorRules-legacy-CnaQOFg7.js","./reactVendor-legacy-C5drotBr.js","./eCache-legacy-QcRlogRO.js","./redux-legacy-DH94TLLa.js","./toolkit-legacy-DO7GmFjE.js","../index-legacy.JvindH6T.js","./global-legacy-vVqwfyov.js","./muiIcon-legacy-C-h6sDde.js","./dropzone-legacy-B1uEXZk9.js","./dateFns-legacy-DHywh9DD.js"],function(e,a){"use strict";var n,t,s,o,i,l,r,m,d,c,u,f,p,g,y,b,h,w,x,F,S,j,N,_,B,v,C,I,M,E,P,T,q,V;return{setters:[e=>{n=e.j,t=e.B,s=e.a1,o=e.T},e=>{i=e.r},e=>{l=e.u},e=>{r=e.t},e=>{m=e.B,d=e.ae,c=e.j,u=e.k,f=e.C,p=e.a,g=e.af,y=e.aa,b=e.ag,h=e.l,w=e.u,x=e.y,F=e.ah,S=e.ai,j=e.w,N=e.aj,_=e.ak,B=e._,v=e.I},e=>{C=e.B},null,null,e=>{I=e.c,M=e.a},e=>{E=e.d,P=e.g},e=>{T=e.L,q=e.a},e=>{V=e.v},null,null,null,null,null,null,null,null,null],execute:function(){e("default",function(){const{isBCUser:e,companyId:a,customer:s,validateEmailValue:o,emailValidation:m,passwordValidation:d,isDisplayUpgradeBanner:T}=function(){const e=w(x),a=w(({company:e})=>e.companyInfo.id),n=w(({company:e})=>e.customer),t=w(({company:e})=>e.customer.role),s=w(({b2bFeatures:e})=>e.masqueradeCompany.id),o=w(({b2bFeatures:e})=>e.masqueradeCompany.isAgenting),i=Number(3===t&&o?s:a),l=!e||3===t&&!o,m=F.B2C===n.role&&[S.B2C,S.MULTIPLE_B2C].includes(n.userType)&&"catalyst"===j,d=async e=>{if(n.emailAddress===r(e))return!0;const a={email:e,channelId:v},{isValid:t}=l?await I(a):await M(a);return t},c=e=>!(e.email!==n.emailAddress&&!e.currentPassword),u=e=>e.password===e.confirmPassword;return{isBCUser:l,companyId:i,customer:n,validateEmailValue:d,emailValidation:c,passwordValidation:u,isDisplayUpgradeBanner:m}}(),{control:V,handleSubmit:L,getValues:k,formState:{errors:J},setValue:Z,setError:K}=l({mode:"onSubmit"}),[Q,X]=u("sf-isFinishUpdate",!1,sessionStorage),{state:{portalStyle:{backgroundColor:ee="#FEF9F5"}}}=i.useContext(f),ae=c(),[ne]=p(),te=q(),[se,oe]=i.useState([]),[ie,le]=i.useState([]),[re,me]=i.useState([]),[de,ce]=i.useState(!1),[ue,fe]=i.useState({}),[pe,ge]=i.useState(!1);i.useEffect(()=>{(async()=>{try{ce(!0);const n=e?O:U,t=e?{}:{companyId:a},s=e?"customerAccountSettings":"accountSettings",o=await N(e?1:2),i=P(o.accountFormFields||[]),l=(i?.contactInformation||[]).filter(e=>"field_email_marketing_newsletter"!==e.fieldId),{additionalInformation:r=[]}=i,{[s]:m}=await n(t),d=e?G(m,l,r):$(m,l,z(),r),c=D(),u=[...d,...c],f=u.find(e=>"role"===e.name);f?.fieldType&&(f.fieldType="text"),oe(u),fe(m),le(l),me(r)}finally{Q&&(_.success(ae("accountSettings.notification.detailsUpdated")),X(!1)),ce(!1),ge(!0)}})()},[Q]);const ye=i.useMemo(()=>{const e={field_first_name:ae("accountSettings.form.firstName"),field_last_name:ae("accountSettings.form.lastName"),field_email:ae("accountSettings.form.email"),field_phone_number:ae("accountSettings.form.phoneNumber"),field_company:ae("accountSettings.form.company"),field_role:ae("accountSettings.form.role"),field_current_password:ae("accountSettings.form.currentPassword"),field_password:ae("accountSettings.form.password"),field_confirm_password:ae("accountSettings.form.confirmPassword")};return se.map(a=>({...a,label:e[a.fieldId??""]??a.label}))},[se,ae]);return n.jsx(g,{isSpinning:de,background:ee,children:n.jsxs(t,{children:[T&&n.jsx(W,{}),n.jsxs(t,{sx:{width:ne?"100%":"35%",minHeight:ne?"800px":"300px","& input, & .MuiFormControl-root .MuiTextField-root, & .MuiSelect-select.MuiSelect-filled, & .MuiTextField-root .MuiInputBase-multiline":{bgcolor:y("#FFFFFF",.87),borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"},"& .MuiButtonBase-root.MuiCheckbox-root:not(.Mui-checked), & .MuiRadio-root:not(.Mui-checked)":{color:y(h(ee),.6)},"& .MuiTypography-root.MuiTypography-body1.MuiFormControlLabel-label, & .MuiFormControl-root .MuiFormLabel-root:not(.Mui-focused)":{color:y(h(ee),.87)},"& .MuiInputLabel-root.MuiInputLabel-formControl:not(.Mui-focused)":{color:y(h("#FFFFFF"),.6)}},children:[n.jsx(C,{formFields:ye,errors:J,control:V,getValues:k,setValue:Z}),n.jsx(b,{sx:{mt:"28px",mb:ne?"20px":"0",width:"100%",visibility:pe?"visible":"hidden"},onClick:()=>{L(async n=>{ce(!0);try{const t=await o(n.email);t||K("email",{type:"custom",message:ae("accountSettings.notification.emailExists")});const i=m(n);i||_.error(ae("accountSettings.notification.updateEmailPassword"));const l=d(n);if(l||(K("confirmPassword",{type:"manual",message:ae("global.registerComplete.passwordMatchPrompt")}),K("password",{type:"manual",message:ae("global.registerComplete.passwordMatchPrompt")})),t&&i&&l){const t=(e?Y:H)(n,ue,ie,re);if(t&&(e||(t.companyId=a,t.extraFields=((e,a)=>a.filter(e=>e.custom&&1===e.groupId).map(a=>({fieldName:E(a?.name||""),fieldValue:e[a.name]})))(n,se)),""===t.newPassword&&""===t.confirmPassword&&(delete t.newPassword,delete t.confirmPassword)),!t)return void _.success(ae("accountSettings.notification.noEdits"));const o=e?R:A;await o(t),n.password&&n.currentPassword||s.emailAddress!==r(n.email)?te("/login?loginFlag=loggedOutLogin"):(B.clear(),X(!0))}}finally{ce(!1)}})()},variant:"contained",children:ae("accountSettings.button.saveUpdates")})]})]})})});const a=e=>`mutation{\n  updateAccountSettings (\n    updateData: ${d(e)}\n  ){\n    result {\n      email\n    },\n  }\n}`,L=e=>`mutation{\n  updateCustomerAccountSettings (\n    updateData: ${d(e)}\n  ){\n    result {\n      email\n    },\n  }\n}`,k=e=>`query GetB2bAccountSettings {\n  accountSettings (\n    companyId: ${e.companyId}\n  ){\n    firstName,\n    lastName,\n    company,\n    phoneNumber,\n    email,\n    formFields {\n      name,\n      value\n    },\n    extraFields {\n      fieldName,\n      fieldValue,\n    }\n    role,\n    companyRoleId,\n    companyRoleName,\n  }\n}`,A=e=>m.graphqlB2B({query:a(e)}),R=e=>m.graphqlB2B({query:L(e)}),U=e=>m.graphqlB2B({query:k(e)}),O=()=>m.graphqlB2B({query:"query GetB2CAccountSettings {\n  customerAccountSettings {\n    firstName,\n    lastName,\n    company,\n    phoneNumber,\n    email,\n    formFields {\n      name,\n      value\n    },\n  }\n}"}),z=()=>[{name:"company",fieldId:"field_company",label:"Company",required:!1,default:"",fieldType:"text",xs:12,variant:"filled",size:"small"},{name:"role",fieldId:"field_role",label:"Role",required:!1,default:"",fieldType:"text",xs:12,variant:"filled",size:"small"}],D=()=>[{name:"currentPassword",fieldId:"field_current_password",label:"Current Password",required:!1,default:"",fieldType:"password",xs:12,variant:"filled",size:"small"},{name:"password",fieldId:"field_password",label:"Password",required:!1,default:"",fieldType:"password",xs:12,variant:"filled",size:"small"},{name:"confirmPassword",fieldId:"field_confirm_password",label:"Confirm Password",required:!1,default:"",fieldType:"password",xs:12,variant:"filled",size:"small"}];function W(){const e=c();return n.jsx(t,{children:n.jsx(s,{severity:"info",variant:"filled",sx:{width:"inherit",'& button[title="Close"]':{display:"block"},mb:"24px",maxWidth:"1450px","& .MuiAlert-icon":{padding:"12px 0"},"& .MuiAlert-message":{width:"100%"}},children:n.jsxs(t,{display:"flex",flexWrap:"wrap",justifyContent:"space-between",width:"100%",children:[n.jsxs(t,{children:[n.jsx(o,{variant:"subtitle1",fontWeight:"800",children:e("accountSettings.registeredToB2b.title")}),n.jsx(o,{sx:{textWrap:"wrap"},children:e("accountSettings.registeredToB2b.description")})]}),n.jsx(o,{component:T,to:"/registeredbctob2b",sx:{textDecoration:"none",textTransform:"uppercase"},fontWeight:"bold",color:"#fff",children:e("accountSettings.registeredToB2b.upgrade")})]})})})}const J=V(["email"]),$=(e,a,n,t)=>{const s=e?.extraFields||[];return a.forEach(a=>{const n=a;"first_name"===E(a?.name||"")&&(n.default=e.firstName),"last_name"===E(a?.name||"")&&(n.default=e.lastName),"phone"===E(a?.name||"")&&(n.default=e.phoneNumber),"email"===E(a?.name||"")&&(n.default=e.email,n.validate=J)}),s.length>0&&s.forEach(e=>{const n=e,t=a.find(e=>E(e?.name||"")===n.fieldName);t&&(t.default=n.fieldValue)}),n.forEach(a=>{const n=a;"role"===a.name?(n.default=e.companyRoleName,n.disabled=!0):"company"===a.name&&(n.default=e.company,n.disabled=!0)}),t.forEach(a=>{const n=(e?.formFields||[]).find(e=>e.name===a.bcLabel);n&&(a.default=n.value)}),[...a,...n,...t]},G=(e,a,n)=>(a.forEach(a=>{const n=a;"first_name"===E(a?.name||"")&&(n.default=e.firstName),"last_name"===E(a?.name||"")&&(n.default=e.lastName),"phone"===E(a?.name||"")&&(n.default=e.phoneNumber),"email"===E(a?.name||"")&&(n.default=e.email,n.validate=J),"company"===E(a?.name||"")&&(n.default=e.company)}),n.forEach(a=>{const n=(e?.formFields||[]).find(e=>e.name===a.bcLabel);n&&(a.default=n.value)}),[...a,...n]),H=(e,a,n,t)=>{const s=a?.extraFields||[],o={formFields:[]};let i=!0,l=!0,r=!1;if(Object.keys(e).forEach(m=>{n.forEach(n=>{if(m===n.name&&(l=!1,"first_name"===E(n.name)&&(a.firstName!==e[n.name]&&(i=!1),o.firstName=e[n.name]),"last_name"===E(n.name)&&(a.lastName!==e[n.name]&&(i=!1),o.lastName=e[n.name]),"phone"===E(n.name)&&(a.phoneNumber!==e[n.name]&&(i=!1),o.phoneNumber=e[n.name]),"email"===E(n.name)&&(a.email!==e[n.name]&&(i=!1),o.email=e[n.name]),n.custom)){const a=s.find(e=>e.fieldName===E(n?.name||""));a?.fieldValue!==e[n.name]&&(r=!0)}}),r&&(i=!1),l&&t.forEach(n=>{if(n.fieldId===m&&o?.formFields){const{name:t}=n;o.formFields.push({name:n?.bcLabel||"",value:e[m]}),l=!1;const s=(a?.formFields||[]).find(e=>e.name===n.bcLabel);s&&JSON.stringify(s.value)!==JSON.stringify(e[m])&&(i=!1),!a?.formFields?.length&&t&&e[t]&&(i=!1)}}),l&&("password"===m?(o.newPassword=e[m],e[m]&&(i=!1)):o[m]=e[m]),l=!0}),delete o.company,delete o.role,!i)return o},Y=(e,a,n,t)=>{const s={formFields:[]};let o=!0,i=!0;if(Object.keys(e).forEach(l=>{n.forEach(n=>{l===n.name&&(i=!1,"first_name"===E(n.name)&&(a.firstName!==e[n.name]&&(o=!1),s.firstName=e[n.name]),"last_name"===E(n.name)&&(a.lastName!==e[n.name]&&(o=!1),s.lastName=e[n.name]),"phone"===E(n.name)&&(a.phoneNumber!==e[n.name]&&(o=!1),s.phoneNumber=e[n.name]),"email"===E(n.name)&&(a.email!==e[n.name]&&(o=!1),s.email=e[n.name]),"company"===E(n.name)&&(a.company!==e[n.name]&&(o=!1),s.company=e[n.name]))}),i&&t.forEach(n=>{if(n.fieldId===l&&s?.formFields){s.formFields.push({name:n?.bcLabel||"",value:e[l]}),i=!1;const t=(a?.formFields||[]).find(e=>e.name===n.bcLabel);t&&JSON.stringify(t.value)!==JSON.stringify(e[l])&&(o=!1)}}),i&&("password"===l?(s.newPassword=e[l],e[l]&&(o=!1)):s[l]=e[l]),i=!0}),!o)return s}}}});
//# sourceMappingURL=index-legacy-DYkrNUSG.js.map
