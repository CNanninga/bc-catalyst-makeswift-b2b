System.register(["./mui-legacy-Co1sKVsS.js","./intl-legacy-f5dGU49Z.js","./B3Filter-legacy-G_SOHomd.js","./react-setup-legacy-CKF-9cua.js","./load-functions-legacy-B3DSplhu.js","./useTableRef-legacy-Ct-N3MGx.js","./base-legacy-DAqmyLJs.js","./address-legacy-B18vfe4p.js","./config-legacy-Cf595UXD.js","./form-legacy-LlvE08FY.js","./lodashEs-legacy-BTGS6uHg.js","./B3CustomForm-legacy-iy2Vgra_.js","./config-legacy-BtHQq4oE.js","./muiIcon-legacy-C-h6sDde.js","./reactVendor-legacy-C5drotBr.js","./eCache-legacy-QcRlogRO.js","./B3FilterMore-legacy-D_Tu9tBf.js","./dateFns-legacy-DHywh9DD.js","./B3FilterSearch-legacy-DC2PyRhg.js","./redux-legacy-DH94TLLa.js","./toolkit-legacy-DO7GmFjE.js","../index-legacy.JvindH6T.js","./global-legacy-vVqwfyov.js","./router-legacy-CQEMCAt4.js","./dropzone-legacy-B1uEXZk9.js","./validatorRules-legacy-CnaQOFg7.js"],function(e,s){"use strict";var t,a,i,n,d,l,r,o,c,u,f,g,m,p,h,y,x,j,D,C,S,b,B,A,w,I,F,L,v,E,k,N,P,T,R,z,O,V,q,_,U,M,H,G,K,W,X,Z,$,J,Q,Y,ee,se,te;return{setters:[e=>{t=e.j,a=e.s,i=e.v,n=e.x,d=e.O,l=e.A,r=e.ae,o=e.T,c=e.w,u=e.B,f=e.I,g=e.af},e=>{m=e.r},e=>{p=e.B},e=>{h=e.j,y=e.ad,x=e.ak,j=e.ag,D=e.al,C=e.a,S=e.aj,b=e.u,B=e.y,A=e.G,w=e.ah,I=e.af,F=e.am,L=e.an,v=e.ao},null,e=>{E=e.u,k=e.a},e=>{N=e.b},e=>{P=e.c,T=e.u,R=e.a,z=e.b,O=e.d,V=e.e,q=e.g,_=e.f,U=e.h,M=e.i},e=>{H=e.b,G=e.a,K=e.u,W=e.f,X=e.c},e=>{Z=e.u},e=>{$=e.f},e=>{J=e.B},e=>{Q=e.d,Y=e.v,ee=e.g},e=>{se=e.E,te=e.f},null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){e("default",function(){const e=b(B),s=b(({company:e})=>e.companyInfo.id),a=b(({company:e})=>e.customer.role),i=b(({b2bFeatures:e})=>e.masqueradeCompany.id),n=b(({b2bFeatures:e})=>e.masqueradeCompany.isAgenting),{state:{addressConfig:d},dispatch:l}=m.useContext(A),{selectCompanyHierarchyId:r}=b(({company:e})=>e.companyHierarchyInfo),o=h(),c=E(),[f]=k(),g=m.useRef(null),[y,j]=m.useState(!1),[D,C]=m.useState([]),[S,v]=m.useState([]),[P,T]=m.useState({search:""}),R=a===w.SUPER_ADMIN&&n?i:s,z=!e||a===w.SUPER_ADMIN&&!n;m.useEffect(()=>{(async()=>{const{countries:e}=await L();v(e),j(!0);try{const s=await fe(!z,e);C(s||[])}catch(s){N.error(s)}finally{j(!1)}})()},[z]);const O=()=>{f.current?.refresh()},[V,q]=m.useState(!1),[H,G]=m.useState(),Z=()=>G(void 0),[$,J]=m.useState(),[Q,Y,ee]=K(ge);m.useEffect(()=>{(async()=>{if(z)q(!0);else if(Y)try{let e=d;if(!e){const{addressConfig:s}=await _();e=s,l({type:"common",payload:{addressConfig:e}})}const s=me(e,"address_book")&&me(e,3===a?"address_sales_rep":"address_admin");q(s)}catch(e){N.error(e)}})()},[d,l,z,a,Y]);const se={isEnabled:z||V&&Q,customLabel:o("addresses.addNewAddress")},te=W.map(({idLang:e,...s})=>({...s,label:o(e)})),ie=Number(r)||Number(R),ne=Y||z,de=ee||z,le=!z&&Y;return t.jsx(I,{isSpinning:y,children:t.jsxs(u,{sx:{display:"flex",flexDirection:"column",flex:1},children:[t.jsx(p,{filterMoreInfo:te,handleChange:(e,s)=>{"search"===e&&T({...P,search:s})},handleFilterChange:e=>{T({...P,country:e.country||"",state:e.state||"",city:e.city||""})},customButtonConfig:se,handleFilterCustomButtonClick:()=>{V?g.current?.handleOpenAddEditAddressClick("add"):x.error(o("addresses.noPermissionToAdd"))}}),t.jsx(F,{ref:f,columnItems:[],rowsPerPageOptions:[12,24,36],getRequestList:async(e={})=>{if(!z){const{edges:s=[],totalCount:t}=await U({companyId:R,...e});return{edges:s,totalCount:t}}const{edges:s=[],totalCount:t}=await M({...e});return{edges:s.map(e=>({node:X(e.node)})),totalCount:t}},searchParams:P,isCustomRender:!0,itemXs:c?3:4,requestLoading:j,tableKey:"id",renderItem:e=>t.jsx(re,{item:e,onEdit:ne?()=>(e=>{V?g.current?.handleOpenAddEditAddressClick("edit",e):x.error(o("addresses.noPermissionToEdit"))})(e):void 0,onDelete:de?()=>{return s=e,void(V?(J({...s}),G("delete")):x.error(o("addresses.noPermissionToEdit")));var s}:void 0,onSetDefault:le?()=>{return s=e,J({...s}),void G("setDefault");var s}:void 0},e.id)}),t.jsx(ae,{updateAddressList:O,addressFields:D,ref:g,companyId:ie,isBCPermission:z,countries:S}),V&&!z&&t.jsx(ce,{isOpen:"setDefault"===H,closeDialog:Z,setIsLoading:j,addressData:$,updateAddressList:O,companyId:ie}),V&&t.jsx(oe,{isOpen:"delete"===H,closeDialog:Z,setIsLoading:j,addressData:$,updateAddressList:O,companyId:ie,isBCPermission:z})]})})});const s=a("div")(()=>({display:"flex","& div::first-of-type":{marginRight:"2rem"},"& div":{minWidth:"45%",display:"flex",flexDirection:"column"}})),ae=m.forwardRef(function({addressFields:e,updateAddressList:a,companyId:d,isBCPermission:l,countries:r},o){const c=h(),[u,f]=m.useState(!1),[g,p]=m.useState(""),[j,D]=m.useState(!1),[C,S]=m.useState(!1),[b,B]=m.useState(e),[A,w]=m.useState([]),[I,F]=m.useState([]),[L,v]=m.useState(null),[E,k]=m.useState({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),N=!l,{control:O,handleSubmit:V,getValues:q,formState:{errors:_},watch:U,setError:M,setValue:G,reset:K}=Z({mode:"all"}),W=()=>{V(async e=>{S(!0);try{const s=await(async e=>{try{const s=A.map(s=>({fieldName:Q(s.name),fieldValue:e[s.name]||s.default})),t=await Y({extraFields:s});if(200!==t.code){const e=t.data?.errMsg||t.message||"",s=e.split(":");if(s.length>=2){const e=A.find(e=>Q(e.name)===s[0]);if(e)return M(e.name,{type:"manual",message:s[1]}),S(!1),!1}throw e}return!0}catch(s){throw x.error(s),s}})(e);if(!s)return;const t=A.map(s=>({fieldName:Q(s.name),fieldValue:e[s.name]||s.default})),{country:i,state:n}=e;let l="",o="",u=n;r.forEach(e=>{const{countryName:s,countryCode:t,states:a}=e;if(t===i)if(l=s,a.length>0){const e=a.find(e=>e.stateCode===u||e.stateName===u);o=e?.stateName||o,u=e?.stateCode||u}else u="",o=n});const m={...e,companyId:Number(d),extraFields:t,isShipping:E.isShipping?1:0,isBilling:E.isBilling?1:0,isDefaultShipping:E.isDefaultShipping?1:0,isDefaultBilling:E.isDefaultBilling?1:0,country:l,countryCode:i,state:o,stateCode:u};if("add"===g)await P(m),x.success(c("addresses.addressForm.newAddressAdded"));else if("edit"===g&&L){const{id:e}=L;await T({...m,id:Number(e)}),x.success(c("addresses.addressForm.addressUpdated"))}k({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),f(!1),await a(!0)}catch(s){x.error(s)}finally{S(!1)}})()},X=(e,s)=>{"add"===e&&I.length>0&&b.forEach(e=>{const s=e;if(e.custom)if(N){const t=I.filter(s=>s.name===e.name)[0];s.default=t.default||""}else{const t=I.filter(s=>s.name===e.name||s.bcLabel===e.bcLabel)[0];s.default=t.default||""}}),K(),v(s),p(e),f(!0),D(!1)};m.useImperativeHandle(o,()=>({handleOpenAddEditAddressClick:X})),m.useEffect(()=>{const s=e.map(e=>({...e,label:c(e.idLang)||e.label,default:N||"field_21"!==e.fieldId?e.default:""}));B(s);const t=e.filter(e=>e.custom);if(w(t),0===I.length){const s=$(e);F(s)}},[e,I.length,N]);const ee=m.useCallback(()=>{if(L){const{isShipping:e,isBilling:s,isDefaultShipping:t,isDefaultBilling:a,state:i,stateCode:n,countryCode:d,extraFields:l}=L,o=r.filter(e=>e.countryCode===d);k({isShipping:1===e,isBilling:1===s,isDefaultShipping:1===t,isDefaultBilling:1===a}),b.forEach(e=>{const s=e;if(s.custom&&l.length>0)if(N){const e=Q(s.name),t=l.find(s=>s.fieldName===e),a=I.find(s=>s.name===e);t?(G(s.name,t.fieldValue||""),s.default=t.fieldValue||""):(G(s.name,""),s.default=a.default)}else{const e=l.find(e=>e.fieldName===s.name||e.fieldName===s.bcLabel),t=I.filter(e=>e.name===s.name||e.bcLabel===s.bcLabel)[0];e?(G(s.name,e.fieldValue||""),s.default=e.fieldValue||t.default):(G(s.name,""),s.default=t.default)}else if("country"===s.name)G(s.name,d);else if("state"===s.name){if(G(s.name,n||i),o[0]){const{states:e}=o[0];e.length>0?(s.options=e,s.fieldType="dropdown",s.required=!0):(s.options=[],s.fieldType="text",s.required=!1)}}else G(s.name,"undefined"===L[s.name]?"":L[s.name])})}},[L,r,N,I,G,b]);return m.useEffect(()=>{u&&"edit"===g&&L&&!j&&(ee(),D(!0))},[u,g,L,j,ee]),m.useEffect(()=>{const e=U((e,{name:s,type:t})=>{const{country:a}=e;"country"===s&&"change"===t&&(e=>{const s=r.find(s=>s.countryCode===e)?.states||[],t=b.find(e=>"state"===e.name);t&&(s.length>0?(t.fieldType="dropdown",t.options=s,t.required=!0):(t.fieldType="text",t.options=[],t.required=!1)),G("state",""),B([...b])})(a)});return()=>e.unsubscribe()},[b,r,U]),t.jsxs(y,{isOpen:u,title:c("add"===g?"addresses.addressForm.addNewAddress":"addresses.addressForm.editAddress"),leftSizeBtn:c("addresses.addressForm.cancel"),rightSizeBtn:c("addresses.addressForm.saveAddress"),handleLeftClick:()=>{K(),k({isShipping:!1,isBilling:!1,isDefaultShipping:!1,isDefaultBilling:!1}),f(!1),p("")},handRightClick:()=>{N?W():V(async e=>{S(!0);try{const s=A.map(s=>({name:s.bcLabel,value:e[s.name]||s.default})),{country:t,state:i}=e;let n="",d="",l=i;r.forEach(e=>{const{countryName:s,countryCode:a,states:r}=e;if(a===t)if(n=s,r.length>0){const e=r.find(e=>e.stateCode===l||e.stateName===l);d=e?.stateName||d,l=e?.stateCode||l}else l="",d=i});const o={...e,formFields:s,country:n,countryCode:t,state:d,stateCode:l,addressType:""};if("add"===g)await R(o),x.success(c("addresses.addressForm.newAddressAdded"));else if("edit"===g&&L){const{bcAddressId:e}=L;e&&await z({...o,id:Number(e)}),x.success(c("addresses.addressForm.addressUpdated"))}f(!1),await a(!0)}catch(s){x.error(s)}finally{S(!1)}})()},loading:C,isShowBordered:!0,children:[N&&t.jsxs(t.Fragment,{children:[t.jsx("p",{children:c("addresses.addressForm.selectAddressType")}),t.jsx(s,{children:H.map(e=>{const{child:s,name:a,idLang:d}=e;return t.jsxs("div",{children:[t.jsx(i,{control:t.jsx(n,{checked:E[a],onChange:e=>{((e,s)=>{k("isShipping"===s?{...E,[s]:e,isDefaultShipping:!1}:{...E,[s]:e,isDefaultBilling:!1})})(e.target.checked,a)}}),label:c(d)}),s&&t.jsx(i,{control:t.jsx(n,{checked:E[s.name],onChange:()=>{k({...E,[s.name]:!E[s.name]})}}),label:c(s.idLang),sx:{display:E[a]?"":"none"}})]},a)})})]}),t.jsx(J,{formFields:b,errors:_,control:O,getValues:q,setValue:G})]})}),ie=c("div")(({marginBottom:e})=>({marginBottom:e,"& > span:not(:last-child)":{marginRight:"4px"}})),ne=c("div")(({theme:e})=>({display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:e.spacing(3)}));function de({children:e}){return t.jsx(D,{color:"#C4DD6C",textColor:"rgba(0, 0, 0, 0.87)",children:e})}function le({children:e}){return t.jsx(o,{variant:"body1",children:e})}function re({item:e,onEdit:s,onDelete:a,onSetDefault:i}){const n=d(),c=h(),g=Boolean(s||a||i),m=1===e.isDefaultShipping,p=1===e.isDefaultBilling;return t.jsx(l,{children:t.jsxs(r,{sx:{color:"#313440",wordBreak:"break-word"},children:[e.label&&t.jsx(o,{variant:"h5",sx:{marginBottom:m||p?n.spacing(1):n.spacing(3),color:"rgba(0, 0, 0, 0.87)"},children:e.label}),t.jsxs(ie,{marginBottom:m||p?n.spacing(3):0,children:[m&&t.jsx(de,{children:c("addresses.addressItemCard.defaultShipping")}),p&&t.jsx(de,{children:c("addresses.addressItemCard.defaultBilling")})]}),t.jsxs(le,{children:[e.firstName," ",e.lastName]}),t.jsx(le,{children:e.company||""}),t.jsx(le,{children:e.addressLine1}),t.jsx(le,{children:"undefined"===e.addressLine2?"":e.addressLine2}),t.jsxs(le,{children:[e.city,", ",e.state," ",e.zipCode,", ",e.country]}),t.jsx(le,{children:e.phoneNumber}),g&&t.jsxs(ne,{children:[i&&t.jsx(j,{variant:"text",sx:{ml:"-8px"},onClick:i,children:c("addresses.addressItemCard.setAsDefault")}),t.jsxs(u,{sx:{flex:1,display:"flex",justifyContent:"flex-end",gap:"8px"},children:[s&&t.jsx(f,{"aria-label":"edit",size:"small",onClick:s,children:t.jsx(se,{fontSize:"inherit"})}),a&&t.jsx(f,{"aria-label":"delete",size:"small",onClick:a,children:t.jsx(te,{fontSize:"inherit"})})]})]})]})},e.id)}function oe(e){const{isOpen:s,closeDialog:a,addressData:i,updateAddressList:n,setIsLoading:d,companyId:l,isBCPermission:r}=e,[o]=C(),c=h();return t.jsx(y,{isOpen:s,title:c("addresses.deleteAddressDialog.deleteAddress"),leftSizeBtn:c("addresses.deleteAddressDialog.cancel"),rightSizeBtn:c("addresses.deleteAddressDialog.delete"),handleLeftClick:a,handRightClick:async()=>{if(i)try{d(!0),a();const{id:e="",bcAddressId:s=""}=i;r?await V({bcAddressId:s}):await O({addressId:e,companyId:l}),x.success(c("addresses.deleteAddressDialog.successfullyDeleted")),n()}catch(e){d(!1)}},rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:t.jsx(u,{sx:{display:"flex",alignItems:o?"start":"center",justifyContent:o?"center":"start",width:o?"100%":"450px",height:"100%"},children:c("addresses.deleteAddressDialog.confirmDelete")})})}function ce(e){const{isOpen:s,closeDialog:a,setIsLoading:d,addressData:l,updateAddressList:r,companyId:o}=e,[c]=C(),f=h(),[p,j]=m.useState();m.useEffect(()=>{j(l)},[l]);const D=e=>s=>{const{checked:t}=s.target;if(p){const s={...p};"isDefaultShipping"===e&&(s.isDefaultShipping=t?1:0,s.isShipping=t?1:s.isShipping),"isDefaultBilling"===e&&(s.isDefaultBilling=t?1:0,s.isBilling=t?1:s.isShipping),j(s)}};return t.jsx(y,{isOpen:s,title:f("addresses.setDefaultDialog.setDefaultAddress"),leftSizeBtn:f("addresses.setDefaultDialog.cancel"),rightSizeBtn:"set",handleLeftClick:a,handRightClick:async()=>{try{d(!0),a(),await T({...p,companyId:o}),x.success(f("addresses.setDefaultDialog.successfullySet")),r()}catch(e){d(!1)}},children:t.jsx(u,{sx:{display:"flex",alignItems:c?"start":"center",width:c?"100%":"450px",height:"100%"},children:p&&t.jsx(u,{sx:{padding:c?"0":"10px 0"},children:t.jsxs(g,{children:[t.jsx(i,{control:t.jsx(n,{checked:1===p.isDefaultShipping,onChange:D("isDefaultShipping")}),label:f("addresses.setDefaultDialog.setDefaultShippingAddress")}),t.jsx(i,{control:t.jsx(n,{checked:1===p.isDefaultBilling,onChange:D("isDefaultBilling")}),label:f("addresses.setDefaultDialog.setDefaultBillingAddress")})]})})})})}const ue=async()=>{try{const e=(e=>{if(0===e.length)return[];const s=e.filter(e=>e.visibleToEnduser)||[];if(0===s?.length)return[];const t=s.map(e=>({...e,groupId:4,visible:e.visibleToEnduser})),a=ee(t).address;return a.map(e=>(e.custom=!0,e)),a})((await q()).addressExtraFields);return[...G,...e]}catch(e){N.error(e)}return[]},fe=async(e,s)=>{let t=[];try{if(e){const e=await ue();e&&(t=e)}else t=await(async()=>{try{const{accountFormFields:e}=await S(1),s=e.filter(e=>4===e.groupId);return ee(s).address}catch(e){N.error(e)}})();return t.map(e=>{const t=e;return"country"===e.name&&(t.options=s,t.required=!0),"state"===e.name&&(t.fieldType="text",t.required=!1),e}),t}catch(a){N.error(a)}return[]},ge=[v.addressesCreateActionsPermission,v.addressesUpdateActionsPermission,v.addressesDeleteActionsPermission],me=(e,s)=>"1"===(e??[]).find(e=>e.key===s)?.isEnabled}}});
//# sourceMappingURL=index-legacy-uuyAuyPO.js.map
