System.register(["./mui-legacy-Co1sKVsS.js","./intl-legacy-f5dGU49Z.js","./lodashEs-legacy-BTGS6uHg.js","./react-setup-legacy-CKF-9cua.js","./load-functions-legacy-B3DSplhu.js","./base-legacy-DAqmyLJs.js","./payment-legacy-nHPMo5AB.js","./useSort-legacy-D3ci4eqa.js","./B2BAutoCompleteCheckbox-legacy-Dcxtdu2O.js","./B3Filter-legacy-G_SOHomd.js","./router-legacy-CQEMCAt4.js","./muiIcon-legacy-C-h6sDde.js","./resizable-legacy-CeQnJqrL.js","./reactVendor-legacy-C5drotBr.js","./pdfobject-legacy-HcSHW6d_.js","./eCache-legacy-QcRlogRO.js","./redux-legacy-DH94TLLa.js","./toolkit-legacy-DO7GmFjE.js","../index-legacy.JvindH6T.js","./global-legacy-vVqwfyov.js","./dropzone-legacy-B1uEXZk9.js","./dateFns-legacy-DHywh9DD.js","./b3checkout-legacy-Dvs0aye-.js","./B3FilterMore-legacy-D_Tu9tBf.js","./form-legacy-LlvE08FY.js","./B3CustomForm-legacy-iy2Vgra_.js","./B3FilterSearch-legacy-DC2PyRhg.js"],function(e,n){"use strict";var t,i,r,o,a,s,l,c,d,u,p,m,x,y,h,b,f,v,g,j,w,C,N,I,S,k,D,B,A,P,R,T,F,E,L,$,O,z,H,V,W,q,M,_,U,G,K,X,Y,J,Q,Z,ee,ne,te,ie;return{setters:[e=>{t=e.j,i=e.I,r=e.s,o=e.Y,a=e.X,s=e.G,l=e.B,c=e.T,d=e.y,u=e.A,p=e.ae,m=e.b,x=e.ag,y=e.w},e=>{h=e.r},e=>{b=e.f},e=>{f=e.u,v=e.j,g=e.a2,j=e.ao,w=e.at,C=e.ak,N=e.a,I=e.au,S=e.al,k=e.ad,D=e.af,B=e.av,A=e.aw,P=e.ax,R=e.ay,T=e.az,F=e.a6,E=e.G,L=e.am,$=e.ah,O=e.aA,z=e.aB},null,e=>{H=e.b},e=>{V=e.i,W=e.g,q=e.f,M=e.a,_=e.b,U=e.c,G=e.e,K=e.d},e=>{X=e.u},e=>{Y=e.B},e=>{J=e.B},e=>{Q=e.a,Z=e.u},e=>{ee=e.M},e=>{ne=e.r},e=>{te=e.g},e=>{ie=e.r},null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){e("default",function(){const e=(new Date).getTime(),n=v(),{isAgenting:i,selectCompanyHierarchyId:r,isEnabledCompanyHierarchy:o,invoicePayPermission:a,purchasabilityPermission:s,currentCompanyId:u,invoiceSubViewPermission:p}=function(){const e=f(({company:e})=>e.customer.role),n=f(({b2bFeatures:e})=>e.masqueradeCompany.isAgenting),t=f(({company:e})=>e.companyInfo.id),{selectCompanyHierarchyId:i,isEnabledCompanyHierarchy:r}=f(({company:e})=>e.companyHierarchyInfo),o=f(({b2bFeatures:e})=>e.masqueradeCompany.id),{invoicePayPermission:a,purchasabilityPermission:s}=f(g),l=e===$.SUPER_ADMIN&&n?Number(o):Number(t),{invoice:c}=f(({company:e})=>e.pagesSubsidiariesPermission);return{isAgenting:n,selectCompanyHierarchyId:i,isEnabledCompanyHierarchy:r,invoicePayPermission:a,purchasabilityPermission:s,currentCompanyId:l,invoiceSubViewPermission:c}}(),y=Q(),[w]=N(),S=h.useRef(null),{decimal_places:k=2}=T(),[B,P]=h.useState(!1),[V,W]=h.useState(!1),[M,_]=h.useState(""),[ee,ne]=h.useState(""),[te,ie]=h.useState(""),[oe,ce]=h.useState(0),[de,fe]=h.useState(0),[ve,ge]=h.useState([]),[we,Ce]=h.useState([]),[Ne,Ie]=h.useState([]),[ke,Ae]=h.useState({}),[Pe,Re]=h.useState(n("invoice.exportCsvText")),[Te,Fe]=h.useState(!1),[Ee,Le]=h.useState([]),[$e,Oe]=h.useState(a),ze=F({level:O.COMPANY_SUBSIDIARIES,code:j.invoicePayPermission}),{state:{bcLanguage:He}}=h.useContext(E),[Ve,We,qe]=X(he,ye,ke,Ae),Me=Z(),_e=e=>Object.keys(e).some(n=>"first"!==n&&"offset"!==n&&"orderBy"!==n&&e[n]),Ue=async(e,t,i)=>{try{const r=Number(i)===Number(u)?a:ze;P(!0);const o=s&&r&&2!==t,l=await re(e,o);if(!l)return void C.error(n("invoice.pdfUrlResolutionError"));const{href:c}=window.location;if(!c.includes("invoice"))return;window.open(l,"_blank","fullscreen=yes")}catch(r){H.error(r)}finally{P(!1)}};h.useEffect(()=>{const e={...Be,companyIds:[Number(r)||Number(u)]};if(Me?.search){const n=new URLSearchParams(Me.search),t=n.get("invoiceId")||"",i=n.get("receiptId")||"";t&&(Ae({...e,q:t}),ie(pe.DETAIL)),i&&(ie(pe.CHECKOUT),Ae({...e}),ne(i))}else ie(pe.NORMAL),Ae({...e})},[Me,r]),h.useEffect(()=>{const e=ve.filter(e=>{const{node:{openBalance:n}}=e;return 0!==Number(n.value)})||[];if(e.length>0)if(0===we.length)Ce(b(e));else{const n=e.map(e=>{const{node:{id:n,openBalance:t}}=e,i=we.find(e=>{const{node:{id:t}}=e;return Number(n)===Number(t)});if(i){const{node:{openBalance:e}}=i;t.value=e.value}return e});Ce(b(n))}else Ce([])},[ve]);const Ge=(e,n)=>{let t=e;if(e.includes(".")){const n=e.split("."),i=0===k?0:n[1].length-Number(k);if(n[1]&&i>0){const e=n[0]+n[1];t=`${e.slice(0,-k)}.${e.slice(-k)}`}n[1]&&0===i&&(t=q(Number(e),k))}else t.length>1?(t=`${e.slice(0,1)}.${e.slice(-1)}`,0===Number(k)&&(t=e)):t=e;((e,n)=>{const t=ve.find(e=>{const{node:{id:t}}=e;return Number(t)===Number(n)});if(we.length>0){const i=we.map(i=>{const{node:{id:r,openBalance:o}}=i,{node:{openBalance:a}}=t;return Number(r)===Number(n)&&(o.value=Number(a.value)<Number(e)?a.value:e),i});Ce(i)}})(t,n)},Ke=[{key:"id",title:n("invoice.headers.invoice"),isSortable:!0,render:e=>t.jsx(l,{sx:{color:"#000000",cursor:"pointer",":hover":{textDecoration:"underline"}},role:"button",onClick:()=>{const n=e?.companyInfo||{};Ue(e.id,e.status,n?.companyId)},children:e?.invoiceNumber?e?.invoiceNumber:e?.id}),width:"8%"},{key:"companyInfo",title:n("invoice.headers.companyName"),isSortable:!1,render:e=>{const{companyName:n}=e?.companyInfo||{};return t.jsx(l,{children:n})},width:"15%"},{key:"orderNumber",title:n("invoice.headers.order"),isSortable:!0,render:e=>t.jsx(l,{role:"button",sx:{color:"#000000",cursor:"pointer",":hover":{textDecoration:"underline"}},onClick:()=>{y(`/orderDetail/${e.orderNumber}`)},children:e?.orderNumber||"-"}),width:"12%"},{key:"createdAt",title:n("invoice.headers.invoiceDate"),isSortable:!0,render:e=>`${e.createdAt?A(Number(e.createdAt)):"–"}`,width:"15%"},{key:"updatedAt",title:n("invoice.headers.dueDate"),isSortable:!0,render:n=>{const{dueDate:i,status:r}=n,o=e>1e3*i&&2!==r;return t.jsx(c,{sx:{color:o?"#D32F2F":"rgba(0, 0, 0, 0.87)",fontSize:"14px"},children:`${n.dueDate?A(Number(n.dueDate)):"–"}`})},width:"15%"},{key:"originalBalance",title:n("invoice.headers.invoiceTotal"),isSortable:!0,render:e=>{const{originalBalance:n}=e,t=q(Number(n.value),k);return`${I(n.code)}${t||0}`},width:"10%"},{key:"openBalance",title:n("invoice.headers.amountDue"),isSortable:!0,render:e=>{const{openBalance:n}=e,t=q(Number(n.value),k);return`${I(n.code)}${t||0}`},width:"10%"},{key:"openBalanceToPay",title:n("invoice.headers.amountToPay"),render:e=>{const{openBalance:n,id:i}=e,r=n.code||"USD";let o=n.value,a=!0;if(we.length>0){const e=we.find(e=>{const{node:{id:n}}=e;return Number(n)===Number(i)});if(e){const{node:{openBalance:t}}=e;a=!1,o=t.value,0===Number(n.value)&&(a=!0)}}return t.jsx(m,{disabled:a,variant:"filled",value:o||"",InputProps:{startAdornment:t.jsx(x,{position:"start",sx:{padding:"8px 0",marginTop:"0 !important"},children:I(r)})},sx:{"& input":{paddingTop:"8px"},'& input[type="number"]::-webkit-inner-spin-button, & input[type="number"]::-webkit-outer-spin-button':{WebkitAppearance:"none",margin:0}},onChange:e=>{const n=e.target?.value;Ge(n,i)},type:"number"})},width:"15%"},{key:"status",title:n("invoice.headers.status"),isSortable:!0,render:n=>{const{status:i,dueDate:r}=n;let o=n.status;return 0===i&&e>1e3*r&&(o=3),t.jsx(le,{code:o})}},{key:"invoiceActions",title:n("invoice.headers.action"),render:e=>{const{id:n,companyInfo:i}=e;let r=e;if(we.length>0){const e=we.find(e=>{const{node:{id:t}}=e;return Number(t)===Number(n)});e&&(r=e.node)}return t.jsx(ae,{row:r,setInvoiceId:_,handleOpenHistoryModal:W,setIsRequestLoading:P,isCurrentCompany:Number(u)===Number(i.companyId),invoicePay:Number(u)===Number(i.companyId)?a:ze})},width:"10%"}];h.useEffect(()=>{let e=n("invoice.exportCsvText");const t=!!ke&&_e(ke),i=t?Ee.filter(e=>ve.some(n=>e?.node?.id===n?.node?.id)):ve;e=t?i.length>0?n("invoice.exportSelectedAsCsv"):n("invoice.exportFilteredAsCsv"):i.length>0?n("invoice.exportSelectedAsCsv"):n("invoice.exportCsvText"),Re(e)},[ve,ke,Ee]);const Xe=me.map(e=>{const t=e;return"status"===e.name&&(t.label=n(xe.status)),t.options=e.options.map(e=>(e.label=n(xe[e.key]),e)),e});return t.jsxs(D,{isSpinning:B,children:[t.jsxs(l,{sx:{overflowX:"auto",display:"flex",flexDirection:"column",flex:1,position:"relative"},children:[t.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:w?"flex-start":"center",flexDirection:w?"column":"row"},children:[t.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:w?"flex-start":"center",flexDirection:w?"column":"row",width:w?"100%":"auto","& > div":{width:w?"100%":"auto"}},children:[o&&p&&t.jsx(l,{sx:{mr:w?0:"10px",mb:"30px"},children:t.jsx(Y,{handleChangeCompanyIds:e=>{const n=e.includes(-1)?[]:e;Ae({...ke,companyIds:n}),Oe(e.includes(u)||e.includes(-1)?a:ze)}})}),t.jsx(J,{filterMoreInfo:Xe,handleChange:(e,n)=>{"search"===e&&(Ae({...ke,q:n}),Fe(!0),ie(pe.NORMAL))},handleFilterChange:n=>{const t=n?.startValue?z(new Date(n?.startValue).getTime()/1e3):"",i=n?.endValue?z(new Date(n?.endValue).getTime()/1e3,!0):"",r={status:`${3===n?.status?0:n?.status}`||"",beginDateAt:t,endDateAt:i,beginDueDateAt:0===n?.status?parseInt(""+e/1e3,10):"",endDueDateAt:3===n?.status?parseInt(""+e/1e3,10):""};Ae({...ke,...r}),Fe(!0),ie(pe.NORMAL)},startPicker:{isEnabled:!0,label:n("invoice.filter.from"),defaultValue:"number"==typeof ke?.beginDateAt?1e3*Number(ke.beginDateAt):"",pickerKey:"start"},endPicker:{isEnabled:!0,label:n("invoice.filter.to"),defaultValue:"number"==typeof ke?.endDateAt?1e3*Number(ke.endDateAt):"",pickerKey:"end"},searchValue:ke?.q||"",pcContainerWidth:"36rem",pcSearchContainerWidth:"80%"})]}),t.jsxs(l,{sx:{display:"flex",marginBottom:"30px",flexDirection:document.body.clientWidth<=465?"column":"row"},children:[t.jsx(c,{sx:{fontSize:"24px",color:"#000000"},children:n("invoice.openUnpaid",{unpaid:R(oe)})}),document.body.clientWidth>=465&&t.jsx(c,{sx:{fontSize:"24px",margin:"0 8px"},children:"|"}),t.jsx(c,{sx:{fontSize:"24px",color:"#D32F2F"},children:n("invoice.overdueAmount",{overdue:R(de)})})]})]}),t.jsx(L,{ref:S,columnItems:Ke,rowsPerPageOptions:[10,20,30],getRequestList:async e=>{const{invoices:{edges:n,totalCount:t}}=await U(e),i=n;return te===pe.DETAIL&&i.length&&i.forEach(e=>{e.node.isCollapse=!0}),i.forEach(e=>{const{node:{openBalance:n}}=e,t=e;t.node.disableCurrentCheckbox=!1,n.originValue=`${Number(n.value)}`,n.value=q(Number(n.value),k),t.node.disableCurrentCheckbox=0===Number(n.value);const{companyInfo:i}=t.node;Number(i.companyId)!==Number(u)&&(t.node.disableCurrentCheckbox=!ze||0===Number(n.value))}),Ie(i),(async()=>{try{P(!0);const{invoiceStats:e}=await K(ke?.status?Number(ke.status):0,Number(k),ke?.companyIds||[]);if(e){const{overDueBalance:n,totalBalance:t}=e;ce(Number(q(Number(t),k))),fe(Number(q(Number(n),k)))}}catch(e){H.error(e)}finally{P(!1)}})(),ke&&_e(ke)&&i.length?(e=>{if(Te)return Le(e),void Fe(!1);Ee.length||Le(e);const n=[...Ee];e.forEach(e=>{const t=e?.node||e;Ee.some(e=>e.node.id===t.id)||n.push(e)}),Le(n)})(i):Le([]),{edges:i,totalCount:t}},searchParams:ke,isCustomRender:!1,requestLoading:P,tableKey:"id",showCheckbox:$e&&s,showSelectAllCheckbox:!w&&$e&&s,disableCheckbox:!1,applyAllDisableCheckbox:!1,getSelectCheckbox:e=>{if(e.length>0){const n=S.current?.getCacheList()||[],t=e.map(e=>n.find(n=>{const{node:t}=n;return Number(t.id)===Number(e)})).filter(e=>e&&!e.node.disableCurrentCheckbox);ge([...t])}else ge([])},CollapseComponent:Se,sortDirection:We,orderBy:qe,sortByFn:Ve,isSelectOtherPageCheckbox:!0,hover:!0,isAutoRefresh:!1,renderItem:(e,n,i)=>t.jsx(De,{item:e,checkBox:i,handleSetSelectedInvoiceAccount:Ge,handleViewInvoice:Ue,setIsRequestLoading:P,setInvoiceId:_,handleOpenHistoryModal:W,selectedPay:we,handleGetCorrespondingCurrency:I,addBottom:Ne.length-1===n,isCurrentCompany:Number(u)===Number(e.companyInfo.companyId),invoicePay:Number(u)===Number(e.companyInfo.companyId)?a:ze})}),Ne.length>0&&!w&&t.jsx(l,{sx:{position:"absolute",bottom:"8px",left:"20px"},children:t.jsx(d,{variant:"text",onClick:async()=>{try{P(!0);const e=(ke&&_e(ke)?Ee.filter(e=>ve.some(n=>e?.node?.id===n?.node?.id)):ve).map(e=>e.node.id),n=ke?.status?[Number(ke.status)]:[];let t="-invoice_number";if(ke?.orderBy){const e=String(ke.orderBy);t=e.includes("-")?`-${be[e.split("-")[1]]}`:be[e]}const i={search:ke?.q||"",idIn:`${e||""}`,orderNumber:"",beginDateAt:ke?.beginDateAt||null,endDateAt:ke?.endDateAt||null,status:n,orderBy:t,companyIds:ke?.companyIds||[]},{invoicesExport:r}=await G({invoiceFilterData:i,lang:He||"en"});r?.url&&window.open(r?.url,"_blank")}catch(e){H.error(e)}finally{P(!1)}},children:Pe})})]}),we.length>0&&((a||ze)&&s||i)&&t.jsx(se,{selectedPay:we,decimalPlaces:k}),t.jsx(ue,{open:V,currentInvoiceId:M,setOpen:W}),t.jsx(je,{receiptId:Number(ee),type:te})]})});const n=async(e,n=!1)=>{const{invoicePdf:{url:t}}=await V(Number(e),n);return t},re=async(e,t=!1)=>{let i="";try{i=await n(e,t);const r=await(e=>new Promise((n,t)=>{fetch(e).then(e=>e.blob()).then(e=>{const t=new Blob([e],{type:"application/pdf"}),i=window.URL.createObjectURL(t);n(i)}).catch(e=>{t(e)})}))(i);return r}catch(r){return i}},oe=r(a)(()=>({"& .MuiPaper-elevation":{boxShadow:"0px 1px 0px -1px rgba(0, 0, 0, 0.1), 0px 1px 6px rgba(0, 0, 0, 0.07), 0px 1px 4px rgba(0, 0, 0, 0.06)",borderRadius:"4px"}}));function ae({row:e,setIsRequestLoading:r,setInvoiceId:a,handleOpenHistoryModal:s,isCurrentCompany:l,invoicePay:c}){const d=f(({global:e})=>e.storeInfo.platform),u=h.useRef(null),[p,m]=h.useState(!1),[x,y]=h.useState(!0),b=Q(),N=v(),{invoicePayPermission:I,purchasabilityPermission:S}=f(g),{getOrderPermission:k}=j,[D,B]=h.useState(!1),A=()=>{m(!1)},P=async n=>{const{id:t}=e;A(),r(!0);const i=await re(t,n);if(r(!1),!i)return void C.error("pdf url resolution error");const{href:o}=window.location;o.includes("invoice")&&window.open(i,"_blank","fullscreen=yes")},R=async()=>{const{id:t}=e;A(),r(!0);const i=await n(t);r(!1),function(e,n){const t=document.createElement("a");t.href=e,t.target="_blank",t.download=n,t.click()}(i,"file.pdf")};return h.useEffect(()=>{const{openBalance:n,orderUserId:t,companyInfo:i}=e,r=Number(n.value)>0&&I&&S;y(l?r:r&&c);const o=w({code:k,companyId:Number(i.companyId),userId:Number(t)});B(o)},[]),t.jsxs(t.Fragment,{children:[t.jsx(i,{onClick:()=>{const{id:n}=e;a(n),m(!0)},ref:u,"aria-label":N("invoice.actions.moreActions"),"aria-haspopup":"menu",children:t.jsx(ee,{})}),t.jsxs(oe,{id:"basic-menu",anchorEl:u.current,open:p,onClose:A,MenuListProps:{"aria-labelledby":"basic-button"},anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:[t.jsx(o,{sx:{color:"primary.main"},onClick:()=>P(2!==e.status&&I&&S),children:N("invoice.actions.viewInvoice")},"View-invoice"),D&&t.jsx(o,{sx:{color:"primary.main"},onClick:()=>{const{orderNumber:n}=e;A(),b(`/orderDetail/${n}`)},children:N("invoice.actions.viewOrder")},"View-Order"),0!==e.status&&t.jsx(o,{sx:{color:"primary.main"},onClick:async()=>{A(),s(!0)},children:N("invoice.actions.viewPaymentHistory")},"View-payment-history"),x&&t.jsx(o,{sx:{color:"primary.main"},onClick:async()=>{A();const{openBalance:n,originalBalance:t,id:i}=e,r={lineItems:[{invoiceId:Number(i),amount:"."===n.value?"0":`${Number(n.value)}`}],currency:n?.code||t.code};"."!==n.value&&0!==Number(n.value)?await W(r,d,!1):C.error("The payment amount entered has an invalid value.")},children:N("invoice.actions.pay")},"Pay"),t.jsx(o,{sx:{color:"primary.main"},onClick:()=>P(2!==e.status&&I&&S),children:N("invoice.actions.print")},"Print"),t.jsx(o,{sx:{color:"primary.main"},onClick:()=>R(),children:N("invoice.actions.download")},"Download")]})]})}function se(e){const n=f(({global:e})=>e.storeInfo.platform),i=v(),[r]=N(),[o,a]=h.useState(0),[u,p]=h.useState("$"),m=f(({b2bFeatures:e})=>e.masqueradeCompany.isAgenting),x=r?{alignItems:"flex-start",flexDirection:"column"}:{alignItems:"center"},{selectedPay:y,decimalPlaces:b}=e;return h.useEffect(()=>{if(y.length>0){const e=e=>{let n=0;e.forEach(e=>{const{node:{openBalance:t}}=e;n+="."===t.value?0:Number(t.value)}),a(q(n,b))},{node:{openBalance:n}}=y[0],t=I(n.code);p(t),e(y)}},[b,y]),t.jsxs(s,{sx:{position:"fixed",bottom:r&&m?"52px":0,left:0,backgroundColor:"#fff",width:"100%",padding:r?"0 0 1rem 0":"0 40px 1rem 40px",height:r?"8rem":"auto",marginLeft:0,display:"flex",flexWrap:"nowrap",zIndex:"999"},container:!0,spacing:2,children:[t.jsx(s,{item:!0,sx:{display:r?"none":"block",width:"290px",paddingLeft:"20px"}}),t.jsx(s,{item:!0,sx:r?{flexBasis:"100%"}:{flexBasis:"690px",flexGrow:1},children:t.jsxs(l,{sx:{width:"100%",pr:"20px",display:"flex",zIndex:"999",justifyContent:"space-between",...x},children:[t.jsx(c,{sx:{color:"#000000",fontSize:"16px",fontWeight:"400"},children:i("invoice.footer.invoiceSelected",{invoices:y.length})}),t.jsxs(l,{sx:{display:"flex",alignItems:"center",flexWrap:r?"wrap":"nowrap",width:r?"100%":"auto"},children:[t.jsx(c,{variant:"h6",sx:{fontSize:"16px",fontWeight:"700",color:"#000000"},children:i("invoice.footer.totalPayment",{total:`${u}${o}`})}),t.jsx(l,{sx:{display:"flex",alignItems:"center",marginTop:r?"0.5rem":0,width:r?"100%":"auto"},children:t.jsx(d,{variant:"contained",sx:{marginLeft:r?0:"1rem",width:r?"100%":"auto"},onClick:()=>{(async()=>{const e=[];let t="SGD";if(y.length>0){if(y.forEach(n=>{const{node:{id:i,openBalance:r,originalBalance:o}}=n,a=q(Number(r.originValue),b)===r.value?Number(r.originValue):Number(r.value);e.push({invoiceId:Number(i),amount:"."===r.value?"0":`${Number(a)}`}),t=r?.code||o.code}),e.find(e=>"."===e.amount||0===Number(e.amount)))return void C.error(i("invoice.footer.invalidNameError"));const r={lineItems:e,currency:t};await W(r,n,!1)}})()},children:i("invoice.footer.payInvoices")})})]})]})}),t.jsx(s,{item:!0,sx:r?{flexBasis:"100%",display:r?"none":"block"}:{flexBasis:"0",display:r?"none":"block"}})]})}function le(e){const{code:n}=e,i=v(),r=(o=n,{0:{textColor:"#000000",name:i("invoice.filterStatus.open"),color:"#F1C224"},1:{textColor:"#FFFFFF",name:i("invoice.filterStatus.partiallyPaid"),color:"#516FAE"},2:{textColor:"#000000",name:i("invoice.filterStatus.paid"),color:"#C4DD6C"},3:{textColor:"#FFFFFF",name:i("invoice.filterStatus.overdue"),color:"#D32F2F"}}[o]||{});var o;return r.name?t.jsx(S,{color:r.color,textColor:r.textColor,children:r.name}):null}function ce({title:e}){return t.jsxs(c,{sx:{fontWeight:"bold",pr:"5px"},children:[e,":"]})}function de({list:e}){return t.jsx(t.Fragment,{children:e.map(e=>{const{node:{createdAt:n,amount:i,paymentType:r,transactionType:o,referenceNumber:a,id:s}}=e;return t.jsx(u,{sx:{mb:"10px"},children:t.jsxs(p,{sx:{color:"#313440",wordBreak:"break-word"},children:[t.jsxs(l,{sx:{display:"flex"},children:[t.jsx(ce,{title:"Date received"}),t.jsx(c,{variant:"body1",children:`${A(Number(n))}`})]}),t.jsxs(l,{sx:{display:"flex"},children:[t.jsx(ce,{title:"Amount"}),t.jsx(c,{variant:"body1",children:P(i.code,Number(i?.value||0))})]}),t.jsxs(l,{sx:{display:"flex"},children:[t.jsx(ce,{title:"Transaction type"}),t.jsx(c,{variant:"body1",children:o})]}),t.jsxs(l,{sx:{display:"flex"},children:[t.jsx(ce,{title:"Payment type"}),t.jsx(c,{variant:"body1",children:r})]}),t.jsxs(l,{sx:{display:"flex"},children:[t.jsx(ce,{title:"Reference"}),t.jsx(c,{variant:"body1",children:a||"–"})]})]})},s)})})}function ue({open:e,setOpen:n,currentInvoiceId:i}){const r=v(),[o]=N(),[a,s]=h.useState(!1),[c,d]=h.useState([]);return h.useEffect(()=>{e&&i&&(async()=>{s(!0);const{allReceiptLines:{edges:e=[]}}=await M(Number(i));d(e),s(!1)})()},[e,i]),t.jsx(k,{isOpen:e,leftSizeBtn:"",rightSizeBtn:"ok",title:r("invoice.paymentHistory.title"),showLeftBtn:!1,handRightClick:()=>n(!1),children:t.jsx(l,{sx:{width:o?"100%":"384px",maxHeight:"600px"},children:t.jsx(D,{isSpinning:a,children:t.jsx(l,{sx:{display:"flex",flexDirection:"column",flex:1},children:c.length?t.jsx(de,{list:c}):t.jsx(B,{})})})})})}const pe={NORMAL:"normal",DETAIL:"detail",CHECKOUT:"checkout"},me=[{name:"status",label:"Status",required:!1,default:"",fieldType:"dropdown",xs:12,variant:"filled",size:"small",options:[{key:"open",value:0,label:"Open"},{key:"partialPaid",value:1,label:"Partially paid"},{key:"paid",value:2,label:"Paid"},{key:"overdue",value:3,label:"Overdue"}]}],xe={status:"invoice.filterStatus.title",open:"invoice.filterStatus.open",partialPaid:"invoice.filterStatus.partiallyPaid",paid:"invoice.filterStatus.paid",overdue:"invoice.filterStatus.overdue"},ye="id",he={id:"invoiceNumber",orderNumber:"orderNumber",createdAt:"createdAt",updatedAt:"dueDate",originalBalance:"originalBalanceAmount",openBalance:"openBalanceAmount",status:"status"},be={invoiceNumber:"invoice_number",orderNumber:"order_number",createdAt:"created_at",dueDate:"due_date",originalBalanceAmount:"original_balance_amount",openBalanceAmount:"open_balance_amount"};function fe({title:e,withColon:n=!0}){return t.jsx(c,{sx:{fontWeight:"bold",pr:"5px"},children:n?`${e}:`:e})}function ve({isRow:e=!0,type:n="",value:i,label:r,code:o}){return t.jsxs(l,{sx:{display:"flex",flexDirection:e?"row":"column"},children:[t.jsx(fe,{title:r}),t.jsx(c,{variant:"body1",children:`${(()=>{if("time"===n)return A(Number(i))||"";if("currency"===n){const e=Number(i||0);return P(o,e)}if("paymentType"===n){let e=`${i}`.trim();return i&&(e=e.slice(0,1).toUpperCase()+e.slice(1).toLowerCase()),e}return i||"–"})()}`})]})}function ge({list:e}){const{receiptLineSet:{edges:n=[]},details:i}=e,r=i?.paymentDetails?.comment||"",o=v();return t.jsxs(l,{children:[[{key:"paymentId",label:"Payment#",type:"",isRow:!0,idLang:"payment.paymentNumber"},{key:"createdAt",label:"Payment received on",type:"time",isRow:!0,idLang:"payment.paymentReceivedOn"},{key:"transactionType",label:"Transaction type",type:"",isRow:!0,idLang:"payment.transactionType"},{key:"paymentType",label:"Payment type",type:"paymentType",isRow:!0,idLang:"payment.paymentType"},{key:"totalAmount",label:"Payment total",type:"currency",isRow:!0,idLang:"payment.paymentTotal"},{key:"referenceNumber",label:"Reference",type:"",isRow:!0,idLang:"payment.reference"}].map(n=>t.jsx(ve,{isRow:!!n.isRow,type:n.type,value:e[n.key],code:e?.totalCode||"SGD",label:o(n.idLang)},n.key)),t.jsxs(l,{sx:{display:"flex",flexDirection:"column",mb:"30px"},children:[t.jsx(fe,{title:o("payment.paymentComment")}),t.jsx(c,{sx:{maxHeight:"50px"},children:r})]}),t.jsxs(l,{sx:{display:"flex",flexDirection:"column"},children:[t.jsx(fe,{title:o("payment.invoicesPaid"),withColon:!1}),t.jsxs(c,{variant:"body1",children:[o("payment.paymentTowardsInvoices")," "]})]}),t.jsxs(l,{children:[t.jsxs(l,{sx:{borderBottom:"1px solid #D9DCE9",padding:"20px 15px",display:"flex",justifyContent:"space-between",fontWeight:500},children:[t.jsx(c,{sx:{fontSize:"14px",fontWeight:"500",color:"#000000"},children:o("payment.invoiceNumber")}),t.jsx(c,{sx:{fontSize:"14px",fontWeight:"500",color:"#000000"},children:o("payment.amountPaid")})]}),n.map(e=>{const{id:n,invoiceNumber:i,amount:{value:r,code:o}}=e.node,a=Number(r||0),s=P(o,a);return t.jsxs(l,{sx:{borderBottom:"1px solid #D9DCE9",padding:"20px 15px",display:"flex",justifyContent:"space-between"},children:[t.jsx(c,{children:i}),t.jsx(c,{children:s})]},n)})]})]})}function je({receiptId:e,type:n}){const[i]=N(),[r,o]=h.useState(!1),[a,s]=h.useState(!1),[c,u]=h.useState(null),p=Q(),m=v();h.useEffect(()=>{n===pe.CHECKOUT&&e&&(async()=>{o(!0);const{receipt:n}=await _(Number(e));u(n),s(!0),o(!1)})()},[e,n]);const x=()=>{s(!1),p("/invoice")};return t.jsx(k,{isOpen:a,leftSizeBtn:"",customActions:()=>t.jsx(d,{onClick:x,variant:"text",children:m("payment.okButton")}),title:m("payment.paymentSuccess"),showLeftBtn:!1,children:t.jsx(l,{sx:{width:i?"100%":"384px",maxHeight:"600px"},children:t.jsx(D,{isSpinning:r,children:t.jsx(l,{sx:{display:"flex",flexDirection:"column",flex:1},children:c?t.jsx(ge,{list:c}):t.jsx(B,{})})})})})}var we=ne(),Ce=ie();const Ne=te(Ce),Ie=300;function Se({row:e}){const n=h.useRef(null),i=h.useRef(null),[r,o]=h.useState(!1),[a,s]=h.useState(Ie);return h.useEffect(()=>((async()=>{o(!0);const{id:t}=e,i=await re(t);i?n?.current&&(Ne.embed(i,n.current),o(!1)):C.error("pdf url resolution error")})(),()=>{n.current=null}),[e]),t.jsx(D,{isSpinning:r,children:t.jsx(l,{ref:i,sx:{display:"flex",flexWrap:"wrap",width:"100%","& .box":{display:"flex",flexDirection:"column",overflow:"hidden",position:"relative",width:"100%","& .react-resizable":{position:"relative"},"& .react-resizable-handle":{position:"absolute",width:"100%",height:"30px",backgroundRepeat:"no-repeat",backgroundOrigin:"content-box",boxSizing:"border-box"},"& .react-resizable-handle-s":{cursor:"ns-resize",bottom:0}}},children:t.jsx(we.Resizable,{className:"box",height:a,minConstraints:[i?.current?.offsetWidth||0,0],width:i.current?.offsetWidth||0,onResize:(e,{size:n})=>{s(n.height)},resizeHandles:["s"],children:t.jsx("div",{style:{width:"100%",height:`${a}px`},children:t.jsx("div",{ref:n,style:{height:"100%",width:"100%"}})})})})})}const ke=y(l)(()=>({"& > span":{padding:"0 9px 0 0"}}));function De(e){const n=(new Date).getTime(),{item:i,checkBox:r,handleSetSelectedInvoiceAccount:o,handleViewInvoice:a,setIsRequestLoading:s,setInvoiceId:d,handleOpenHistoryModal:y,selectedPay:b=[],handleGetCorrespondingCurrency:f,addBottom:g,isCurrentCompany:j,invoicePay:w}=e,C=v(),N=Q(),{id:I,status:S,dueDate:k,openBalance:D,companyInfo:B}=i,P=f(D.code||"USD");let T=i.status;0===S&&n>1e3*k&&(T=3);const F=[{key:"orderNumber",title:C("invoice.invoiceItemCardHeader.order"),render:()=>t.jsx(l,{role:"button",sx:{color:"#000000",cursor:"pointer",textDecoration:"underline"},onClick:()=>{N(`/orderDetail/${i.orderNumber}`)},children:i?.orderNumber||"-"})},{key:"createdAt",title:C("invoice.invoiceItemCardHeader.invoiceDate"),render:()=>`${i.createdAt?A(Number(i.createdAt)):"–"}`},{key:"updatedAt",title:C("invoice.invoiceItemCardHeader.dueDate"),render:()=>{const{dueDate:e,status:r}=i,o=n>1e3*e&&2!==r;return t.jsx(c,{sx:{color:o?"#D32F2F":"rgba(0, 0, 0, 0.87)",fontSize:"14px"},children:`${i.dueDate?A(Number(i.dueDate)):"–"}`})}},{key:"originalBalance",title:C("invoice.invoiceItemCardHeader.invoiceTotal"),render:()=>{const{originalBalance:e}=i,n=Number(e.value);return R(n||0)}},{key:"openBalance",title:C("invoice.invoiceItemCardHeader.amountDue"),render:()=>{const{openBalance:e}=i,n=Number(e.value);return R(n||0)}},{key:"openBalanceToPay",title:C("invoice.invoiceItemCardHeader.amountToPay"),render:()=>{const{openBalance:e,id:n}=i;let r=e.value,a=!0;if(b.length>0){const t=b.find(e=>{const{node:{id:t}}=e;return Number(t)===Number(n)});if(t){const{node:{openBalance:n}}=t;a=!1,r=n.value,0===Number(e.value)&&(a=!0)}}return t.jsx(m,{disabled:a,variant:"filled",value:r,InputProps:{startAdornment:t.jsx(x,{position:"start",sx:{padding:"8px 0",marginTop:"0 !important"},children:P||"$"})},sx:{"& input":{paddingTop:"8px"}},onChange:e=>{const t=e.target?.value;o(t,n)},type:"number"})}}],E=h.useId();return t.jsx(u,{role:"group","aria-labelledby":E,sx:{marginBottom:b.length>0&&g?"5rem":0},children:t.jsxs(p,{sx:{color:"rgba(0, 0, 0, 0.6)"},children:[t.jsxs(l,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsxs(l,{sx:{display:"flex",alignItems:"center",mb:"0.5rem"},children:[t.jsx(ke,{children:r&&r(!!i?.disableCurrentCheckbox)}),t.jsx(c,{variant:"h6",sx:{color:"rgba(0, 0, 0, 0.87)"},children:t.jsx(l,{id:E,role:"button",sx:{color:"#000000",cursor:"pointer",textDecoration:"underline"},onClick:()=>{a(I,S,B.companyId)},children:I||"-"})})]}),t.jsx(l,{sx:{mb:"0.5rem"},children:t.jsx(ae,{row:i,setInvoiceId:d,handleOpenHistoryModal:y,setIsRequestLoading:s,isCurrentCompany:j,invoicePay:w})})]}),t.jsx(l,{sx:{mb:"1rem"},children:t.jsx(le,{code:T})}),F.map(e=>t.jsxs(l,{sx:{display:"flex",alignItems:"center",mt:"4px"},children:[t.jsx(c,{sx:{fontWeight:"bold",color:"rgba(0, 0, 0, 0.87)",mr:"5px",whiteSpace:"nowrap"},children:`${e.title}:`}),t.jsx(l,{sx:{color:"black",wordBreak:"break-all"},children:e?.render?e.render():i[e.key]})]},e.key))]})})}const Be={q:"",first:10,offset:0,orderBy:`-${he[ye]}`,companyIds:[]}}}});
//# sourceMappingURL=index-legacy-BNSex6Vt.js.map
