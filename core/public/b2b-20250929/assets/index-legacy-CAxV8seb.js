System.register(["./mui-legacy-Co1sKVsS.js","./intl-legacy-f5dGU49Z.js","./react-setup-legacy-D2JRzxdF.js","./B3Filter-legacy-BmtmonFX.js","./load-functions-legacy-rxJ-MsEG.js","./useTableRef-legacy-Ct-N3MGx.js","./base-legacy-DAqmyLJs.js","./lodashEs-legacy-BTGS6uHg.js","./muiIcon-legacy-C-h6sDde.js","./form-legacy-LlvE08FY.js","./B3CustomForm-legacy-D2p9DUUp.js","./reactVendor-legacy-C5drotBr.js","./eCache-legacy-QcRlogRO.js","./redux-legacy-DH94TLLa.js","./toolkit-legacy-DO7GmFjE.js","../index-legacy.js","./global-legacy-vVqwfyov.js","./router-legacy-CQEMCAt4.js","./dropzone-legacy-B1uEXZk9.js","./dateFns-legacy-DHywh9DD.js","./B3FilterMore-legacy-BZwi3GoI.js","./B3FilterSearch-legacy-CpS4so5C.js"],function(e,a){"use strict";var n,t,s,r,l,o,i,d,c,u,m,p,f,y,g,h,I,b,x,N,C,R,j,S,v,w,E,B,P,q,$,k,F,D,T,U,L,M,O,V,z,A,_;return{setters:[e=>{n=e.j,t=e.w,s=e.G,r=e.z,l=e.A,o=e.ae,i=e.T,d=e.B,c=e.I},e=>{u=e.r},e=>{m=e.j,p=e.C,f=e.l,y=e.a,g=e.aa,h=e.ck,I=e.cl,b=e.u,x=e.B,N=e.aI,C=e.ai,R=e.ad,j=e.ak,S=e.I,v=e.ao,w=e.at,E=e.al,B=e.ah,P=e.a2,q=e.bI,$=e.af},e=>{k=e.B},null,e=>{F=e.u,D=e.a},e=>{T=e.b},e=>{U=e.g,L=e.e,M=e.l},e=>{O=e.D,V=e.E,z=e.f},e=>{A=e.u},e=>{_=e.B},null,null,null,null,null,null,null,null,null,null,null],execute:function(){e("default",function(){const[e,a]=u.useState(!1),[t,s]=u.useState(!1),[r,l]=u.useState(),o=m(),[i]=y(),c=F(),p=b(({b2bFeatures:e})=>e.masqueradeCompany.id),f=b(({company:e})=>e.customer.role),g=b(({company:e})=>e.companyInfo),h=Number(f)===B.SUPER_ADMIN?p:g?.id,I=b(P),{selectCompanyHierarchyId:x}=b(({company:e})=>e.companyHierarchyInfo),N=I.userCreateActionsPermission,C=u.useMemo(()=>{const{userCreateActionsPermission:e}=v,a=q(e,Number(x));return{isEnabled:N&&a,customLabel:o("userManagement.addUser")}},[N,x]),S=u.useRef(null),[w]=D(),E={first:12,offset:0,search:"",companyRoleId:"",companyId:h,q:""},T=Z(o),[U,L]=u.useState(E),[M,O]=u.useState(T),[V,z]=u.useState(""),A=()=>{w.current?.refresh()},_=e=>{S.current?.handleOpenAddEditUserClick({type:"edit",userId:e})},H=e=>{l(e),s(!0)},X=()=>{s(!1)};return u.useEffect(()=>{(()=>{const e=T.map(e=>{const a=e,n=e.options?.map(e=>(e.label=o(e.idLang),e));return a.options=n,a.setValueName=z,a.default=U.companyRoleId,a.defaultName=U.companyRoleId?V:"",e});O(e)})()},[U,U.companyRoleId]),n.jsx($,{isSpinning:e,children:n.jsxs(d,{sx:{display:"flex",flexDirection:"column",flex:1},children:[n.jsx(k,{filterMoreInfo:M,handleChange:(e,a)=>{const n={...U,q:a};L(n)},handleFilterChange:e=>{const a={...U,companyRoleId:e.companyRoleId,offset:0};L(a)},customButtonConfig:C,handleFilterCustomButtonClick:()=>{S.current?.handleOpenAddEditUserClick({type:"add"})}}),n.jsx(J,{ref:w,getRequestList:async e=>{const a=await oe(e),{users:{edges:n,totalCount:t}}=a;return{edges:n,totalCount:t}},searchParams:U||{},itemXs:c?3:4,requestLoading:a,renderItem:e=>n.jsx(de,{item:e,onEdit:_,onDelete:H},e.id)}),n.jsx(se,{companyId:`${x||h}`,renderList:A,ref:S}),n.jsx(R,{isOpen:t,title:o("userManagement.deleteUser"),leftSizeBtn:o("userManagement.cancel"),rightSizeBtn:o("userManagement.delete"),handleLeftClick:X,handRightClick:async e=>{if(e)try{a(!0),X(),await le({userId:e,companyId:x||h}),j.success(o("userManagement.deleteUserSuccessfully"))}finally{a(!1),A()}},row:r,rightStyleBtn:{color:"#D32F2F"},isShowBordered:!1,children:n.jsx(d,{sx:{display:"flex",width:i?"100%":"450px",height:"100%"},children:o("userManagement.confirmDelete")})})]})})});const a=t("div")(()=>({height:"100%",minHeight:"400px",backgroundColor:"#fff",display:"flex",justifyContent:"center",alignItems:"center",color:"#aaa",fontSize:"18px"})),H=t("span")(()=>({marginLeft:"10px"}));function X({isLoading:e}){const t=m();return n.jsxs(a,{children:[!e&&n.jsx(O,{fontSize:"large"}),n.jsx(H,{children:e?"":t("global.table.noData")})]})}const G=e=>"node"in e;function Y({listItems:e,pagination:a,onPaginationChange:t,rowsPerPageOptions:l,renderItem:o,isInfiniteScroll:i,isLoading:d,itemXs:c,showRowsPerPageOptions:h}){const{state:{portalStyle:{backgroundColor:I="#FEF9F5"}}}=u.useContext(p),b=f(I),[x]=y(),N=m(),{offset:C,count:R,first:j}=a,S=e=>{d||t(e)},v=(e,n)=>{S({...a,offset:n*j})},w=e=>{S({...a,offset:0,first:parseInt(e.target.value,10)||j})};return e.length>0?n.jsxs(n.Fragment,{children:[i&&n.jsxs(n.Fragment,{children:[n.jsx(s,{container:!0,spacing:2,children:e.map((e,a)=>{const t=G(e)?e.node:e;return n.jsx(s,{item:!0,xs:12,children:t&&o(t)},`${t.id+a}`)})}),n.jsx(r,{labelDisplayedRows:({from:e,to:a,count:n})=>N("global.pagination.pageXOfY",{from:e,to:a,count:n}),rowsPerPageOptions:h?l:[],labelRowsPerPage:N("global.pagination.perPage"),component:"div",sx:{color:x?g(b,.87):"rgba(0, 0, 0, 0.87)",marginTop:"1.5rem","::-webkit-scrollbar":{display:"none"},"& svg":{color:x?g(b,.87):"rgba(0, 0, 0, 0.87)"}},count:R,rowsPerPage:j,page:0===j?0:C/j,onPageChange:v,onRowsPerPageChange:w})]}),!i&&n.jsxs(n.Fragment,{children:[n.jsx(s,{container:!0,spacing:2,children:e.map((e,a)=>{const t=G(e)?e.node:e;return n.jsx(s,{item:!0,xs:c,children:t&&o&&o(t)},`${t.id+a}`)})}),n.jsx(r,{labelDisplayedRows:({from:e,to:a,count:n})=>N("global.pagination.pageXOfY",{from:e,to:a,count:n}),rowsPerPageOptions:h?l:[],labelRowsPerPage:N("global.pagination.cardsPerPage"),component:"div",sx:{color:b,marginTop:"1.5rem","::-webkit-scrollbar":{display:"none"},"& svg":{color:b}},count:R,rowsPerPage:j,page:0===j?0:C/j,onPageChange:v,onRowsPerPageChange:w})]})]}):n.jsx(X,{isLoading:d})}const J=h(I(function({renderItem:e,itemXs:a,getRequestList:t,searchParams:s,requestLoading:r,showRowsPerPageOptions:l=!0},o){const i=[12,24,36],d={offset:0,first:i[0]},{selectCompanyHierarchyId:c}=b(({company:e})=>e.companyHierarchyInfo),m=u.useRef(c),p=u.useRef(null),[f,g]=u.useState(!1),[h,I]=u.useState(d),[x,N]=u.useState(0),[C,R]=u.useState([]),[j,S]=u.useState([]),[v]=y(),w=u.useCallback(e=>{C.length||R(e);const a=[...C];e.forEach(e=>{const n=G(e)?e.node:e;C.some(e=>(G(e)?e.node:e).id===n.id)||a.push(e)}),R(a)},[C]),E=u.useCallback(async(e,a)=>{try{if(p?.current&&U(p.current,s)&&!a&&!e)return;p.current=s,g(!0),r&&r(!0);const{createdBy:n=""}=s,l=/^[^(]+/,o=/\((.+)\)/g.exec(n),i=l.exec(n),d=i?.length?i[0].trim():"",c={...{...s,createdBy:d,email:o?.length?o[1]:""},first:e?.first||h.first,offset:e?.offset||0},u=await t(c),{edges:m,totalCount:f}=u;S(m),w(m),e||I({first:h.first,offset:0}),N(f),g(!1),r&&r(!1)}catch(n){g(!1),r&&r(!1)}},[w,t,h.first,r,s]),B=u.useCallback(()=>{E(h,!0)},[E,h]);u.useEffect(()=>{const e=Number(m.current)!==Number(c);L(s)||(e?(E(h,!0),m.current=c):E())},[E,s,c,h]);const P={...h,count:x},q=u.useCallback(()=>j,[j]),$=u.useCallback(()=>C,[C]);return u.useImperativeHandle(o,()=>({setList:S,setCacheAllList:R,getList:q,getCacheList:$,refresh:B}),[q,$,B]),n.jsx(Y,{listItems:j,pagination:P,rowsPerPageOptions:i,onPaginationChange:async e=>{await E(e),I(e)},isInfiniteScroll:v,isLoading:f,renderItem:e,itemXs:a,showRowsPerPageOptions:l})})),K=e=>void 0!==e&&""!==e?Number(e):void 0,Q=e=>void 0!==e&&""!==e?Number(e):void 0,W=()=>[{label:"Admin",name:"Admin",value:0,idLang:"userManagement.userRole.admin"},{label:"Senior buyer",name:"Senior Buyer",value:1,idLang:"userManagement.userRole.seniorBuyer"},{label:"Junior buyer",name:"Junior Buyer",value:2,idLang:"userManagement.userRole.juniorBuyer"}],Z=e=>[{name:"companyRoleId",label:e("userManagement.config.userRole"),required:!1,default:"",defaultName:"",fieldType:"roleAutocomplete",xs:12,disabled:!1,variant:"filled",size:"small"}],ee={3:"global.emailValidate.multipleCustomer",4:"global.emailValidate.companyUsed",5:"global.emailValidate.alreadyExits",6:"global.emailValidate.usedSuperAdmin"},ae={0:"text",1:"multiline",2:"number",3:"dropdown"},ne=async()=>{let e=[];try{const{userExtraFields:a}=await x.graphqlB2B({query:"\n  query GetUserExtraFields {\n    userExtraFields {\n      fieldName\n      fieldType\n      isRequired\n      defaultValue\n      maximumLength\n      numberOfRows\n      maximumValue\n      listOfValue\n      visibleToEnduser\n      labelName\n    }\n  }\n"});e=(e=>e.map(e=>{const{listOfValue:a}=e,n=ae[e.fieldType],t={isExtraFields:!0,name:e.fieldName,label:e.labelName,required:e.isRequired,default:e.defaultValue||"",fieldType:n,xs:12,variant:"filled",size:"small"};switch(n){case"dropdown":if(a){const e=a?.map(e=>({label:e,value:e}));e.length>0&&(t.options=e)}break;case"number":t.max=e.maximumValue||"";break;case"multiline":t.rows=e.numberOfRows||"";break;default:t.maxLength=e.maximumLength||""}return t}))(a.filter(e=>e.visibleToEnduser))}catch(a){T.error(a)}return e},te=e=>void 0!==e&&""!==e?Number(e):void 0,se=u.forwardRef(function({companyId:e,renderList:a},t){const s=b(({company:e})=>e.customer.b2bId),[r,l]=u.useState(!1),[o,i]=u.useState(""),[d,c]=u.useState(),[p,f]=u.useState(!1),[y,g]=u.useState([]),[h,I]=u.useState([]),v=m(),{control:w,handleSubmit:E,getValues:B,formState:{errors:P},clearErrors:q,setValue:$,setError:k}=A({mode:"onSubmit"});u.useEffect(()=>{0===h.length&&(async()=>{const e=await ne();I(e)})()},[h.length]),u.useEffect(()=>{if(r){const e=y.map(e=>{const a=e;var n;return"edit"===o&&d&&$(e.name,(n=d,e.name in n?d[e.name]:void 0)),a});g(e)}},[d,r,o]);const F=()=>{y.forEach(e=>{$(e.name,""),e.isExtraFields&&$(e.name,e.default||"")}),q(),l(!1)},D=async a=>{const{userType:n,userInfo:{companyName:t}}=await(s={email:a,companyId:e,channelId:S},x.graphqlB2B({query:"\n  query UserEmailCheck ($email: String!, $companyId: Int, $storeHash: String!, $channelId: Int) {\n    userEmailCheck ( email: $email, companyId: $companyId, storeHash: $storeHash, channelId: $channelId ){\n      userType,\n      userInfo {\n        companyName\n      }\n    }\n  }\n",variables:{email:s.email,companyId:Q(s.companyId),channelId:Q(s.channelId),storeHash:N}}).then(e=>({...e.userEmailCheck,isValid:e.userEmailCheck.userType===C.DOES_NOT_EXIST})));var s;const r=[C.DOES_NOT_EXIST,C.B2C,C.CURRENT_B2B_COMPANY_DIFFERENT_CHANNEL].includes(n);return r||k("email",{type:"custom",message:v(ee[n],{companyName:t?`(${t})`:"",email:a})}),{isValid:r,userType:n}},T=async a=>{const{type:n}=a,t=((e,a,n=!1)=>{const t=Z(a);return t[0].required=!0,t[0].disabled=n,[...t,{name:"email",label:a("userManagement.config.email"),required:!0,fieldType:"text",xs:12,disabled:"edit"===e,default:"",variant:"filled",size:"small"},{name:"firstName",label:a("userManagement.config.firstName"),required:!0,default:"",fieldType:"text",xs:6,variant:"filled",size:"small"},{name:"lastName",label:a("userManagement.config.lastName"),required:!0,fieldType:"text",xs:6,default:"",variant:"filled",size:"small"},{name:"phone",label:a("userManagement.config.phoneNumber"),required:!1,fieldType:"text",xs:12,default:"",variant:"filled",size:"small"}]})(n,v,"edit"===n&&s===Number(a.userId));if("edit"===n){const{userId:n}=a,s=await(({userId:e,companyId:a})=>x.graphqlB2B({query:"\n  query GetUser($userId: Int!, $companyId: Int!) {\n    user ( userId: $userId companyId: $companyId ) { \n        firstName,\n        lastName,\n        email,\n        phone,\n        companyRoleId,\n        companyRoleName,\n        extraFields {\n          fieldName\n          fieldValue\n        }\n      }\n    }\n",variables:{userId:Number(e),companyId:Number(a)}}).then(({user:e})=>e))({userId:n,companyId:e}),r=s.extraFields||[];let l=s;if(r&&r.length>0){const e={};r.forEach(a=>{e[a.fieldName]=a.fieldValue}),l={...s,...e}}c({id:n,...l});const o=t.find(e=>"companyRoleId"===e.name)||null;o&&(o.defaultName=s?.companyRoleName||"",o.default=s?.companyRoleId||"")}const r=M(t,h);g(r),i(n),l(!0)};return u.useImperativeHandle(t,()=>({handleOpenAddEditUserClick:T})),n.jsx(R,{isOpen:r,title:v("edit"===o?"userManagement.editUser":"userManagement.addNewUser"),leftSizeBtn:v("userManagement.cancel"),rightSizeBtn:v("userManagement.saveUser"),handleLeftClick:F,handRightClick:()=>{E(async n=>{f(!0);const t=(e=>{const a=Object.keys(e),n=[];return h.forEach(t=>{if(a.includes(t.name)){const a={fieldName:t.name||"",fieldValue:e[t.name]||""};n.push(a)}}),n})(n);let s=v("userManagement.addUserSuccessfully");try{const r={companyId:e,companyRoleId:Number(n.companyRoleId),...n,extraFields:t};if("edit"!==o){const{isValid:e,userType:a}=await D(n.email);if(!e)return void f(!1);a===C.CURRENT_B2B_COMPANY_DIFFERENT_CHANNEL&&(r.addChannel=!0,s=v("userManagement.userDetected",{email:n.email})),await(e=>{const a={companyId:K(e.companyId),companyRoleId:K(e.companyRoleId),email:e.email,firstName:e.firstName,lastName:e.lastName,phone:e.phone,addChannel:e.addChannel,companyRoleName:e.companyRoleName,extraFields:e.extraFields};return x.graphqlB2B({query:"\n  mutation CreateUser ($userData: UserInputType!) {\n    userCreate ( userData: $userData ){\n      user {\n        id\n      }\n    }\n  }\n",variables:{userData:a}})})(r)}"edit"===o&&(r.userId=d?.id||"",s=v("userManagement.updateUserSuccessfully"),delete r.email,await(e=>{const a={userId:te(e.userId),companyId:te(e.companyId),companyRoleId:te(e.companyRoleId),email:e.email,firstName:e.firstName,lastName:e.lastName,phone:e.phone,addChannel:e.addChannel,companyRoleName:e.companyRoleName,extraFields:e.extraFields};return x.graphqlB2B({query:"\n  mutation UpdateUser ($userData: UserUpdateInputType!) {\n    userUpdate ( userData: $userData ) {\n      user {\n        id\n      }\n    }\n  }\n",variables:{userData:a}})})(r)),F(),j.success(s),a()}finally{f(!1)}})()},loading:p,isShowBordered:!0,children:n.jsx(_,{formFields:y,errors:P,control:w,getValues:B,setValue:$})})}),re=e=>void 0!==e&&""!==e?Number(e):void 0,le=e=>x.graphqlB2B({query:"\n  mutation DeleteUser ($companyId: Int!, $userId: Int!) { \n    userDelete ( companyId: $companyId, userId: $userId ) {\n      message\n    }\n  }\n",variables:{companyId:re(e.companyId),userId:re(e.userId)}}),oe=e=>x.graphqlB2B({query:"\n  query GetUsers($first: Int!, $offset: Int!, $q: String, $companyId: Int!, $companyRoleId: Decimal) {\n    users (\n      first: $first\n      search: $q\n      offset: $offset\n      companyId: $companyId\n      companyRoleId: $companyRoleId\n    ){\n      totalCount,\n      edges{\n        node{\n          id,\n          firstName,\n          lastName,\n          email,\n          companyRoleName,\n          companyInfo {\n            companyId,\n          },\n        }\n      }\n    }\n  }\n",variables:{...e,q:e.q||"",companyId:Number(e.companyId),companyRoleId:void 0!==e.companyRoleId&&""!==e.companyRoleId?Number(e.companyRoleId):void 0}}),ie=t("div")(()=>({display:"flex",alignItems:"center",justifyContent:"space-between"}));function de(e){const{item:a,onEdit:t,onDelete:s}=e,{companyInfo:r,id:u,companyRoleName:m,firstName:p,lastName:f,email:y}=a,{userUpdateActionsPermission:g,userDeleteActionsPermission:h}=v,I=w({code:g,companyId:Number(r?.companyId||0),userId:Number(u)}),b=w({code:h,companyId:Number(r?.companyId||0),userId:Number(u)});return n.jsx(l,{children:n.jsxs(o,{sx:{color:"#313440"},children:[n.jsxs(i,{variant:"h5",sx:{color:"rgba(0, 0, 0, 0.87)"},children:[p," ",f]}),n.jsx(i,{sx:{p:"15px 0"},variant:"body1",children:y}),n.jsxs(ie,{children:[(e=>{const a=W().map(e=>2===Number(e.value)?"Junior Buyer"!==m?{color:"#ce93d8",textColor:"black",...e,label:m,name:m}:{color:"#D9DCE9",textColor:"black",...e}:1===Number(e.value)?{color:"rgba(237, 108, 2, 0.3)",textColor:"black",...e}:{color:"#C4DD6C",textColor:"black",...e}).find(a=>a.name===e);return a?n.jsx(E,{color:a.color,textColor:a.textColor,children:a.label}):null})(m),n.jsxs(d,{children:[I&&n.jsx(c,{"aria-label":"edit",size:"small",sx:{marginRight:"8px"},onClick:()=>t(a.id),children:n.jsx(V,{fontSize:"inherit"})}),b&&n.jsx(c,{"aria-label":"delete",size:"small",onClick:()=>s(a.id),children:n.jsx(z,{fontSize:"inherit"})})]})]})]})},u)}}}});
//# sourceMappingURL=index-legacy-CAxV8seb.js.map
