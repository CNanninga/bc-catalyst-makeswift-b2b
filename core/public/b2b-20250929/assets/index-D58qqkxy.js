import{j as c,B,a7 as pe,w as he,a1 as ge}from"./mui-DjJKBaL-.js";import{r as b}from"./intl-D34a3Rgg.js";import{u as xe}from"./form-pKe_k4Gy.js";import{e as be}from"./lodashEs-CONzB2I0.js";import{B as ye}from"./B3Card-OgBqR3vH.js";import{B as T}from"./B3CustomForm-B2g91-rz.js";import{j as Fe,a as Ce,G as Be,u as we,bW as Ee,C as Le,l as je,af as Ae,ag as Se,aj as Ie,an as Re,M as Te,bT as Me,I as Ne,bY as ve,aI as Ve}from"./react-setup-B5wPcSA9.js";import"./load-functions-DCmK5p8C.js";import{b as j}from"./base-CC7kTJh2.js";import{l as Ue}from"./b3Login-lPEy7w6j.js";import{c as ke,g as qe,d as y,h as De,a as ze,B as Pe,t as He}from"./config-Ck1e_eKM.js";import{a as Oe,b as We,R as _e,c as Ge,T as Je,I as M}from"./RegisteredFinish-D_ib3doZ.js";import{a as Ye}from"./router-DcuTQ_yx.js";import"./reactVendor-CkUTLE5B.js";import"./eCache-97HTO8co.js";import"./muiIcon-BBtg8u0V.js";import"./redux-Bt5-tVzx.js";import"./toolkit-CpEbzTSY.js";import"../index.js";import"./global-D7Yn0gGb.js";import"./dropzone-B1UJxEDf.js";import"./dateFns-DubixNBV.js";import"./validatorRules-Cki_nfBC.js";const $e=he(B)({"& #b3-customForm-id-name":{'& label[data-shrink="true"]':{whiteSpace:"break-spaces",minWidth:"calc(133% - 24px)",transition:"unset"},'& label[data-shrink="false"]':{whiteSpace:"break-spaces"}}});function yt(W){var P,H,O;const[N,w]=b.useState(""),[v,_]=b.useState(!1),{setOpenPage:G}=W,F=Fe(),[V]=Ce(),{control:A,handleSubmit:J,getValues:C,formState:{errors:S},setValue:E,setError:L,watch:Y}=xe({mode:"onSubmit"}),{state:{logo:U,blockPendingAccountOrderCreation:$,registerEnabled:k}}=b.useContext(Be),I=Ye(),K=we(({company:i})=>i.customer),{id:Q,firstName:X,lastName:Z,emailAddress:q,phoneNumber:ee}=K,{state:te,dispatch:p}=b.useContext(Ee),{state:{companyAutoApproval:D,portalStyle:{backgroundColor:se="#FEF9F5"}}}=b.useContext(Le),ae=je(se),x=(i=!1)=>{p({type:"loading",payload:{isLoading:i}})};b.useEffect(()=>{x(!1),k||I("/login")},[k]),b.useEffect(()=>{(async()=>{try{p&&(x(!0),p({type:"finishInfo",payload:{submitSuccess:!1}}));const l=await Ie(3),o=((l==null?void 0:l.accountFormFields)||[]).map(e=>{const t=e;return ke.includes((e==null?void 0:e.fieldId)||"")&&e.groupId===4&&(t.isRequired=!0,t.visible=!0),e}),s=qe(o||[]),{countries:a}=await Re(),r=s.address.map(e=>{const t=e;return e.name==="country"&&(t.options=a,t.replaceOptions={label:"countryName",value:"countryName"}),e}),n={phone:ee,first_name:X,last_name:Z,email:q},d=s.contactInformation.map(e=>{const t=e;return t.disabled=!0,t.default=n[y(e.name)]||e.default,e.required&&!(e!=null&&e.default)&&(t.disabled=!1),e});p&&p({type:"all",payload:{isLoading:!1,bcTob2bContactInformation:[...d],bcTob2bCompanyExtraFields:[],bcTob2bCompanyInformation:[...s.businessDetails],bcTob2bAddressBasicFields:[...r],countryList:[...a]}})}catch(l){j.error(l)}})()},[]);const{bcTob2bContactInformation:m,isLoading:re,bcTob2bCompanyInformation:h=[],bcTob2bAddressBasicFields:g=[],countryList:z=[],bcTob2bCompanyExtraFields:oe=[]}=te;b.useEffect(()=>{const i=(s,a="")=>{var d;const r=((d=z.find(e=>e.countryCode===s||e.countryName===s))==null?void 0:d.states)||[],n=g.find(e=>e.name==="state");n&&(r.length>0?(n.fieldType="dropdown",n.options=r,n.required=!0):(n.fieldType="text",n.options=[],n.required=!1)),E("state",a&&s&&(r.find(e=>e.stateCode===a)||r.length===0)?a:""),p({type:"stateList",payload:{stateList:r,bcTob2bAddressBasicFields:[...g]}})};(()=>{const s=C("country"),a=C("state");i(s,a)})();const o=Y((s,{name:a,type:r})=>{const{country:n,state:d}=s;a==="country"&&r==="change"&&i(n,d)});return()=>o.unsubscribe()},[z]);const ne=async(i,l)=>{let o=[];if(i.length){i.forEach(s=>{o=l[s.name]||[]});try{return(await Promise.all(o.map(r=>Me({file:r,type:"companyAttachedFile"})))).reduce((r,n)=>{let d=r;if(n.code===200){const e={...n.data};e.fileSize=e.fileSize?"".concat(e.fileSize):"",d=[...r,e]}else throw n.data.errMsg||n.message||F("intl.global.fileUpload.fileUploadFailure");return d},[])}catch(s){throw j.error(s),s}}},ie=async(i,l,o,s)=>{const a={};a.customerId=l||"",a.storeHash=Ve,a.userExtraFields=s;const r=h.filter(t=>!t.custom&&t.fieldType!=="files"),n=h.filter(t=>!!t.custom);if(r.length&&r.forEach(t=>{a[He(y(t.name))]=i[t.name]||""}),n.length){const t=[];n.forEach(f=>{const u={};u.fieldName=y(f.name),u.fieldValue=i[f.name]||"",t.push(u)}),a.extraFields=t}const d=g.filter(t=>!t.custom),e=g.filter(t=>!!t.custom);if(d.length&&d.forEach(t=>{const f=y(t.name);f==="address1"&&(a.addressLine1=i[t.name]||""),f==="address2"&&(a.addressLine2=i[t.name]||""),a[f]=i[t.name]||""}),e.length){const t=[];e.forEach(f=>{const u={};u.fieldName=y(f.name),u.fieldValue=i[f.name]||"",t.push(u)}),a.addressExtraFields=t}return a.fileList=o,a.channelId=Ne,ve(a)},le=async i=>{var l;try{const o=h.filter(r=>!!r.custom),s=o.map(r=>({fieldName:y(r.name),fieldValue:i[r.name]||r.default})),a=await De({extraFields:s});if(a.code!==200){const r=((l=a.data)==null?void 0:l.errMsg)||a.message||"",n=r.split(":");if(n.length>=2){const d=o.find(e=>y(e.name)===n[0]);if(d)return L(d.name,{type:"manual",message:n[1]}),x(!1),!1}throw r}return w(""),!0}catch(o){throw j.error(o),o}},ce=()=>{var o;const i=C(),l=h.find(s=>s.fieldId==="field_attachments");return!be(l)&&l.required&&i[l.name].length===0?(L(l.name,{type:"required",message:F("global.validate.required",{label:(o=l.label)!=null?o:""})}),x(!1),!0):!1},de=i=>{if(m){const l=m.map(o=>o.name===i?{...o,disabled:!1}:o);p&&p({type:"all",payload:{bcTob2bContactInformation:[...l]}})}},ue=async i=>{var l;try{const o=await ze({extraFields:i});if(o.code!==200){const s=((l=o.data)==null?void 0:l.errMsg)||o.message||"",a=s.split(":");if(a.length>=2){const r=m==null?void 0:m.find(n=>n.custom&&Pe.decode(n.name)===a[0]);if(r)return L(r.name,{type:"manual",message:a[1]}),de(r.name),x(!1),!1}return w(s),x(!1),!1}return w(""),!0}catch(o){return!1}},me=i=>{const l=ce();J(async o=>{if(!l){x(!0);try{if(!await le(o))return;const r=(m||[]).filter(u=>!!u.custom),n=[];r.length&&r.forEach(u=>{const R={};R.fieldName=y(u.name),R.fieldValue=o[u.name]||(u==null?void 0:u.default)||"",n.push(R)});let d=!0;if(n.length>0&&(d=await ue(n)),!d)return;const e=h.filter(u=>u.fieldType==="files"),t=await ne(e||[],o);await ie(o,Q,t,n);const f=D.enabled;q&&(p({type:"finishInfo",payload:{submitSuccess:!0,isAutoApproval:f,blockPendingAccountOrderCreation:$}}),p({type:"all",payload:{accountType:"1"}}),await Te(),_(!0))}catch(s){j.error(s),w((s==null?void 0:s.message)||s)}finally{x(!1)}}})(i)},fe=()=>{Ue(I,!0)&&(D.enabled?I("/orders"):window.location.href="/")};return c.jsx(ye,{setOpenPage:G,children:c.jsx(Oe,{isMobile:V,children:c.jsx(Ae,{isSpinning:re,tip:F("global.tips.loading"),transparency:"0",children:c.jsxs(B,{sx:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center","& h4":{color:ae},"& input, & .MuiFormControl-root .MuiTextField-root, & .MuiDropzoneArea-textContainer, & .MuiSelect-select.MuiSelect-filled, & .MuiTextField-root .MuiInputBase-multiline":{borderRadius:"4px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"}},children:[U&&c.jsx(We,{children:c.jsx(pe,{sx:{maxWidth:"250px"},onClick:()=>{window.location.href="/"},children:c.jsx("img",{src:U,alt:F("global.tips.registerLogo"),loading:"lazy"})})}),v?c.jsx(_e,{handleFinish:fe,isBCToB2B:!0}):c.jsxs($e,{sx:{width:V?"100%":"537px",boxShadow:"0px 2px 1px -1px rgba(0, 0, 0, 0.2), 0px 1px 1px rgba(0, 0, 0, 0.14), 0px 1px 3px rgba(0, 0, 0, 0.12)",borderRadius:"4px",marginTop:"1rem",background:"#FFFFFF",padding:"0 0.8rem 1rem 0.8rem"},children:[c.jsx(Ge,{children:F("registeredbctob2b.title")}),N&&c.jsx(ge,{severity:"error",children:c.jsx(Je,{children:N})}),c.jsxs(B,{sx:{width:"100%"},children:[c.jsx(M,{children:m!=null&&m.length?(P=m[0])==null?void 0:P.groupName:""}),c.jsx(T,{formFields:m||[],errors:S,control:A,getValues:C,setValue:E})]}),c.jsxs(B,{sx:{width:"100%"},children:[c.jsx(M,{children:h!=null&&h.length?(H=h[0])==null?void 0:H.groupName:""}),c.jsx(T,{formFields:[...h,...oe],errors:S,control:A,getValues:C,setValue:E,setError:L})]}),c.jsxs(B,{sx:{width:"100%"},children:[c.jsx(M,{children:g!=null&&g.length?(O=g[0])==null?void 0:O.groupName:""}),c.jsx(T,{formFields:g,errors:S,control:A,getValues:C,setValue:E})]}),!v&&c.jsx(B,{sx:{display:"flex",flexDirection:"row-reverse",pt:2,width:"100%"},children:c.jsx(Se,{variant:"contained",onClick:me,children:F("global.button.submit")})})]})]})})})})}export{yt as default};
//# sourceMappingURL=index-D58qqkxy.js.map
