System.register(["./mui-legacy-Co1sKVsS.js","./intl-legacy-f5dGU49Z.js","./form-legacy-LlvE08FY.js","./react-setup-legacy-D2JRzxdF.js","./B3CustomForm-legacy-D2p9DUUp.js","./load-functions-legacy-rxJ-MsEG.js","./useBlockPendingAccountViewPrice-legacy-BE4CQ8Q4.js","./base-legacy-DAqmyLJs.js","./lodashEs-legacy-BTGS6uHg.js","./ShoppingListDetailsContext-legacy-BKcItF2D.js","./muiIcon-legacy-C-h6sDde.js"],function(t,e){"use strict";var n,i,s,a,o,r,l,c,d,u,p,h,g,f,x,y,m,b,k,S,j,v,L,I,C,O,w,_,q,A,P,T,E,V,B,D,N,$,W;return{setters:[t=>{n=t.j,i=t.B,s=t.G,a=t.T,o=t.w,r=t.ah,l=t.b,c=t.ag},t=>{d=t.r},t=>{u=t.u},t=>{p=t.j,h=t.u,g=t.c4,f=t.c8,x=t.af,y=t.ag,m=t.bo,b=t.ak,k=t.aO,S=t.bD,j=t.c9,v=t.bp,L=t.bq,I=t.ad,C=t.aN,O=t.ay,w=t.ba,_=t.br,q=t.bm,A=t.bs,P=t.a,T=t.aS,E=t.bb},t=>{V=t.B},null,t=>{B=t.u},t=>{D=t.b},t=>{N=t.g},t=>{$=t.S},t=>{W=t.k}],execute:function(){t({C:U,Q:function(t){const e=p(),{updateList:o,quickAddToList:r,level:l=3,buttonText:c=e("shoppingList.quickAdd.addToShoppingList"),buttonLoading:S=!1,type:j}=t,v=h(({company:t})=>t.companyInfo.status),L=h(({quoteInfo:t})=>t.draftQuoteList),[I]=B(),[C,O]=d.useState(l),[w,_]=d.useState([]),[q,A]=d.useState(!1),P=(t,e)=>{new Array(t).fill(1).forEach((t,n)=>e(n))};d.useEffect(()=>{let t=[];P(C,n=>{t=[...t,...m(n,e)]}),_(t)},[C]);const{control:T,handleSubmit:E,getValues:D,formState:{errors:N},setError:$,setValue:W}=u({mode:"all"}),F=t=>{const n={};let i=!0;return P(C,s=>{const a=t[`sku-${s}`],o=t[`qty-${s}`];if(i=!1!==((t,n,i)=>{if(!n&&!i)return!0;let s=!0;const a=parseInt(i,10)||0;return n||($(`sku-${t}`,{type:"manual",message:e("global.validate.required",{label:e("purchasedProducts.quickAdd.sku")})}),s=!1),i?a<=0&&($(`qty-${t}`,{type:"manual",message:"incorrect number"}),s=!1):($(`qty-${t}`,{type:"manual",message:e("global.validate.required",{label:e("purchasedProducts.quickAdd.qty")})}),s=!1),s})(s,a,o)&&i,i&&a){const t=parseInt(o,10)||0;n[a]=n[a]?n[a]+t:t}}),{skuValue:n,isValid:i,skus:Object.keys(n)}},z=d.useCallback((t,e,n)=>{const i=[],s=[],a=[],o=[],r=[],l=[];return n.forEach(n=>{const c=(t||[]).find(t=>t.variantSku.toUpperCase()===n.toUpperCase());if(!c)return void i.push(n);const{productId:d,variantId:u,option:p,purchasingDisabled:h="1",modifiers:x,variantSku:y}=c,m=g(x),b=e[n]||0;if("1"===h&&"shoppingList"!==j)return void s.push(n);if(m.filter(t=>!t.isVerified).length>0)return void r.push(n);if(Number(b)<1||Number(b)>1e6)return void l.push(n);const k=(p||[]).reduce((t,e)=>{try{const n="string"==typeof e?JSON.parse(e):e;return t.push({optionId:`attribute[${n.option_id}]`,optionValue:`${n.id}`}),t}catch(n){return t}},[]);m.forEach(t=>{const{type:e}=t;if("date"===e){const{defaultValue:e}=t;Object.keys(e).forEach(e=>{k.push({optionId:`attribute[${t.option_id}][${e}]`,optionValue:`${t.defaultValue[e]}`})})}else k.push({optionId:`attribute[${t.option_id}]`,optionValue:`${t.defaultValue}`})}),o.push(n);const S=L.find(t=>t.node.variantSku===y);if(S){const t=JSON.parse(S.node.optionList);let{quantity:e}=S.node;if((t.length>k.length?f(t,k):f(k,t))&&(e+=b),e>1e6)return void l.push(n)}a.push({...c,newSelectOptionList:k,productId:parseInt(d,10)||0,quantity:b,variantId:parseInt(u,10)||0})}),{notFoundSku:i,notPurchaseSku:s,productItems:a,passSku:o,notAddAble:r,numberLimit:l}},[L,j]),Q=(t,e,n,i)=>{e.forEach(e=>{const s=Object.keys(t).find(n=>t[n]===e)||"";s&&$(s.replace("sku",n),{type:"manual",message:i})})},G=()=>{I&&0===v?b.info("Your business account is pending approval. This feature is currently disabled."):E(async t=>{try{A(!0);const{skuValue:n,isValid:i,skus:s}=F(t);if(!i||s.length<=0)return;const a=await(async t=>{try{const{variantSku:e}=await k(t);return e}catch(e){return[]}})(s),{notFoundSku:l,notPurchaseSku:c,productItems:d,notAddAble:u,passSku:p,numberLimit:h}=z(a,n,s);l.length>0&&(Q(t,l,"sku",""),b.error(e("shoppingList.quickAdd.skuNotFound",{notFoundSku:l.join(", ")}))),c.length>0&&(Q(t,c,"sku",""),b.error(e("shoppingList.quickAdd.skuNotPurchasable",{notPurchaseSku:c.join(", ")}))),u.length>0&&(Q(t,u,"sku",""),b.error(e("shoppingList.quickAdd.skuNotAddable",{notAddAble:u.join(", ")}))),h.length>0&&(h.forEach(e=>{Q(t,[e],"qty","")}),b.error(e("shoppingList.quickAdd.skuLimitQuantity",{numberLimit:h.join(", ")}))),d.length>0&&(await r(d),((t,e)=>{e.forEach(e=>{const n=Object.keys(t).find(n=>t[n]===e)||"";n&&(W(n,""),W(n.replace("sku","qty"),""))})})(t,p),o())}finally{A(!1)}})()};return n.jsx(x,{isSpinning:q,spinningHeight:"auto",children:n.jsxs(i,{sx:{width:"100%"},children:[n.jsxs(s,{container:!0,sx:{margin:"16px 0"},children:[n.jsx(s,{item:!0,sx:{flex:1,display:"flex",alignItems:"center"},children:n.jsx(a,{sx:{color:"#000"},variant:"body1",children:e("shoppingList.quickAdd.quickAdd")})}),n.jsx(s,{item:!0,children:n.jsx(y,{variant:"text",sx:{textTransform:"initial",ml:"-8px",fontWeight:"400"},onClick:()=>{O(C+l)},children:e("shoppingList.quickAdd.showMoreRows")})})]}),n.jsx(i,{onKeyDown:t=>{"Enter"===t.key&&G()},sx:{"& label":{zIndex:0}},children:n.jsx(V,{formFields:w,errors:N,control:T,getValues:D,setValue:W})}),n.jsx(y,{variant:"outlined",fullWidth:!0,disabled:q,onClick:G,sx:{margin:"20px 0"},children:n.jsx(x,{isSpinning:!!S&&q,tip:"",size:16,children:n.jsx(i,{sx:{flex:1,textAlign:"center"},children:c})})})]})})},S:function({updateList:t=()=>{},addToList:e,searchDialogTitle:s,addButtonText:o,type:r}){const u=p(),g=h(({company:t})=>t.companyInfo.id),f=h(t=>t.company.customer.customerGroupId),m=h(({company:t})=>t.companyInfo.status),k=h(({b2bFeatures:t})=>t.masqueradeCompany.id),S=g||k,[j,v]=d.useState(!1),[L,I]=d.useState(!1),[C,O]=d.useState(!1),[_,A]=d.useState(""),[P,T]=d.useState([]),[V,D]=d.useState(!1),[N,$]=d.useState(),[F]=B(),z=t=>{A(t.target.value)},Q=async()=>{if(_&&!j)if(F&&0===m)b.info(u("global.searchProductAddProduct.businessAccountPendingApproval"));else{v(!0);try{const{productsSearch:t}=await w({search:_,companyId:S,customerGroupId:f,categoryFilter:!0}),e=E(t);T(e),I(!0)}finally{v(!1)}}},G=()=>{Q()},K=async n=>{try{v(!0),await q(n),await e(n),t()}finally{v(!1)}};return n.jsxs(i,{sx:{margin:"24px 0"},children:[n.jsx(a,{children:u("global.searchProductAddProduct.searchBySkuOrName")}),n.jsx(l,{hiddenLabel:!0,placeholder:u(`global.searchProduct.placeholder.${r}`),variant:"filled",fullWidth:!0,size:"small",value:_,onChange:z,onKeyDown:t=>{"Enter"===t.key&&Q()},InputProps:{startAdornment:n.jsx(c,{position:"start",children:n.jsx(W,{})})},sx:{margin:"12px 0","& input":{padding:"12px 12px 12px 0"}}}),n.jsx(y,{variant:"outlined",fullWidth:!0,disabled:j,onClick:G,children:n.jsx(x,{isSpinning:j,tip:"",size:16,children:n.jsx(i,{sx:{flex:1,textAlign:"center"},children:u("global.searchProductAddProduct.searchProduct")})})}),n.jsx(H,{isOpen:L,isLoading:j,productList:P,searchText:_,type:r,onSearchTextChange:z,onSearch:G,onCancel:()=>{D(!1),I(!1),C&&(O(!1),t()),T([])},onProductQuantityChange:(t,e)=>{const n=P.find(e=>e.id===t);n&&(n.quantity=e),T([...P])},onChooseOptionsClick:t=>{const e=P.find(e=>e.id===t);e&&$({...e}),I(!1),D(!0)},onAddToListClick:async t=>{await K(t)},searchDialogTitle:s,addButtonText:o}),n.jsx(U,{isOpen:V,isLoading:j,type:r,setIsLoading:v,product:N,onCancel:()=>{D(!1),I(!0)},onConfirm:async t=>{try{v(!0),await q(t),await K(t),D(!1),I(!0)}catch(e){v(!1)}finally{v(!1)}},addButtonText:o})]})}});const e=o("div")({display:"flex",wordBreak:"break-word",gap:"8px",flexWrap:"wrap",padding:"12px 0 12px","&:first-of-type":{marginTop:"12px"}}),F=o("div")(({padding:t})=>({display:"flex",flexGrow:1,flexShrink:1,alignItems:"flex-start",width:"100%",padding:t||"0 0 0 16px"})),z=o("img")(()=>({width:"60px",height:"60px",borderRadius:"4px",marginTop:"12px",flexShrink:0})),Q=o("div")(()=>({fontSize:"0.75rem",lineHeight:"1.5",color:"#455A64"})),G=o(l)(()=>({"& input::-webkit-outer-spin-button, input::-webkit-inner-spin-button":{marginTop:"-8px",marginBottom:"8px"}}));function U(t){const{isOpen:s,onCancel:o,onConfirm:l,product:c,isEdit:g=!1,isLoading:f,setIsLoading:y,type:m,...k}=t,P=p(),{addButtonText:T=P("shoppingList.chooseOptionsDialog.addToList")}=k,E=h(({global:t})=>t.showInclusiveTaxPrice),B=h(({global:t})=>t.blockPendingQuoteNonPurchasableOOS.isEnableProduct),$=h(({b2bFeatures:t})=>t.masqueradeCompany.id),W=h(t=>t.company.customer.customerGroupId),U=h(t=>t.company.companyInfo.id),[K,R]=d.useState(1),[H,J]=d.useState([]),[M,Y]=d.useState(null),[X,Z]=d.useState(""),[tt,et]=d.useState(c?.imageUrl||""),[nt,it]=d.useState(!0),[st,at]=d.useState({}),[ot,rt]=d.useState([]),[lt,ct]=d.useState(0),[dt,ut]=d.useState([]),[pt,ht]=d.useState(!1);d.useEffect(()=>{if("quote"===m&&c)if(X){const t=c;t.quantity=K;const e=!!S(t.base_price,t,{sku:X});it(e)}else{const t=c;t.quantity=K,j(t.base_price,t)||it(!1)}else"shoppingList"!==m&&"quickOrder"!==m||!c||it(!c?.isPriceHidden)},[X,K,c,m]),d.useEffect(()=>{c?((async t=>{try{y(!0);const e=t?.modifiers?.filter(t=>"product_list_with_images"===t.type||"product_list"===t.type)||[],n={},i={};if(e.length>0){const t=e.reduce((t,e)=>{const{option_values:n}=e;return n.forEach(e=>{e?.value_data?.product_id&&t.push(e.value_data.product_id)}),t},[]);if(t.length>0){const e=U||$,{productsSearch:s}=await w({productIds:t,companyId:e,customerGroupId:W});s.forEach(t=>{n[t.id]=t.imageUrl,i[t.id]=t})}}at(i),R(t.quantity),1===t.variants?.length&&t.variants[0]&&Y(t.variants[0]);const s=_(t,n);J([...s])}finally{y(!1)}})(c),ut([]),ct(0),c?.allOptions?.length&&(t=>{const e=[];t.allOptions?.forEach(t=>{"product_list_with_images"!==t.type&&"product_list"!==t.type&&"checkbox"!==t.type&&"rectangles"!==t.type&&"swatch"!==t.type&&"radio_buttons"!==t.type&&"dropdown"!==t.type||e.push(t)}),rt(e)})(c)):(R(1),J([]))},[c]);const{control:gt,handleSubmit:ft,getValues:xt,formState:{errors:yt},watch:mt,setValue:bt,reset:kt}=u({mode:"all"}),St=mt(),jt=d.useRef(St),vt=d.useCallback(async(t,e="")=>{if(!H.find(t=>t.name===e)?.isVariantOption||!c||!e)return;const{variants:n=[]}=c||{},i=n.find(e=>{const{option_values:n=[]}=e;return n.reduce((e,n)=>t[v.encode(`attribute[${n.option_id}]`)].toString()===(n.id||"").toString()&&e,!0)})||null;if(Z(i?i.sku:""),Y(i),i&&(i.sku||i.variant_id)){const t=n.find(t=>t.sku===i.sku||t.variant_id===i.variant_id);et(t?.image_url||c.imageUrl||"")}},[H,c]);d.useEffect(()=>{const t=mt((t,{name:e})=>{vt(t,e)});if(H[0]){const t=H.reduce((t,e)=>(t[e.name]=e.default,bt(e.name,e.default),t),{});vt(t,H[0].name)}return()=>t.unsubscribe()},[H,vt]);const Lt=d.useCallback(()=>{const{purchasing_disabled:t=!0}=M||{};return!("shoppingList"!==m&&!0===t&&!B&&(b.error(P("shoppingList.chooseOptionsDialog.productNoLongerForSale")),1))},[B,m,M]),It=d.useCallback(t=>{const e=L(H,{},t);return Object.keys(e).map(t=>({optionId:t,optionValue:e[t]?.toString()}))},[H]);return d.useEffect(()=>{if((!jt?.current||!N(jt?.current,St))&&(jt.current=St,Object.keys(St).length&&H.length&&ot.length)){const t=It(St),{variant_id:e=""}=M||{};if(!(c&&c.id&&e&&Lt()))return;const n=[{...c,newSelectOptionList:t,productId:c?.id,quantity:parseInt(K.toString(),10)||1,variantId:parseInt(e.toString(),10)||1,additionalProducts:st}];if(dt[0]){let e=!1;const{newSelectOptionList:i}=dt[0];i.forEach(n=>{const i=ot.findIndex(t=>n.optionId.includes(String(t.id)));t.forEach(t=>{n.optionId===t.optionId&&n.optionValue!==t.optionValue&&-1!==i&&(e=!0)})}),e&&ut(n)}else ut(n)}},[st,dt,H.length,St,It,c,ot,K,Lt,M]),d.useEffect(()=>{(async()=>{try{if(dt.length){ht(!0);const t=await q(dt);if(t[0]){const{basePrice:e,taxPrice:n}=t[0],i=A(Number(e),Number(n));ct(i)}}}catch(t){D.error(t)}finally{ht(!1)}})()},[dt]),d.useEffect(()=>{s||kt()},[s]),n.jsx(I,{isOpen:s,rightSizeBtn:g?P("shoppingList.chooseOptionsDialog.saveOption"):T,handleLeftClick:()=>{R(1),o()},handRightClick:()=>{ft(t=>{const e=It(t),{variant_id:n=""}=M||{};c&&c.id&&n&&Lt()&&l([{...c,newSelectOptionList:e,productId:c?.id,quantity:parseInt(K.toString(),10)||1,variantId:parseInt(n.toString(),10)||1,additionalProducts:st}])})()},title:P("shoppingList.chooseOptionsDialog.chooseOptions"),loading:f||pt,children:n.jsx(x,{isSpinning:f,children:c&&n.jsx(i,{children:n.jsxs(i,{sx:{display:"flex",flexDirection:"column"},children:[n.jsxs(i,{sx:{display:"flex"},children:[n.jsx(z,{src:tt||c.imageUrl||C}),n.jsxs(e,{children:[n.jsx(F,{padding:"0",children:n.jsxs(i,{sx:{marginLeft:"16px"},children:[n.jsx(a,{variant:"body1",color:"#212121",children:c.name}),n.jsx(a,{variant:"body1",color:"#616161",children:X||c.sku}),(c.product_options||[]).map(t=>n.jsx(Q,{children:`${t.display_name}: ${t.display_value}`},`${t.option_id}`))]})}),n.jsxs(F,{children:[n.jsx("span",{children:P("shoppingList.chooseOptionsDialog.price")}),nt?O(lt*Number(K)||(t=>{const{variants:e=[]}=t;let n=0;if(X){const t=e.find(t=>t.sku===X)?.bc_calculated_price;n=(E?t?.tax_inclusive:t?.tax_exclusive)||0}else{const t=e[0]?.bc_calculated_price;n=parseFloat((E?t?.tax_inclusive:t?.tax_exclusive)?.toString())||0}return n})(c)):""]}),n.jsx(F,{children:n.jsx(G,{type:"number",variant:"filled",label:P("shoppingList.chooseOptionsDialog.quantity"),value:K,onChange:t=>{(!t.target.value||parseInt(t.target.value,10)>0)&&R(t.target.value)},onKeyDown:t=>{["KeyE","Equal","Minus"].indexOf(t.code)>-1&&t.preventDefault()},onBlur:()=>{K||R(1),Number(K)>1e6&&R(1e6)},size:"small",sx:{width:"60%",maxWidth:"100px"}})})]})]}),n.jsx(r,{sx:{margin:"16px 0 24px"}}),n.jsx(V,{formFields:H,errors:yt,control:gt,getValues:xt,setValue:bt})]})})})})}function K(t){const{product:{id:e,allOptions:i},onAddToListClick:s,onChooseOptionsClick:a,addButtonText:o}=t,{state:{isLoading:r=!1}}=d.useContext($),[l]=P(),c=p();return i&&i.length>0?n.jsx(y,{variant:"outlined",onClick:()=>{a(e)},disabled:r,fullWidth:l,children:c("global.searchProduct.chooseOptionsButton")}):n.jsx(y,{variant:"outlined",onClick:()=>{s(e)},disabled:r,fullWidth:l,children:o})}const R=T;function H(t){const e=p(),{isOpen:s,onCancel:o,searchText:r,productList:u,onSearchTextChange:g,onSearch:f,onProductQuantityChange:y,onAddToListClick:m,onChooseOptionsClick:k,isLoading:S,type:j,searchDialogTitle:v=e("shoppingLists.title"),addButtonText:L=e("shoppingLists.addButtonText")}=t,C=h(({global:t})=>t.blockPendingQuoteNonPurchasableOOS.isEnableProduct),[O]=P(),w=d.useCallback(t=>{const{variants:n=[]}=t||{},{purchasing_disabled:i=!0}=n[0]||{};return!("shoppingList"!==j&&!0===i&&!C&&(b.error(e("shoppingList.chooseOptionsDialog.productNoLongerForSale")),1))},[C,j]),_=t=>{const e=u.find(e=>e.id===t);if(e&&w(e||{})){let t=e.variantId||0;!e.variantId&&e.variants?.[0]&&(t=e.variants[0].variant_id),m([{...e,newSelectOptionList:[],quantity:parseInt(e.quantity.toString(),10)||1,variantId:t}])}};return n.jsx(I,{fullWidth:!0,isOpen:s,handleLeftClick:()=>{o()},title:v,showRightBtn:!1,loading:S,maxWidth:"md",leftSizeBtn:e("shoppingLists.close"),children:n.jsx(x,{isSpinning:S,children:n.jsxs(i,{sx:{minWidth:O?"initial":"100%",flex:1},children:[n.jsx(l,{hiddenLabel:!0,variant:"filled",fullWidth:!0,size:"small",value:r,onChange:g,onKeyDown:t=>{"Enter"===t.key&&f()},error:!u||u.length<=0,InputProps:{startAdornment:n.jsx(c,{position:"start",children:n.jsx(W,{})})},sx:{margin:"12px 0","& input":{padding:"12px 12px 12px 0"}}}),u&&u.length>0?n.jsx(R,{products:u,quantityEditable:!0,type:j,textAlign:O?"left":"right",canToProduct:!0,onProductQuantityChange:y,renderAction:t=>n.jsx(K,{product:t,onAddToListClick:_,onChooseOptionsClick:k,addButtonText:L}),actionWidth:"180px"}):n.jsx(a,{children:"No products found"})]})})})}}}});
//# sourceMappingURL=SearchProduct-legacy-CFFIkOeB.js.map
